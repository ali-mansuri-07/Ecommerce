/*! For license information please see 18.f344aa1a.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[18],{11890:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(1413),i=n(72791),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"}}]},name:"home",theme:"outlined"},u=n(83940),o=function(e,t){return i.createElement(u.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:a}))};o.displayName="HomeOutlined";var s=i.forwardRef(o)},87962:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(1413),i=n(72791),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 732h-70.3c-4.8 0-9.3 2.1-12.3 5.8-7 8.5-14.5 16.7-22.4 24.5a353.84 353.84 0 01-112.7 75.9A352.8 352.8 0 01512.4 866c-47.9 0-94.3-9.4-137.9-27.8a353.84 353.84 0 01-112.7-75.9 353.28 353.28 0 01-76-112.5C167.3 606.2 158 559.9 158 512s9.4-94.2 27.8-137.8c17.8-42.1 43.4-80 76-112.5s70.5-58.1 112.7-75.9c43.6-18.4 90-27.8 137.9-27.8 47.9 0 94.3 9.3 137.9 27.8 42.2 17.8 80.1 43.4 112.7 75.9 7.9 7.9 15.3 16.1 22.4 24.5 3 3.7 7.6 5.8 12.3 5.8H868c6.3 0 10.2-7 6.7-12.3C798 160.5 663.8 81.6 511.3 82 271.7 82.6 79.6 277.1 82 516.4 84.4 751.9 276.2 942 512.4 942c152.1 0 285.7-78.8 362.3-197.7 3.4-5.3-.4-12.3-6.7-12.3zm88.9-226.3L815 393.7c-5.3-4.2-13-.4-13 6.3v76H488c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h314v76c0 6.7 7.8 10.5 13 6.3l141.9-112a8 8 0 000-12.6z"}}]},name:"logout",theme:"outlined"},u=n(83940),o=function(e,t){return i.createElement(u.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:a}))};o.displayName="LogoutOutlined";var s=i.forwardRef(o)},11730:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(1413),i=n(72791),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},u=n(83940),o=function(e,t){return i.createElement(u.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:a}))};o.displayName="SearchOutlined";var s=i.forwardRef(o)},92414:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(1413),i=n(72791),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},u=n(83940),o=function(e,t){return i.createElement(u.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:a}))};o.displayName="SettingOutlined";var s=i.forwardRef(o)},86533:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(1413),i=n(72791),a={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M922.9 701.9H327.4l29.9-60.9 496.8-.9c16.8 0 31.2-12 34.2-28.6l68.8-385.1c1.8-10.1-.9-20.5-7.5-28.4a34.99 34.99 0 00-26.6-12.5l-632-2.1-5.4-25.4c-3.4-16.2-18-28-34.6-28H96.5a35.3 35.3 0 100 70.6h125.9L246 312.8l58.1 281.3-74.8 122.1a34.96 34.96 0 00-3 36.8c6 11.9 18.1 19.4 31.5 19.4h62.8a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7h161.1a102.43 102.43 0 00-20.6 61.7c0 56.6 46 102.6 102.6 102.6s102.6-46 102.6-102.6c0-22.3-7.4-44-20.6-61.7H923c19.4 0 35.3-15.8 35.3-35.3a35.42 35.42 0 00-35.4-35.2zM305.7 253l575.8 1.9-56.4 315.8-452.3.8L305.7 253zm96.9 612.7c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6zm325.1 0c-17.4 0-31.6-14.2-31.6-31.6 0-17.4 14.2-31.6 31.6-31.6s31.6 14.2 31.6 31.6a31.6 31.6 0 01-31.6 31.6z"}}]},name:"shopping-cart",theme:"outlined"},u=n(83940),o=function(e,t){return i.createElement(u.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:a}))};o.displayName="ShoppingCartOutlined";var s=i.forwardRef(o)},72643:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(1413),i=n(72791),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 312H696v-16c0-101.6-82.4-184-184-184s-184 82.4-184 184v16H192c-17.7 0-32 14.3-32 32v536c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V344c0-17.7-14.3-32-32-32zm-432-16c0-61.9 50.1-112 112-112s112 50.1 112 112v16H400v-16zm392 544H232V384h96v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h224v88c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-88h96v456z"}}]},name:"shopping",theme:"outlined"},u=n(83940),o=function(e,t){return i.createElement(u.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:a}))};o.displayName="ShoppingOutlined";var s=i.forwardRef(o)},50713:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(1413),i=n(72791),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"},u=n(83940),o=function(e,t){return i.createElement(u.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:a}))};o.displayName="UserAddOutlined";var s=i.forwardRef(o)},29529:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(1413),i=n(72791),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M858.5 763.6a374 374 0 00-80.6-119.5 375.63 375.63 0 00-119.5-80.6c-.4-.2-.8-.3-1.2-.5C719.5 518 760 444.7 760 362c0-137-111-248-248-248S264 225 264 362c0 82.7 40.5 156 102.8 201.1-.4.2-.8.3-1.2.5-44.8 18.9-85 46-119.5 80.6a375.63 375.63 0 00-80.6 119.5A371.7 371.7 0 00136 901.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8 2-77.2 33-149.5 87.8-204.3 56.7-56.7 132-87.9 212.2-87.9s155.5 31.2 212.2 87.9C779 752.7 810 825 812 902.2c.1 4.4 3.6 7.8 8 7.8h60a8 8 0 008-8.2c-1-47.8-10.9-94.3-29.5-138.2zM512 534c-45.9 0-89.1-17.9-121.6-50.4S340 407.9 340 362c0-45.9 17.9-89.1 50.4-121.6S466.1 190 512 190s89.1 17.9 121.6 50.4S684 316.1 684 362c0 45.9-17.9 89.1-50.4 121.6S557.9 534 512 534z"}}]},name:"user",theme:"outlined"},u=n(83940),o=function(e,t){return i.createElement(u.Z,(0,r.Z)((0,r.Z)({},e),{},{ref:t,icon:a}))};o.displayName="UserOutlined";var s=i.forwardRef(o)},84480:function(e,t,n){var r,i=n(5647),a=n(60136),u=n(27277),o=n(37762),s=n(15671),c=n(43144),l=n(30166),h=n(11752),f=n(61120),d=n(29439),v=n(74165),y=n(15861),p=n(93433),m=n(33450),g=n(23258),k=n(6781),w=n(21492),b="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},x={},I=I||{},Z=b||self;function E(){}function T(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function S(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var _="closure_uid_"+(1e9*Math.random()>>>0),D=0;function A(e,t,n){return e.call.apply(e.bind,arguments)}function C(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function N(e,t,n){return(N=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?A:C).apply(null,arguments)}function R(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function M(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function V(){this.s=this.s,this.o=this.o}var L={};V.prototype.s=!1,V.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,_)&&e[_]||(e[_]=++D)}(this);delete L[e]}},V.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var O=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},F=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"===typeof e?e.split(""):e,a=0;a<r;a++)a in i&&t.call(n,i[a],a,e)};function P(e){return Array.prototype.concat.apply([],arguments)}function U(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function B(e){return/^[\s\xa0]*$/.test(e)}var q,K=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function G(e,t){return-1!=e.indexOf(t)}function j(e,t){return e<t?-1:e>t?1:0}e:{var z=Z.navigator;if(z){var Q=z.userAgent;if(Q){q=Q;break e}}q=""}function H(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function W(e){var t={};for(var n in e)t[n]=e[n];return t}var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<X.length;a++)n=X[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function J(e){return J[" "](e),e}J[" "]=E;var $,ee=G(q,"Opera"),te=G(q,"Trident")||G(q,"MSIE"),ne=G(q,"Edge"),re=ne||te,ie=G(q,"Gecko")&&!(G(q.toLowerCase(),"webkit")&&!G(q,"Edge"))&&!(G(q,"Trident")||G(q,"MSIE"))&&!G(q,"Edge"),ae=G(q.toLowerCase(),"webkit")&&!G(q,"Edge");function ue(){var e=Z.document;return e?e.documentMode:void 0}e:{var oe="",se=function(){var e=q;return ie?/rv:([^\);]+)(\)|;)/.exec(e):ne?/Edge\/([\d\.]+)/.exec(e):te?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):ae?/WebKit\/(\S+)/.exec(e):ee?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(se&&(oe=se?se[1]:""),te){var ce=ue();if(null!=ce&&ce>parseFloat(oe)){$=String(ce);break e}}$=oe}var le,he={};function fe(){return function(e){var t=he;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){for(var e=0,t=K(String($)).split("."),n=K("9").split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++){var a=t[i]||"",u=n[i]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],0==a[0].length&&0==u[0].length)break;e=j(0==a[1].length?0:parseInt(a[1],10),0==u[1].length?0:parseInt(u[1],10))||j(0==a[2].length,0==u[2].length)||j(a[2],u[2]),a=a[3],u=u[3]}while(0==e)}return 0<=e}))}if(Z.document&&te){var de=ue();le=de||(parseInt($,10)||void 0)}else le=void 0;var ve=le,ye=function(){if(!Z.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Z.addEventListener("test",E,t),Z.removeEventListener("test",E,t)}catch(n){}return e}();function pe(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function me(e,t){if(pe.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(ie){e:{try{J(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:ge[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&me.Z.h.call(this)}}pe.prototype.h=function(){this.defaultPrevented=!0},M(me,pe);var ge={2:"touch",3:"pen",4:"mouse"};me.prototype.h=function(){me.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var ke="closure_listenable_"+(1e6*Math.random()|0),we=0;function be(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++we,this.ca=this.fa=!1}function xe(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Ie(e){this.src=e,this.g={},this.h=0}function Ze(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=O(i,t);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(xe(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Ee(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.ca&&a.listener==t&&a.capture==!!n&&a.ia==r)return i}return-1}Ie.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var u=Ee(e,t,r,i);return-1<u?(t=e[u],n||(t.fa=!1)):((t=new be(t,this.src,a,!!r,i)).fa=n,e.push(t)),t};var Te="closure_lm_"+(1e6*Math.random()|0),Se={};function _e(e,t,n,r,i){if(r&&r.once)return Ae(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)_e(e,t[a],n,r,i);return null}return n=Oe(n),e&&e[ke]?e.N(t,n,S(r)?!!r.capture:!!r,i):De(e,t,n,!1,r,i)}function De(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var u=S(i)?!!i.capture:!!i,o=Ve(e);if(o||(e[Te]=o=new Ie(e)),(n=o.add(t,n,r,u,a)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=Me;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)ye||(i=u),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Re(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Ae(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)Ae(e,t[a],n,r,i);return null}return n=Oe(n),e&&e[ke]?e.O(t,n,S(r)?!!r.capture:!!r,i):De(e,t,n,!0,r,i)}function Ce(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)Ce(e,t[a],n,r,i);else r=S(r)?!!r.capture:!!r,n=Oe(n),e&&e[ke]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=Ee(a=e.g[t],n,r,i))&&(xe(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--)))):e&&(e=Ve(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Ee(t,n,r,i)),(n=-1<e?t[e]:null)&&Ne(n))}function Ne(e){if("number"!==typeof e&&e&&!e.ca){var t=e.src;if(t&&t[ke])Ze(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Re(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ve(t))?(Ze(n,e),0==n.h&&(n.src=null,t[Te]=null)):xe(e)}}}function Re(e){return e in Se?Se[e]:Se[e]="on"+e}function Me(e,t){if(e.ca)e=!0;else{t=new me(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&Ne(e),e=n.call(r,t)}return e}function Ve(e){return(e=e[Te])instanceof Ie?e:null}var Le="__closure_events_fn_"+(1e9*Math.random()>>>0);function Oe(e){return"function"===typeof e?e:(e[Le]||(e[Le]=function(t){return e.handleEvent(t)}),e[Le])}function Fe(){V.call(this),this.i=new Ie(this),this.P=this,this.I=null}function Pe(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"===typeof t)t=new pe(t,e);else if(t instanceof pe)t.target=t.target||e;else{var i=t;Y(t=new pe(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var u=t.g=n[a];i=Ue(u,r,!0,t)&&i}if(i=Ue(u=t.g=e,r,!0,t)&&i,i=Ue(u,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=Ue(u=t.g=n[a],r,!1,t)&&i}function Ue(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var u=t[a];if(u&&!u.ca&&u.capture==n){var o=u.listener,s=u.ia||u.src;u.fa&&Ze(e.i,u),i=!1!==o.call(s,r)&&i}}return i&&!r.defaultPrevented}M(Fe,V),Fe.prototype[ke]=!0,Fe.prototype.removeEventListener=function(e,t,n,r){Ce(this,e,t,n,r)},Fe.prototype.M=function(){if(Fe.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)xe(n[r]);delete t.g[e],t.h--}}this.I=null},Fe.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Fe.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Be=Z.JSON.stringify;function qe(){var e=Xe,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Ke,Ge=function(){function e(){(0,s.Z)(this,e),this.h=this.g=null}return(0,c.Z)(e,[{key:"add",value:function(e,t){var n=je.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}]),e}(),je=new(function(){function e(t,n){(0,s.Z)(this,e),this.i=t,this.j=n,this.h=0,this.g=null}return(0,c.Z)(e,[{key:"get",value:function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}]),e}())((function(){return new ze}),(function(e){return e.reset()})),ze=function(){function e(){(0,s.Z)(this,e),this.next=this.g=this.h=null}return(0,c.Z)(e,[{key:"set",value:function(e,t){this.h=e,this.g=t,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),e}();function Qe(e){Z.setTimeout((function(){throw e}),0)}function He(e,t){Ke||function(){var e=Z.Promise.resolve(void 0);Ke=function(){e.then(Ye)}}(),We||(Ke(),We=!0),Xe.add(e,t)}var We=!1,Xe=new Ge;function Ye(){for(var e;e=qe();){try{e.h.call(e.g)}catch(n){Qe(n)}var t=je;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}We=!1}function Je(e,t){Fe.call(this),this.h=e||1,this.g=t||Z,this.j=N(this.kb,this),this.l=Date.now()}function $e(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function et(e,t,n){if("function"===typeof e)n&&(e=N(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=N(e.handleEvent,e)}return 2147483647<Number(t)?-1:Z.setTimeout(e,t||0)}function tt(e){e.g=et((function(){e.g=null,e.i&&(e.i=!1,tt(e))}),e.j);var t=e.h;e.h=null,e.m.apply(null,t)}M(Je,Fe),(r=Je.prototype).da=!1,r.S=null,r.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Pe(this,"tick"),this.da&&($e(this),this.start()))}},r.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.M=function(){Je.Z.M.call(this),$e(this),delete this.g};var nt=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this)).m=e,i.j=r,i.h=null,i.i=!1,i.g=null,i}return(0,c.Z)(n,[{key:"l",value:function(e){this.h=arguments,this.g?this.i=!0:tt(this)}},{key:"M",value:function(){(0,h.Z)((0,f.Z)(n.prototype),"M",this).call(this),this.g&&(Z.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),n}(V);function rt(e){V.call(this),this.h=e,this.g={}}M(rt,V);var it=[];function at(e,t,n,r){Array.isArray(n)||(n&&(it[0]=n.toString()),n=it);for(var i=0;i<n.length;i++){var a=_e(t,n[i],r||e.handleEvent,!1,e.h||e);if(!a)break;e.g[a.key]=a}}function ut(e){H(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ne(e)}),e),e.g={}}function ot(){this.g=!0}function st(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var u=1;u<i.length;u++)i[u]=""}}}return Be(n)}catch(o){return t}}(e,n)+(r?" "+r:"")}))}rt.prototype.M=function(){rt.Z.M.call(this),ut(this)},rt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ot.prototype.Aa=function(){this.g=!1},ot.prototype.info=function(){};var ct={},lt=null;function ht(){return lt=lt||new Fe}function ft(e){pe.call(this,ct.Ma,e)}function dt(e){var t=ht();Pe(t,new ft(t,e))}function vt(e,t){pe.call(this,ct.STAT_EVENT,e),this.stat=t}function yt(e){var t=ht();Pe(t,new vt(t,e))}function pt(e,t){pe.call(this,ct.Na,e),this.size=t}function mt(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return Z.setTimeout((function(){e()}),t)}ct.Ma="serverreachability",M(ft,pe),ct.STAT_EVENT="statevent",M(vt,pe),ct.Na="timingevent",M(pt,pe);var gt={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},kt={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function wt(){}function bt(e){return e.h||(e.h=e.i())}function xt(){}wt.prototype.h=null;var It,Zt={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Et(){pe.call(this,"d")}function Tt(){pe.call(this,"c")}function St(){}function _t(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new rt(this),this.P=At,e=re?125:void 0,this.W=new Je(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Dt}function Dt(){this.i=null,this.g="",this.h=!1}M(Et,pe),M(Tt,pe),M(St,wt),St.prototype.g=function(){return new XMLHttpRequest},St.prototype.i=function(){return{}},It=new St;var At=45e3,Ct={},Nt={};function Rt(e,t,n){e.K=1,e.v=nn(Xt(t)),e.s=n,e.U=!0,Mt(e,null)}function Mt(e,t){e.F=Date.now(),Ft(e),e.A=Xt(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),pn(n.h,"t",r),e.C=0,n=e.l.H,e.h=new Dt,e.g=gr(e.l,n?t:null,!e.s),0<e.O&&(e.L=new nt(N(e.Ia,e,e.g),e.O)),at(e.V,e.g,"readystatechange",e.gb),t=e.H?W(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),dt(1),function(e,t,n,r,i,a){e.info((function(){if(e.g)if(a)for(var u="",o=a.split("&"),s=0;s<o.length;s++){var c=o[s].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");u=2<=h.length&&"type"==h[1]?u+(l+"=")+c+"&":u+(l+"=redacted&")}}else u=null;else u=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+u}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function Vt(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function Lt(e,t,n){for(var r,i=!0;!e.I&&e.C<n.length;){if((r=Ot(e,n))==Nt){4==t&&(e.o=4,yt(14),i=!1),st(e.j,e.m,null,"[Incomplete Response]");break}if(r==Ct){e.o=4,yt(15),st(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}st(e.j,e.m,r,null),Kt(e,r)}Vt(e)&&r!=Nt&&r!=Ct&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,yt(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),lr(t),t.L=!0,yt(11))):(st(e.j,e.m,n,"[Invalid Chunked Response]"),qt(e),Bt(e))}function Ot(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Nt:(n=Number(t.substring(n,r)),isNaN(n)?Ct:(r+=1)+n>t.length?Nt:(t=t.substr(r,n),e.C=r+n,t))}function Ft(e){e.Y=Date.now()+e.P,Pt(e,e.P)}function Pt(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=mt(N(e.eb,e),t)}function Ut(e){e.B&&(Z.clearTimeout(e.B),e.B=null)}function Bt(e){0==e.l.G||e.I||dr(e.l,e)}function qt(e){Ut(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,$e(e.W),ut(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Kt(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||Zn(n.i,e)))if(n.I=e.N,!e.J&&Zn(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(a){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;fr(n),tr(n)}cr(n),yt(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=mt(N(n.ab,n),6e3));if(1>=In(n.i)&&n.ka){try{n.ka()}catch(a){}n.ka=void 0}}else yr(n,11)}else if((e.J||n.g==e)&&fr(n),!B(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var a=i[t];if(n.U=a[0],a=a[1],2==n.G)if("c"==a[0]){n.J=a[1],n.la=a[2];var u=a[3];null!=u&&(n.ma=u,n.h.info("VER="+n.ma));var o=a[4];null!=o&&(n.za=o,n.h.info("SVER="+n.za));var s=a[5];null!=s&&"number"===typeof s&&0<s&&(r=1.5*s,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var h=r.i;!h.g&&(G(l,"spdy")||G(l,"quic")||G(l,"h2"))&&(h.j=h.l,h.g=new Set,h.h&&(En(h,h.h),h.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.sa=f,tn(r.F,r.D,f))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=e;if((r=n).oa=mr(r,r.H?r.la:null,r.W),d.J){Tn(r.i,d);var v=d,y=r.K;y&&v.setTimeout(y),v.B&&(Ut(v),Ft(v)),r.g=d}else sr(r);0<n.l.length&&ir(n)}else"stop"!=a[0]&&"close"!=a[0]||yr(n,7);else 3==n.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?yr(n,7):er(n):"noop"!=a[0]&&n.j&&n.j.wa(a),n.A=0)}dt(4)}catch(a){}}function Gt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(T(e)||"string"===typeof e)F(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(T(e)||"string"===typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"===typeof e)return e.split("");if(T(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length;for(var a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}}function jt(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof jt)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function zt(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Qt(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)Qt(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function Qt(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(r=_t.prototype).setTimeout=function(e){this.P=e},r.gb=function(e){e=e.target;var t=this.L;t&&3==Wn(e)?t.l():this.Ia(e)},r.Ia=function(e){try{if(e==this.g)e:{var t=Wn(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>t)&&(3!=t||re||this.g&&(this.h.h||this.g.ga()||Xn(this.g)))){this.I||4!=t||7==n||dt(8==n||0>=r?3:2),Ut(this);var i=this.g.ba();this.N=i;t:if(Vt(this)){var a=Xn(this.g);e="";var u=a.length,o=4==Wn(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){qt(this),Bt(this);var s="";break t}this.h.i=new Z.TextDecoder}for(n=0;n<u;n++)this.h.h=!0,e+=this.h.i.decode(a[n],{stream:o&&n==u-1});a.splice(0,u),this.h.g+=e,this.C=0,s=this.h.g}else s=this.g.ga();if(this.i=200==i,function(e,t,n,r,i,a,u){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+u}))}(this.j,this.u,this.A,this.m,this.X,t,i),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(c)){var h=c;break t}}h=null}if(!(i=h)){this.i=!1,this.o=3,yt(12),qt(this),Bt(this);break e}st(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Kt(this,i)}this.U?(Lt(this,t,s),re&&this.i&&3==t&&(at(this.V,this.W,"tick",this.fb),this.W.start())):(st(this.j,this.m,s,null),Kt(this,s)),4==t&&qt(this),this.i&&!this.I&&(4==t?dr(this.l,this):(this.i=!1,Ft(this)))}else 400==i&&0<s.indexOf("Unknown SID")?(this.o=3,yt(12)):(this.o=0,yt(13)),qt(this),Bt(this)}}}catch(t){}},r.fb=function(){if(this.g){var e=Wn(this.g),t=this.g.ga();this.C<t.length&&(Ut(this),Lt(this,e,t),this.i&&4!=e&&Ft(this))}},r.cancel=function(){this.I=!0,qt(this)},r.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(dt(3),yt(17)),qt(this),this.o=2,Bt(this)):Pt(this,this.Y-e)},(r=jt.prototype).R=function(){zt(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},r.T=function(){return zt(this),this.g.concat()},r.get=function(e,t){return Qt(this.h,e)?this.h[e]:t},r.set=function(e,t){Qt(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},r.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],a=this.get(i);e.call(t,a,i,this)}};var Ht=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Wt(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Wt){this.g=void 0!==t?t:e.g,Yt(this,e.j),this.s=e.s,Jt(this,e.i),$t(this,e.m),this.l=e.l,t=e.h;var n=new fn;n.i=t.i,t.g&&(n.g=new jt(t.g),n.h=t.h),en(this,n),this.o=e.o}else e&&(n=String(e).match(Ht))?(this.g=!!t,Yt(this,n[1]||"",!0),this.s=rn(n[2]||""),Jt(this,n[3]||"",!0),$t(this,n[4]),this.l=rn(n[5]||"",!0),en(this,n[6]||"",!0),this.o=rn(n[7]||"")):(this.g=!!t,this.h=new fn(null,this.g))}function Xt(e){return new Wt(e)}function Yt(e,t,n){e.j=n?rn(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Jt(e,t,n){e.i=n?rn(t,!0):t}function $t(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function en(e,t,n){t instanceof fn?(e.h=t,function(e,t){t&&!e.j&&(dn(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(vn(this,t),pn(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=an(t,ln)),e.h=new fn(t,e.g))}function tn(e,t,n){e.h.set(t,n)}function nn(e){return tn(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function rn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function an(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,un),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function un(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Wt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(an(t,on,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(an(t,on,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(an(n,"/"==n.charAt(0)?cn:sn,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",an(n,hn)),e.join("")};var on=/[#\/\?@]/g,sn=/[#\?:]/g,cn=/[#\?]/g,ln=/[#\?@]/g,hn=/#/g;function fn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function dn(e){e.g||(e.g=new jt,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function vn(e,t){dn(e),t=mn(e,t),Qt(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Qt((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&zt(e)))}function yn(e,t){return dn(e),t=mn(e,t),Qt(e.g.h,t)}function pn(e,t,n){vn(e,t),0<n.length&&(e.i=null,e.g.set(mn(e,t),U(n)),e.h+=n.length)}function mn(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(r=fn.prototype).add=function(e,t){dn(this),this.i=null,e=mn(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},r.forEach=function(e,t){dn(this),this.g.forEach((function(n,r){F(n,(function(n){e.call(t,n,r,this)}),this)}),this)},r.T=function(){dn(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},r.R=function(e){dn(this);var t=[];if("string"===typeof e)yn(this,e)&&(t=P(t,this.g.get(mn(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=P(t,e[n])}return t},r.set=function(e,t){return dn(this),this.i=null,yn(this,e=mn(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},r.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var a=0;a<r.length;a++){var u=i;""!==r[a]&&(u+="="+encodeURIComponent(String(r[a]))),e.push(u)}}return this.i=e.join("&")};var gn=(0,c.Z)((function e(t,n){(0,s.Z)(this,e),this.h=t,this.g=n}));function kn(e){this.l=e||bn,Z.PerformanceNavigationTiming?e=0<(e=Z.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(Z.g&&Z.g.Ea&&Z.g.Ea()&&Z.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var wn,bn=10;function xn(e){return!!e.h||!!e.g&&e.g.size>=e.j}function In(e){return e.h?1:e.g?e.g.size:0}function Zn(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function En(e,t){e.g?e.g.add(t):e.h=t}function Tn(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Sn(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var t,n=e.i,r=(0,o.Z)(e.g.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i.D)}}catch(a){r.e(a)}finally{r.f()}return n}return U(e.i)}function _n(){}function Dn(){this.g=new _n}function An(e,t,n){var r=n||"";try{Gt(e,(function(e,n){var i=e;S(e)&&(i=Be(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function Cn(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(a){}}function Nn(e){this.l=e.$b||null,this.j=e.ib||!1}function Rn(e,t){Fe.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Mn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}kn.prototype.cancel=function(){if(this.i=Sn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var e,t=(0,o.Z)(this.g.values());try{for(t.s();!(e=t.n()).done;){e.value.cancel()}}catch(n){t.e(n)}finally{t.f()}this.g.clear()}},_n.prototype.stringify=function(e){return Z.JSON.stringify(e,void 0)},_n.prototype.parse=function(e){return Z.JSON.parse(e,void 0)},M(Nn,wt),Nn.prototype.g=function(){return new Rn(this.l,this.j)},Nn.prototype.i=(wn={},function(){return wn}),M(Rn,Fe);var Mn=0;function Vn(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Ln(e){e.readyState=4,e.l=null,e.j=null,e.A=null,On(e)}function On(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(r=Rn.prototype).open=function(e,t){if(this.readyState!=Mn)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,On(this)},r.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||Z).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ln(this)),this.readyState=Mn},r.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,On(this)),this.g&&(this.readyState=3,On(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if("undefined"!==typeof Z.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Vn(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},r.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ln(this):On(this),3==this.readyState&&Vn(this)}},r.Ua=function(e){this.g&&(this.response=this.responseText=e,Ln(this))},r.Ta=function(e){this.g&&(this.response=e,Ln(this))},r.ha=function(){this.g&&Ln(this)},r.setRequestHeader=function(e,t){this.v.append(e,t)},r.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Rn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Fn=Z.JSON.parse;function Pn(e){Fe.call(this),this.headers=new jt,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Un,this.K=this.L=!1}M(Pn,Fe);var Un="",Bn=/^https?$/i,qn=["POST","PUT"];function Kn(e){return"content-type"==e.toLowerCase()}function Gn(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,jn(e),Qn(e)}function jn(e){e.D||(e.D=!0,Pe(e,"complete"),Pe(e,"error"))}function zn(e){if(e.h&&"undefined"!=typeof I&&(!e.C[1]||4!=Wn(e)||2!=e.ba()))if(e.v&&4==Wn(e))et(e.Fa,0,e);else if(Pe(e,"readystatechange"),4==Wn(e)){e.h=!1;try{var t,n=e.ba();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var a=String(e.H).match(Ht)[1]||null;if(!a&&Z.self&&Z.self.location){var u=Z.self.location.protocol;a=u.substr(0,u.length-1)}i=!Bn.test(a?a.toLowerCase():"")}t=i}if(t)Pe(e,"complete"),Pe(e,"success");else{e.m=6;try{var o=2<Wn(e)?e.g.statusText:""}catch(s){o=""}e.j=o+" ["+e.ba()+"]",jn(e)}}finally{Qn(e)}}}function Qn(e,t){if(e.g){Hn(e);var n=e.g,r=e.C[0]?E:null;e.g=null,e.C=null,t||Pe(e,"ready");try{n.onreadystatechange=r}catch(i){}}}function Hn(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(Z.clearTimeout(e.A),e.A=null)}function Wn(e){return e.g?e.g.readyState:0}function Xn(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Un:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Yn(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){var t="";return H(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):tn(e,t,n))}function Jn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function $n(e){this.za=0,this.l=[],this.h=new ot,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Jn("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Jn("baseRetryDelayMs",5e3,e),this.$a=Jn("retryDelaySeedMs",1e4,e),this.Ya=Jn("forwardChannelMaxRetries",2,e),this.ra=Jn("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new kn(e&&e.concurrentRequestLimit),this.Ca=new Dn,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function er(e){if(nr(e),3==e.G){var t=e.V++,n=Xt(e.F);tn(n,"SID",e.J),tn(n,"RID",t),tn(n,"TYPE","terminate"),ur(e,n),(t=new _t(e,e.h,t,void 0)).K=2,t.v=nn(Xt(n)),n=!1,Z.navigator&&Z.navigator.sendBeacon&&(n=Z.navigator.sendBeacon(t.v.toString(),"")),!n&&Z.Image&&((new Image).src=t.v,n=!0),n||(t.g=gr(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Ft(t)}pr(e)}function tr(e){e.g&&(lr(e),e.g.cancel(),e.g=null)}function nr(e){tr(e),e.u&&(Z.clearTimeout(e.u),e.u=null),fr(e),e.i.cancel(),e.m&&("number"===typeof e.m&&Z.clearTimeout(e.m),e.m=null)}function rr(e,t){e.l.push(new gn(e.Za++,t)),3==e.G&&ir(e)}function ir(e){xn(e.i)||e.m||(e.m=!0,He(e.Ha,e),e.C=0)}function ar(e,t){var n;n=t?t.m:e.V++;var r=Xt(e.F);tn(r,"SID",e.J),tn(r,"RID",n),tn(r,"AID",e.U),ur(e,r),e.o&&e.s&&Yn(r,e.o,e.s),n=new _t(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=or(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),En(e.i,n),Rt(n,r,t)}function ur(e,t){e.j&&Gt({},(function(e,n){tn(t,n,e)}))}function or(e,t,n){n=Math.min(e.l.length,n);var r=e.j?N(e.j.Oa,e.j,e):null;e:for(var i=e.l,a=-1;;){var u=["count="+n];-1==a?0<n?(a=i[0].h,u.push("ofs="+a)):a=0:u.push("ofs="+a);for(var o=!0,s=0;s<n;s++){var c=i[s].h,l=i[s].g;if(0>(c-=a))a=Math.max(0,i[s].h-100),o=!1;else try{An(l,u,"req"+c+"_")}catch(zr){r&&r(l)}}if(o){r=u.join("&");break e}}return e=e.l.splice(0,n),t.D=e,r}function sr(e){e.g||e.u||(e.Y=1,He(e.Ga,e),e.A=0)}function cr(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=mt(N(e.Ga,e),vr(e,e.A)),e.A++,!0)}function lr(e){null!=e.B&&(Z.clearTimeout(e.B),e.B=null)}function hr(e){e.g=new _t(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Xt(e.oa);tn(t,"RID","rpc"),tn(t,"SID",e.J),tn(t,"CI",e.N?"0":"1"),tn(t,"AID",e.U),ur(e,t),tn(t,"TYPE","xmlhttp"),e.o&&e.s&&Yn(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=nn(Xt(t)),n.s=null,n.U=!0,Mt(n,e)}function fr(e){null!=e.v&&(Z.clearTimeout(e.v),e.v=null)}function dr(e,t){var n=null;if(e.g==t){fr(e),lr(e),e.g=null;var r=2}else{if(!Zn(e.i,t))return;n=t.D,Tn(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Pe(r=ht(),new pt(r,n,t,i)),ir(e)}else sr(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(In(e.i)>=e.i.j-(e.m?1:0))&&(e.m?(e.l=t.D.concat(e.l),!0):!(1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya))&&(e.m=mt(N(e.Ha,e,t),vr(e,e.C)),e.C++,!0))}(e,t)||2==r&&cr(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:yr(e,5);break;case 4:yr(e,10);break;case 3:yr(e,6);break;default:yr(e,2)}}function vr(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function yr(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=N(e.jb,e);n||(n=new Wt("//www.google.com/images/cleardot.gif"),Z.location&&"http"==Z.location.protocol||Yt(n,"https"),nn(n)),function(e,t){var n=new ot;if(Z.Image){var r=new Image;r.onload=R(Cn,n,r,"TestLoadImage: loaded",!0,t),r.onerror=R(Cn,n,r,"TestLoadImage: error",!1,t),r.onabort=R(Cn,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=R(Cn,n,r,"TestLoadImage: timeout",!1,t),Z.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else yt(2);e.G=0,e.j&&e.j.va(t),pr(e),nr(e)}function pr(e){e.G=0,e.I=-1,e.j&&(0==Sn(e.i).length&&0==e.l.length||(e.i.i.length=0,U(e.l),e.l.length=0),e.j.ua())}function mr(e,t,n){var r=function(e){return e instanceof Wt?Xt(e):new Wt(e,void 0)}(n);if(""!=r.i)t&&Jt(r,t+"."+r.i),$t(r,r.m);else{var i=Z.location;r=function(e,t,n,r){var i=new Wt(null,void 0);return e&&Yt(i,e),t&&Jt(i,t),n&&$t(i,n),r&&(i.l=r),i}(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.aa&&H(e.aa,(function(e,t){tn(r,t,e)})),t=e.D,n=e.sa,t&&n&&tn(r,t,n),tn(r,"VER",e.ma),ur(e,r),r}function gr(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new Pn(new Nn({ib:!0})):new Pn(e.qa)).L=e.H,t}function kr(){}function wr(){if(te&&!(10<=Number(ve)))throw Error("Environmental error: no available transport.")}function br(e,t){Fe.call(this),this.g=new $n(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!B(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!B(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Zr(this)}function xr(e){Et.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Ir(){Tt.call(this),this.status=1}function Zr(e){this.g=e}(r=Pn.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():It.g(),this.C=this.u?bt(this.u):bt(It),this.g.onreadystatechange=N(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(a){return void Gn(this,a)}e=n||"";var i=new jt(this.headers);r&&Gt(r,(function(e,t){i.set(t,e)})),r=function(e){e:{for(var t=Kn,n=e.length,r="string"===typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"===typeof e?e.charAt(t):e[t]}(i.T()),n=Z.FormData&&e instanceof Z.FormData,!(0<=O(qn,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Hn(this),0<this.B&&((this.K=function(e){return te&&fe()&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=N(this.pa,this)):this.A=et(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(a){Gn(this,a)}},r.pa=function(){"undefined"!=typeof I&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Pe(this,"timeout"),this.abort(8))},r.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Pe(this,"complete"),Pe(this,"abort"),Qn(this))},r.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Qn(this,!0)),Pn.Z.M.call(this)},r.Fa=function(){this.s||(this.F||this.v||this.l?zn(this):this.cb())},r.cb=function(){zn(this)},r.ba=function(){try{return 2<Wn(this)?this.g.status:-1}catch(wn){return-1}},r.ga=function(){try{return this.g?this.g.responseText:""}catch(wn){return""}},r.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Fn(t)}},r.Da=function(){return this.m},r.La=function(){return"string"===typeof this.j?this.j:String(this.j)},(r=$n.prototype).ma=8,r.G=1,r.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}},r.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new _t(this,this.h,e,void 0),n=this.s;if(this.P&&(n?Y(n=W(n),this.P):n=this.P),null===this.o&&(t.H=n),this.ja)e:{for(var r=0,i=0;i<this.l.length;i++){var a=this.l[i];if(void 0===(a="__data__"in a.g&&"string"===typeof(a=a.g.__data__)?a.length:void 0))break;if(4096<(r+=a)){r=i;break e}if(4096===r||i===this.l.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=or(this,t,r),tn(i=Xt(this.F),"RID",e),tn(i,"CVER",22),this.D&&tn(i,"X-HTTP-Session-Id",this.D),ur(this,i),this.o&&n&&Yn(i,this.o,n),En(this.i,t),this.Ra&&tn(i,"TYPE","init"),this.ja?(tn(i,"$req",r),tn(i,"SID","null"),t.$=!0,Rt(t,i,null)):Rt(t,i,r),this.G=2}}else 3==this.G&&(e?ar(this,e):0==this.l.length||xn(this.i)||ar(this))},r.Ga=function(){if(this.u=null,hr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=mt(N(this.bb,this),e)}},r.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,yt(10),tr(this),hr(this))},r.ab=function(){null!=this.v&&(this.v=null,tr(this),cr(this),yt(19))},r.jb=function(e){e?(this.h.info("Successfully pinged google.com"),yt(2)):(this.h.info("Failed to ping google.com"),yt(1))},(r=kr.prototype).xa=function(){},r.wa=function(){},r.va=function(){},r.ua=function(){},r.Oa=function(){},wr.prototype.g=function(e,t){return new br(e,t)},M(br,Fe),br.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),He(N(e.hb,e,t))),yt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=mr(e,null,e.W),ir(e)},br.prototype.close=function(){er(this.g)},br.prototype.u=function(e){if("string"===typeof e){var t={};t.__data__=e,rr(this.g,t)}else this.v?((t={}).__data__=Be(e),rr(this.g,t)):rr(this.g,e)},br.prototype.M=function(){this.g.j=null,delete this.j,er(this.g),delete this.g,br.Z.M.call(this)},M(xr,Et),M(Ir,Tt),M(Zr,kr),Zr.prototype.xa=function(){Pe(this.g,"a")},Zr.prototype.wa=function(e){Pe(this.g,new xr(e))},Zr.prototype.va=function(e){Pe(this.g,new Ir(e))},Zr.prototype.ua=function(){Pe(this.g,"b")},wr.prototype.createWebChannel=wr.prototype.g,br.prototype.send=br.prototype.u,br.prototype.open=br.prototype.m,br.prototype.close=br.prototype.close,gt.NO_ERROR=0,gt.TIMEOUT=8,gt.HTTP_ERROR=6,kt.COMPLETE="complete",xt.EventType=Zt,Zt.OPEN="a",Zt.CLOSE="b",Zt.ERROR="c",Zt.MESSAGE="d",Fe.prototype.listen=Fe.prototype.N,Pn.prototype.listenOnce=Pn.prototype.O,Pn.prototype.getLastError=Pn.prototype.La,Pn.prototype.getLastErrorCode=Pn.prototype.Da,Pn.prototype.getStatus=Pn.prototype.ba,Pn.prototype.getResponseJson=Pn.prototype.Qa,Pn.prototype.getResponseText=Pn.prototype.ga,Pn.prototype.send=Pn.prototype.ea;var Er=x.createWebChannelTransport=function(){return new wr},Tr=x.getStatEventTarget=function(){return ht()},Sr=x.ErrorCode=gt,_r=x.EventType=kt,Dr=x.Event=ct,Ar=x.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Cr=x.FetchXmlHttpFactory=Nn,Nr=x.WebChannel=xt,Rr=x.XhrIo=Pn,Mr="@firebase/firestore",Vr=function(){function e(t){(0,s.Z)(this,e),this.uid=t}return(0,c.Z)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();Vr.UNAUTHENTICATED=new Vr(null),Vr.GOOGLE_CREDENTIALS=new Vr("google-credentials-uid"),Vr.FIRST_PARTY=new Vr("first-party-uid"),Vr.MOCK_USER=new Vr("mock-user");var Lr="9.9.0",Or=new k.Yd("@firebase/firestore");function Fr(){return Or.logLevel}function Pr(e){if(Or.logLevel<=k.in.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(qr);Or.debug.apply(Or,["Firestore (".concat(Lr,"): ").concat(e)].concat((0,p.Z)(i)))}}function Ur(e){if(Or.logLevel<=k.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(qr);Or.error.apply(Or,["Firestore (".concat(Lr,"): ").concat(e)].concat((0,p.Z)(i)))}}function Br(e){if(Or.logLevel<=k.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(qr);Or.warn.apply(Or,["Firestore (".concat(Lr,"): ").concat(e)].concat((0,p.Z)(i)))}}function qr(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Kr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(Lr,") INTERNAL ASSERTION FAILED: ")+e;throw Ur(t),new Error(t)}function Gr(e,t){e||Kr()}function jr(e,t){return e}var zr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Qr=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this,e,r)).code=e,i.message=r,i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return(0,c.Z)(n)}(w.ZR),Hr=(0,c.Z)((function e(){var t=this;(0,s.Z)(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),Wr=(0,c.Z)((function e(t,n){(0,s.Z)(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))})),Xr=function(){function e(){(0,s.Z)(this,e)}return(0,c.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Vr.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),Yr=function(){function e(t){(0,s.Z)(this,e),this.token=t,this.changeListener=null}return(0,c.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),Jr=function(){function e(t){(0,s.Z)(this,e),this.t=t,this.currentUser=Vr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return(0,c.Z)(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new Hr;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new Hr,e.enqueueRetryable((function(){return i(n.currentUser)}))};var u=function(){var t=a;e.enqueueRetryable((0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},o=function(e){Pr("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),u()};this.t.onInit((function(e){return o(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?o(e):(Pr("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Hr)}}),0),u()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(Pr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(Gr("string"==typeof n.accessToken),new Wr(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return Gr(null===e||"string"==typeof e),new Vr(e)}}]),e}(),$r=(0,c.Z)((function e(t,n,r){(0,s.Z)(this,e),this.type="FirstParty",this.user=Vr.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",n);var i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)})),ei=function(){function e(t,n,r){(0,s.Z)(this,e),this.h=t,this.l=n,this.m=r}return(0,c.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new $r(this.h,this.l,this.m))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Vr.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),ti=(0,c.Z)((function e(t){(0,s.Z)(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)})),ni=function(){function e(t){(0,s.Z)(this,e),this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}return(0,c.Z)(e,[{key:"start",value:function(e,t){var n=this,r=function(e){null!=e.error&&Pr("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.p;return n.p=e.token,Pr("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable((function(){return r(t)}))};var i=function(e){Pr("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.g.onInit((function(e){return i(e)})),setTimeout((function(){if(!n.appCheck){var e=n.g.getImmediate({optional:!0});e?i(e):Pr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((function(t){return t?(Gr("string"==typeof t.token),e.p=t.token,new ti(t.token)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}();function ri(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var ii=function(){function e(){(0,s.Z)(this,e)}return(0,c.Z)(e,null,[{key:"I",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=ri(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function ai(e,t){return e<t?-1:e>t?1:0}function ui(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}function oi(e){return e+"\0"}var si=function(){function e(t,n){if((0,s.Z)(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new Qr(zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Qr(zr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new Qr(zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Qr(zr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return(0,c.Z)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?ai(this.nanoseconds,e.nanoseconds):ai(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),ci=function(){function e(t){(0,s.Z)(this,e),this.timestamp=t}return(0,c.Z)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new si(0,0))}},{key:"max",value:function(){return new e(new si(253402300799,999999999))}}]),e}(),li=function(){function e(t,n,r){(0,s.Z)(this,e),void 0===n?n=0:n>t.length&&Kr(),void 0===r?r=t.length-n:r>t.length-n&&Kr(),this.segments=t,this.offset=n,this.len=r}return(0,c.Z)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),hi=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,u=r;a<u.length;a++){var o=u[a];if(o.indexOf("//")>=0)throw new Qr(zr.INVALID_ARGUMENT,"Invalid segment (".concat(o,"). Paths must not contain // in them."));e.push.apply(e,(0,p.Z)(o.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(li),fi=/^[_a-zA-Z][_a-zA-Z0-9]*$/,di=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return fi.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new Qr(zr.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},u=!1;i<e.length;){var o=e[i];if("\\"===o){if(i+1===e.length)throw new Qr(zr.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[i+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new Qr(zr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=s,i+=2}else"`"===o?(u=!u,i++):"."!==o||u?(r+=o,i++):(a(),i++)}if(a(),u)throw new Qr(zr.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(li),vi=function(){function e(t){(0,s.Z)(this,e),this.path=t}return(0,c.Z)(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===hi.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(hi.fromString(t))}},{key:"fromName",value:function(t){return new e(hi.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e(hi.emptyPath())}},{key:"comparator",value:function(e,t){return hi.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new hi(t.slice()))}}]),e}(),yi=(0,c.Z)((function e(t,n,r,i){(0,s.Z)(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=i}));function pi(e){return e.fields.find((function(e){return 2===e.kind}))}function mi(e){return e.fields.filter((function(e){return 2!==e.kind}))}yi.UNKNOWN_ID=-1;var gi=(0,c.Z)((function e(t,n){(0,s.Z)(this,e),this.fieldPath=t,this.kind=n})),ki=function(){function e(t,n){(0,s.Z)(this,e),this.sequenceNumber=t,this.offset=n}return(0,c.Z)(e,null,[{key:"empty",value:function(){return new e(0,xi.min())}}]),e}();function wi(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=ci.fromTimestamp(1e9===r?new si(n+1,0):new si(n,r));return new xi(i,vi.empty(),t)}function bi(e){return new xi(e.readTime,e.key,-1)}var xi=function(){function e(t,n,r){(0,s.Z)(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return(0,c.Z)(e,null,[{key:"min",value:function(){return new e(ci.min(),vi.empty(),-1)}},{key:"max",value:function(){return new e(ci.max(),vi.empty(),-1)}}]),e}();function Ii(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=vi.comparator(e.documentKey,t.documentKey))?n:ai(e.largestBatchId,t.largestBatchId)}var Zi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Ei=function(){function e(){(0,s.Z)(this,e),this.onCommittedListeners=[]}return(0,c.Z)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}();function Ti(e){return Si.apply(this,arguments)}function Si(){return Si=(0,y.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===zr.FAILED_PRECONDITION&&t.message===Zi){e.next=2;break}throw t;case 2:Pr("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)}))),Si.apply(this,arguments)}var _i=function(){function e(t){var n=this;(0,s.Z)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return(0,c.Z)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&Kr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=(0,o.Z)(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}},{key:"mapArray",value:function(t,n){return new e((function(e,r){for(var i=t.length,a=new Array(i),u=0,o=function(o){var s=o;n(t[s]).next((function(t){a[s]=t,++u===i&&e(a)}),(function(e){return r(e)}))},s=0;s<i;s++)o(s)}))}},{key:"doWhile",value:function(t,n){return new e((function(e,r){!function i(){!0===t()?n().next((function(){i()}),r):e()}()}))}}]),e}(),Di=function(){function e(t,n){var r=this;(0,s.Z)(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.T=new Hr,this.transaction.oncomplete=function(){r.T.resolve()},this.transaction.onabort=function(){n.error?r.T.reject(new Ni(t,n.error)):r.T.resolve()},this.transaction.onerror=function(e){var n=Oi(e.target.error);r.T.reject(new Ni(t,n))}}return(0,c.Z)(e,[{key:"A",get:function(){return this.T.promise}},{key:"abort",value:function(e){e&&this.T.reject(e),this.aborted||(Pr("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"R",value:function(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new Mi(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new Ni(n,t)}}}]),e}(),Ai=function(){function e(t,n,r){(0,s.Z)(this,e),this.name=t,this.version=n,this.P=r,12.2===e.v((0,w.z$)())&&Ur("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return(0,c.Z)(e,[{key:"k",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){var n=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return Pr("SimpleDb","Opening database:",this.name),e.next=5,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new Ni(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new Qr(zr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new Qr(zr.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new Ni(t,n))},i.onupgradeneeded=function(e){Pr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.P.O(t,i.transaction,e.oldVersion,n.version).next((function(){Pr("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}));case 5:this.db=e.sent;case 6:return this.M&&(this.db.onversionchange=function(e){return n.M(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"F",value:function(e){this.M=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n,r,i){var a,u,o,s,c,l=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,u=0;case 2:return++u,e.prev=3,e.delegateYield((0,v.Z)().mark((function e(){var n,u;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.k(t);case 2:return l.db=e.sent,n=Di.open(l.db,t,a?"readonly":"readwrite",r),u=i(n).next((function(e){return n.R(),e})).catch((function(e){return n.abort(e),_i.reject(e)})).toPromise(),u.catch((function(){})),e.next=7,n.A;case 7:return e.t0=u,e.abrupt("return",{v:e.t0});case 9:case"end":return e.stop()}}),e)}))(),"t0",5);case 5:if("object"!==typeof(o=e.t0)){e.next=8;break}return e.abrupt("return",o.v);case 8:e.next=15;break;case 10:if(e.prev=10,e.t1=e.catch(3),s=e.t1,c="FirebaseError"!==s.name&&u<3,Pr("SimpleDb","Transaction failed with error:",s.message,"Retrying:",c),this.close(),c){e.next=15;break}return e.abrupt("return",Promise.reject(s));case 15:e.next=2;break;case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return Pr("SimpleDb","Removing database:",e),Vi(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"V",value:function(){if(!(0,w.hl)())return!1;if(e.S())return!0;var t=(0,w.z$)(),n=e.v(t),r=0<n&&n<10,i=e.D(t),a=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||a)}},{key:"S",value:function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API:"http://localhost:8000/api",REACT_APP_FORGOT_PASSWORD_REDIRECT:"http://localhost:3000/login",REACT_APP_REGISTER_REDIRECT_URL:"http://localhost:3000/register/complete",REACT_APP_STRIPE_KEY:"pk_test_51Ls8XUSJeyosVqgaz8GU12WmErKJWPz3w8zKB97M6cv0mmZoYNadG0GXGDgmynIVQGSjQMahjmDMLQJqqZwvqa0K00PgZ3o2XN"})||void 0===e?void 0:e.C)}},{key:"N",value:function(e,t){return e.store(t)}},{key:"v",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"D",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),e}(),Ci=function(){function e(t){(0,s.Z)(this,e),this.$=t,this.B=!1,this.L=null}return(0,c.Z)(e,[{key:"isDone",get:function(){return this.B}},{key:"U",get:function(){return this.L}},{key:"cursor",set:function(e){this.$=e}},{key:"done",value:function(){this.B=!0}},{key:"q",value:function(e){this.L=e}},{key:"delete",value:function(){return Vi(this.$.delete())}}]),e}(),Ni=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this,zr.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return(0,c.Z)(n)}(Qr);function Ri(e){return"IndexedDbTransactionError"===e.name}var Mi=function(){function e(t){(0,s.Z)(this,e),this.store=t}return(0,c.Z)(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(Pr("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Pr("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Vi(n)}},{key:"add",value:function(e){return Pr("SimpleDb","ADD",this.store.name,e,e),Vi(this.store.add(e))}},{key:"get",value:function(e){var t=this;return Vi(this.store.get(e)).next((function(n){return void 0===n&&(n=null),Pr("SimpleDb","GET",t.store.name,e,n),n}))}},{key:"delete",value:function(e){return Pr("SimpleDb","DELETE",this.store.name,e),Vi(this.store.delete(e))}},{key:"count",value:function(){return Pr("SimpleDb","COUNT",this.store.name),Vi(this.store.count())}},{key:"K",value:function(e,t){var n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){var r=this.cursor(n),i=[];return this.G(r,(function(e,t){i.push(t)})).next((function(){return i}))}var a=this.store.getAll(n.range);return new _i((function(e,t){a.onerror=function(e){t(e.target.error)},a.onsuccess=function(t){e(t.target.result)}}))}},{key:"j",value:function(e,t){var n=this.store.getAll(e,null===t?void 0:t);return new _i((function(e,t){n.onerror=function(e){t(e.target.error)},n.onsuccess=function(t){e(t.target.result)}}))}},{key:"W",value:function(e,t){Pr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.H=!1;var r=this.cursor(n);return this.G(r,(function(e,t,n){return n.delete()}))}},{key:"J",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.G(r,t)}},{key:"Y",value:function(e){var t=this.cursor({});return new _i((function(n,r){t.onerror=function(e){var t=Oi(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next((function(e){e?r.continue():n()})):n()}}))}},{key:"G",value:function(e,t){var n=[];return new _i((function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new Ci(i),u=t(i.primaryKey,i.value,a);if(u instanceof _i){var o=u.catch((function(e){return a.done(),_i.reject(e)}));n.push(o)}a.isDone?r():null===a.U?i.continue():i.continue(a.U)}else r()}})).next((function(){return _i.waitFor(n)}))}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function Vi(e){return new _i((function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=Oi(e.target.error);n(t)}}))}var Li=!1;function Oi(e){var t=Ai.v((0,w.z$)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new Qr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return Li||(Li=!0,setTimeout((function(){throw r}),0)),r}}return e}var Fi=function(){function e(t,n){(0,s.Z)(this,e),this.asyncQueue=t,this.X=n,this.task=null}return(0,c.Z)(e,[{key:"start",value:function(){}},{key:"stop",value:function(){this.task&&(this.task.cancel(),this.task=null)}},{key:"started",get:function(){return null!==this.task}},{key:"Z",value:function(e){var t=this;Pr("IndexBackiller","Scheduled in ".concat(e,"ms")),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.task=null,e.prev=1,e.t0=Pr,e.t1="Documents written: ",e.next=6,t.X.tt();case 6:e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),(0,e.t0)("IndexBackiller",e.t3),e.next=19;break;case 11:if(e.prev=11,e.t4=e.catch(1),!Ri(e.t4)){e.next=17;break}Pr("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e.t4),e.next=19;break;case 17:return e.next=19,Ti(e.t4);case 19:return e.next=21,t.Z(1);case 21:case"end":return e.stop()}}),e,null,[[1,11]])}))))}}]),e}(),Pi=function(){function e(t,n){(0,s.Z)(this,e),this.localStore=t,this.persistence=n}return(0,c.Z)(e,[{key:"tt",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t,n=this,r=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:50,e.abrupt("return",this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(function(e){return n.et(e,t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"et",value:function(e,t){var n=this,r=new Set,i=t,a=!0;return _i.doWhile((function(){return!0===a&&i>0}),(function(){return n.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((function(t){if(null!==t&&!r.has(t))return Pr("IndexBackiller","Processing collection: ".concat(t)),n.nt(e,t,i).next((function(e){i-=e,r.add(t)}));a=!1}))})).next((function(){return t-i}))}},{key:"nt",value:function(e,t,n){var r=this;return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((function(i){return r.localStore.localDocuments.getNextDocuments(e,t,i,n).next((function(n){var a=n.changes;return r.localStore.indexManager.updateIndexEntries(e,a).next((function(){return r.st(i,n)})).next((function(n){return Pr("IndexBackiller","Updating offset: ".concat(n)),r.localStore.indexManager.updateCollectionGroup(e,t,n)})).next((function(){return a.size}))}))}))}},{key:"st",value:function(e,t){var n=e;return t.changes.forEach((function(e,t){var r=bi(t);Ii(r,n)>0&&(n=r)})),new xi(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}]),e}(),Ui=function(){function e(t,n){var r=this;(0,s.Z)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.it(e)},this.rt=function(e){return n.writeSequenceNumber(e)})}return(0,c.Z)(e,[{key:"it",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.rt&&this.rt(e),e}}]),e}();function Bi(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function qi(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Ki(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}Ui.ot=-1;var Gi=function(){function e(t,n){(0,s.Z)(this,e),this.comparator=t,this.root=n||zi.EMPTY}return(0,c.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,zi.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,zi.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new ji(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new ji(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new ji(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new ji(this.root,e,this.comparator,!0)}}]),e}(),ji=function(){function e(t,n,r,i){(0,s.Z)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,n&&i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return(0,c.Z)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),zi=function(){function e(t,n,r,i,a){(0,s.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return(0,c.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw Kr();if(this.right.isRed())throw Kr();var e=this.left.check();if(e!==this.right.check())throw Kr();return e+(this.isRed()?0:1)}}]),e}();zi.EMPTY=null,zi.RED=!0,zi.BLACK=!1,zi.EMPTY=new(function(){function e(){(0,s.Z)(this,e),this.size=0}return(0,c.Z)(e,[{key:"key",get:function(){throw Kr()}},{key:"value",get:function(){throw Kr()}},{key:"color",get:function(){throw Kr()}},{key:"left",get:function(){throw Kr()}},{key:"right",get:function(){throw Kr()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new zi(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var Qi=function(){function e(t){(0,s.Z)(this,e),this.comparator=t,this.data=new Gi(this.comparator)}return(0,c.Z)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new Hi(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new Hi(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),Hi=function(){function e(t){(0,s.Z)(this,e),this.iter=t}return(0,c.Z)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}();function Wi(e){return e.hasNext()?e.getNext():void 0}var Xi=function(){function e(t){(0,s.Z)(this,e),this.fields=t,t.sort(di.comparator)}return(0,c.Z)(e,[{key:"unionWith",value:function(t){var n,r=new Qi(di.comparator),i=(0,o.Z)(this.fields);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=r.add(a)}}catch(l){i.e(l)}finally{i.f()}var u,s=(0,o.Z)(t);try{for(s.s();!(u=s.n()).done;){var c=u.value;r=r.add(c)}}catch(l){s.e(l)}finally{s.f()}return new e(r.toArray())}},{key:"covers",value:function(e){var t,n=(0,o.Z)(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return ui(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}],[{key:"empty",value:function(){return new e([])}}]),e}();var Yi=function(e){function t(e){(0,s.Z)(this,t),this.binaryString=e}return(0,c.Z)(t,[{key:e,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return ai(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){return new t(atob(e))}},{key:"fromUint8Array",value:function(e){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new t(n)}}]),t}(Symbol.iterator);Yi.EMPTY_BYTE_STRING=new Yi("");var Ji=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function $i(e){if(Gr(!!e),"string"==typeof e){var t=0,n=Ji.exec(e);if(Gr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:ea(e.seconds),nanos:ea(e.nanos)}}function ea(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function ta(e){return"string"==typeof e?Yi.fromBase64String(e):Yi.fromUint8Array(e)}function na(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ra(e){var t=e.mapValue.fields.__previous_value__;return na(t)?ra(t):t}function ia(e){var t=$i(e.mapValue.fields.__local_write_time__.timestampValue);return new si(t.seconds,t.nanos)}var aa=(0,c.Z)((function e(t,n,r,i,a,u,o,c){(0,s.Z)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=u,this.autoDetectLongPolling=o,this.useFetchStreams=c})),ua=function(){function e(t,n){(0,s.Z)(this,e),this.projectId=t,this.database=n||"(default)"}return(0,c.Z)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}();function oa(e){return null==e}function sa(e){return 0===e&&1/e==-1/0}function ca(e){return"number"==typeof e&&Number.isInteger(e)&&!sa(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var la={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},ha={nullValue:"NULL_VALUE"};function fa(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?na(e)?4:Ta(e)?9007199254740991:10:Kr()}function da(e,t){if(e===t)return!0;var n=fa(e);if(n!==fa(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ia(e).isEqual(ia(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=$i(e.timestampValue),r=$i(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return ta(e.bytesValue).isEqual(ta(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return ea(e.geoPointValue.latitude)===ea(t.geoPointValue.latitude)&&ea(e.geoPointValue.longitude)===ea(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return ea(e.integerValue)===ea(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=ea(e.doubleValue),r=ea(t.doubleValue);return n===r?sa(n)===sa(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ui(e.arrayValue.values||[],t.arrayValue.values||[],da);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Bi(n)!==Bi(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!da(n[i],r[i])))return!1;return!0}(e,t);default:return Kr()}}function va(e,t){return void 0!==(e.values||[]).find((function(e){return da(e,t)}))}function ya(e,t){if(e===t)return 0;var n=fa(e),r=fa(t);if(n!==r)return ai(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ai(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=ea(e.integerValue||e.doubleValue),r=ea(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return pa(e.timestampValue,t.timestampValue);case 4:return pa(ia(e),ia(t));case 5:return ai(e.stringValue,t.stringValue);case 6:return function(e,t){var n=ta(e),r=ta(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=ai(n[i],r[i]);if(0!==a)return a}return ai(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=ai(ea(e.latitude),ea(t.latitude));return 0!==n?n:ai(ea(e.longitude),ea(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=ya(n[i],r[i]);if(a)return a}return ai(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===la.mapValue&&t===la.mapValue)return 0;if(e===la.mapValue)return 1;if(t===la.mapValue)return-1;var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var u=0;u<r.length&&u<a.length;++u){var o=ai(r[u],a[u]);if(0!==o)return o;var s=ya(n[r[u]],i[a[u]]);if(0!==s)return s}return ai(r.length,a.length)}(e.mapValue,t.mapValue);default:throw Kr()}}function pa(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return ai(e,t);var n=$i(e),r=$i(t),i=ai(n.seconds,r.seconds);return 0!==i?i:ai(n.nanos,r.nanos)}function ma(e){return ga(e)}function ga(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=$i(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?ta(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,vi.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=(0,o.Z)(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=ga(a)}}catch(u){i.e(u)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n=Object.keys(e.fields||{}).sort(),r="{",i=!0,a=(0,o.Z)(n);try{for(a.s();!(t=a.n()).done;){var u=t.value;i?i=!1:r+=",",r+="".concat(u,":").concat(ga(e.fields[u]))}}catch(s){a.e(s)}finally{a.f()}return r+"}"}(e.mapValue):Kr();var t,n}function ka(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function wa(e){return!!e&&"integerValue"in e}function ba(e){return!!e&&"arrayValue"in e}function xa(e){return!!e&&"nullValue"in e}function Ia(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Za(e){return!!e&&"mapValue"in e}function Ea(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return qi(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=Ea(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Ea(e.arrayValue.values[r]);return n}return Object.assign({},e)}function Ta(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Sa(e){return"nullValue"in e?ha:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?ka(ua.empty(),vi.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Kr()}function _a(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?ka(ua.empty(),vi.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?la:Kr()}function Da(e,t){var n=ya(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Aa(e,t){var n=ya(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}var Ca=function(){function e(t){(0,s.Z)(this,e),this.value=t}return(0,c.Z)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!Za(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ea(t)}},{key:"setAll",value:function(e){var t=this,n=di.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var u=t.getFieldsMap(n);t.applyChanges(u,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Ea(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());Za(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return da(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];Za(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){qi(t,(function(t,n){return e[t]=n}));var r,i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(u){i.e(u)}finally{i.f()}}},{key:"clone",value:function(){return new e(Ea(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function Na(e){var t=[];return qi(e.fields,(function(e,n){var r=new di([e]);if(Za(n)){var i=Na(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,u=(0,o.Z)(i);try{for(u.s();!(a=u.n()).done;){var s=a.value;t.push(r.child(s))}}catch(c){u.e(c)}finally{u.f()}}}else t.push(r)})),new Xi(t)}var Ra=function(){function e(t,n,r,i,a,u){(0,s.Z)(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=i,this.data=a,this.documentState=u}return(0,c.Z)(e,[{key:"convertToFoundDocument",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=Ca.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=Ca.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=ci.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,ci.min(),ci.min(),Ca.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r){return new e(t,1,n,ci.min(),r,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,ci.min(),Ca.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,ci.min(),Ca.empty(),2)}}]),e}(),Ma=(0,c.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;(0,s.Z)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=u,this.endAt=o,this.ut=null}));function Va(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new Ma(e,t,n,r,i,a,u)}function La(e){var t=jr(e);if(null===t.ut){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return(t=e).field.canonicalString()+t.op.toString()+ma(t.value);var t})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),oa(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((function(e){return ma(e)})).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((function(e){return ma(e)})).join(",")),t.ut=n}return t.ut}function Oa(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!$a(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],a=t.filters[r],i.op!==a.op||!i.field.isEqual(a.field)||!da(i.value,a.value))return!1;var i,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!tu(e.startAt,t.startAt)&&tu(e.endAt,t.endAt)}function Fa(e){return vi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Pa(e,t){return e.filters.filter((function(e){return e instanceof qa&&e.field.isEqual(t)}))}function Ua(e,t,n){var r,i=ha,a=!0,u=(0,o.Z)(Pa(e,t));try{for(u.s();!(r=u.n()).done;){var s=r.value,c=ha,l=!0;switch(s.op){case"<":case"<=":c=Sa(s.value);break;case"==":case"in":case">=":c=s.value;break;case">":c=s.value,l=!1;break;case"!=":case"not-in":c=ha}Da({value:i,inclusive:a},{value:c,inclusive:l})<0&&(i=c,a=l)}}catch(d){u.e(d)}finally{u.f()}if(null!==n)for(var h=0;h<e.orderBy.length;++h)if(e.orderBy[h].field.isEqual(t)){var f=n.position[h];Da({value:i,inclusive:a},{value:f,inclusive:n.inclusive})<0&&(i=f,a=n.inclusive);break}return{value:i,inclusive:a}}function Ba(e,t,n){var r,i=la,a=!0,u=(0,o.Z)(Pa(e,t));try{for(u.s();!(r=u.n()).done;){var s=r.value,c=la,l=!0;switch(s.op){case">=":case">":c=_a(s.value),l=!1;break;case"==":case"in":case"<=":c=s.value;break;case"<":c=s.value,l=!1;break;case"!=":case"not-in":c=la}Aa({value:i,inclusive:a},{value:c,inclusive:l})>0&&(i=c,a=l)}}catch(d){u.e(d)}finally{u.f()}if(null!==n)for(var h=0;h<e.orderBy.length;++h)if(e.orderBy[h].field.isEqual(t)){var f=n.position[h];Aa({value:i,inclusive:a},{value:f,inclusive:n.inclusive})>0&&(i=f,a=n.inclusive);break}return{value:i,inclusive:a}}var qa=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a;return(0,s.Z)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return(0,c.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.at(ya(t,this.value)):null!==t&&fa(this.value)===fa(t)&&this.at(ya(t,this.value))}},{key:"at",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Kr()}}},{key:"ht",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.ct(e,t,r):new Ka(e,t,r):"array-contains"===t?new Qa(e,r):"in"===t?new Ha(e,r):"not-in"===t?new Wa(e,r):"array-contains-any"===t?new Xa(e,r):new n(e,t,r)}},{key:"ct",value:function(e,t,n){return"in"===t?new Ga(e,n):new ja(e,n)}}]),n}(function(){return(0,c.Z)((function e(){(0,s.Z)(this,e)}))}()),Ka=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a;return(0,s.Z)(this,n),(a=t.call(this,e,r,i)).key=vi.fromName(i.referenceValue),a}return(0,c.Z)(n,[{key:"matches",value:function(e){var t=vi.comparator(e.key,this.key);return this.at(t)}}]),n}(qa),Ga=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this,e,"in",r)).keys=za("in",r),i}return(0,c.Z)(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(qa),ja=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this,e,"not-in",r)).keys=za("not-in",r),i}return(0,c.Z)(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(qa);function za(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return vi.fromName(e.referenceValue)}))}var Qa=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){return(0,s.Z)(this,n),t.call(this,e,"array-contains",r)}return(0,c.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return ba(t)&&va(t.arrayValue,this.value)}}]),n}(qa),Ha=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){return(0,s.Z)(this,n),t.call(this,e,"in",r)}return(0,c.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&va(this.value.arrayValue,t)}}]),n}(qa),Wa=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){return(0,s.Z)(this,n),t.call(this,e,"not-in",r)}return(0,c.Z)(n,[{key:"matches",value:function(e){if(va(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!va(this.value.arrayValue,t)}}]),n}(qa),Xa=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){return(0,s.Z)(this,n),t.call(this,e,"array-contains-any",r)}return(0,c.Z)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!ba(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return va(t.value.arrayValue,e)}))}}]),n}(qa),Ya=(0,c.Z)((function e(t,n){(0,s.Z)(this,e),this.position=t,this.inclusive=n})),Ja=(0,c.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";(0,s.Z)(this,e),this.field=t,this.dir=n}));function $a(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function eu(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],u=e.position[i];if(r=a.field.isKeyField()?vi.comparator(vi.fromName(u.referenceValue),n.key):ya(u,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return r}function tu(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!da(e.position[n],t.position[n]))return!1;return!0}var nu=(0,c.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,s.Z)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=u,this.startAt=o,this.endAt=c,this.lt=null,this.ft=null,this.startAt,this.endAt}));function ru(e,t,n,r,i,a,u,o){return new nu(e,t,n,r,i,a,u,o)}function iu(e){return new nu(e)}function au(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function uu(e){var t,n=(0,o.Z)(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.ht())return r.field}}catch(i){n.e(i)}finally{n.f()}return null}function ou(e){return null!==e.collectionGroup}function su(e){var t=jr(e);if(null===t.lt){t.lt=[];var n=uu(t),r=au(t);if(null!==n&&null===r)n.isKeyField()||t.lt.push(new Ja(n)),t.lt.push(new Ja(di.keyField(),"asc"));else{var i,a=!1,u=(0,o.Z)(t.explicitOrderBy);try{for(u.s();!(i=u.n()).done;){var s=i.value;t.lt.push(s),s.field.isKeyField()&&(a=!0)}}catch(l){u.e(l)}finally{u.f()}if(!a){var c=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.lt.push(new Ja(di.keyField(),c))}}}return t.lt}function cu(e){var t=jr(e);if(!t.ft)if("F"===t.limitType)t.ft=Va(t.path,t.collectionGroup,su(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=(0,o.Z)(su(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,u="desc"===a.dir?"asc":"desc";r.push(new Ja(a.field,u))}}catch(l){i.e(l)}finally{i.f()}var s=t.endAt?new Ya(t.endAt.position,t.endAt.inclusive):null,c=t.startAt?new Ya(t.startAt.position,t.startAt.inclusive):null;t.ft=Va(t.path,t.collectionGroup,r,t.filters,t.limit,s,c)}return t.ft}function lu(e,t,n){return new nu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function hu(e,t){return Oa(cu(e),cu(t))&&e.limitType===t.limitType}function fu(e){return"".concat(La(cu(e)),"|lt:").concat(e.limitType)}function du(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return"".concat((t=e).field.canonicalString()," ").concat(t.op," ").concat(ma(t.value));var t})).join(", "),"]")),oa(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((function(e){return ma(e)})).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((function(e){return ma(e)})).join(",")),"Target(".concat(t,")")}(cu(e)),"; limitType=").concat(e.limitType,")")}function vu(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):vi.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=(0,o.Z)(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=(0,o.Z)(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){var r=eu(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,su(e),t))&&!(e.endAt&&!function(e,t,n){var r=eu(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,su(e),t))}(e,t)}function yu(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function pu(e){return function(t,n){var r,i=!1,a=(0,o.Z)(su(e));try{for(a.s();!(r=a.n()).done;){var u=r.value,s=mu(u,t,n);if(0!==s)return s;i=i||u.field.isKeyField()}}catch(c){a.e(c)}finally{a.f()}return 0}}function mu(e,t,n){var r=e.field.isKeyField()?vi.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?ya(r,i):Kr()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Kr()}}function gu(e,t){if(e.dt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sa(t)?"-0":t}}function ku(e){return{integerValue:""+e}}function wu(e,t){return ca(t)?ku(t):gu(e,t)}var bu=(0,c.Z)((function e(){(0,s.Z)(this,e),this._=void 0}));function xu(e,t,n){return e instanceof Eu?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Tu?Su(e,t):e instanceof _u?Du(e,t):function(e,t){var n=Zu(e,t),r=Cu(n)+Cu(e._t);return wa(n)&&wa(e._t)?ku(r):gu(e.wt,r)}(e,t)}function Iu(e,t,n){return e instanceof Tu?Su(e,t):e instanceof _u?Du(e,t):n}function Zu(e,t){return e instanceof Au?wa(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}var Eu=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n)}(bu),Tu=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,c.Z)(n)}(bu);function Su(e,t){var n,r=Nu(t),i=(0,o.Z)(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return da(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var _u=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,c.Z)(n)}(bu);function Du(e,t){var n,r=Nu(t),i=(0,o.Z)(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!da(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Au=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this)).wt=e,i._t=r,i}return(0,c.Z)(n)}(bu);function Cu(e){return ea(e.integerValue||e.doubleValue)}function Nu(e){return ba(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Ru=(0,c.Z)((function e(t,n){(0,s.Z)(this,e),this.field=t,this.transform=n}));var Mu=(0,c.Z)((function e(t,n){(0,s.Z)(this,e),this.version=t,this.transformResults=n})),Vu=function(){function e(t,n){(0,s.Z)(this,e),this.updateTime=t,this.exists=n}return(0,c.Z)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function Lu(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Ou=(0,c.Z)((function e(){(0,s.Z)(this,e)}));function Fu(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Xu(e.key,Vu.none()):new Ku(e.key,e.data,Vu.none());var n,r=e.data,i=Ca.empty(),a=new Qi(di.comparator),u=(0,o.Z)(t.fields);try{for(u.s();!(n=u.n()).done;){var s=n.value;if(!a.has(s)){var c=r.field(s);null===c&&s.length>1&&(s=s.popLast(),c=r.field(s)),null===c?i.delete(s):i.set(s,c),a=a.add(s)}}}catch(l){u.e(l)}finally{u.f()}return new Gu(e.key,i,new Xi(a.toArray()),Vu.none())}function Pu(e,t,n){e instanceof Ku?function(e,t,n){var r=e.value.clone(),i=zu(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Gu?function(e,t,n){if(Lu(e.precondition,t)){var r=zu(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ju(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Uu(e,t,n,r){return e instanceof Ku?function(e,t,n,r){if(!Lu(e.precondition,t))return n;var i=e.value.clone(),a=Qu(e.fieldTransforms,r,t);return i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof Gu?function(e,t,n,r){if(!Lu(e.precondition,t))return n;var i=Qu(e.fieldTransforms,r,t),a=t.data;return a.setAll(ju(e)),a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((function(e){return e.field})))}(e,t,n,r):function(e,t,n){return Lu(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Bu(e,t){var n,r=null,i=(0,o.Z)(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.field),s=Zu(a.transform,u||null);null!=s&&(null===r&&(r=Ca.empty()),r.set(a.field,s))}}catch(c){i.e(c)}finally{i.f()}return r||null}function qu(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ui(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Tu&&t instanceof Tu||e instanceof _u&&t instanceof _u?ui(e.elements,t.elements,da):e instanceof Au&&t instanceof Au?da(e._t,t._t):e instanceof Eu&&t instanceof Eu}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var Ku=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,s.Z)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=u,a.type=0,a}return(0,c.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Ou),Gu=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,a){var u,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return(0,s.Z)(this,n),(u=t.call(this)).key=e,u.data=r,u.fieldMask=i,u.precondition=a,u.fieldTransforms=o,u.type=1,u}return(0,c.Z)(n,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),n}(Ou);function ju(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function zu(e,t,n){var r=new Map;Gr(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],u=a.transform,o=t.data.field(a.field);r.set(a.field,Iu(u,o,n[i]))}return r}function Qu(e,t,n){var r,i=new Map,a=(0,o.Z)(e);try{for(a.s();!(r=a.n()).done;){var u=r.value,s=u.transform,c=n.data.field(u.field);i.set(u.field,xu(s,c,t))}}catch(l){a.e(l)}finally{a.f()}return i}var Hu,Wu,Xu=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return(0,c.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Ou),Yu=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return(0,c.Z)(n,[{key:"getFieldMask",value:function(){return null}}]),n}(Ou),Ju=(0,c.Z)((function e(t){(0,s.Z)(this,e),this.count=t}));function $u(e){switch(e){default:return Kr();case zr.CANCELLED:case zr.UNKNOWN:case zr.DEADLINE_EXCEEDED:case zr.RESOURCE_EXHAUSTED:case zr.INTERNAL:case zr.UNAVAILABLE:case zr.UNAUTHENTICATED:return!1;case zr.INVALID_ARGUMENT:case zr.NOT_FOUND:case zr.ALREADY_EXISTS:case zr.PERMISSION_DENIED:case zr.FAILED_PRECONDITION:case zr.ABORTED:case zr.OUT_OF_RANGE:case zr.UNIMPLEMENTED:case zr.DATA_LOSS:return!0}}function eo(e){if(void 0===e)return Ur("GRPC error has no .code"),zr.UNKNOWN;switch(e){case Hu.OK:return zr.OK;case Hu.CANCELLED:return zr.CANCELLED;case Hu.UNKNOWN:return zr.UNKNOWN;case Hu.DEADLINE_EXCEEDED:return zr.DEADLINE_EXCEEDED;case Hu.RESOURCE_EXHAUSTED:return zr.RESOURCE_EXHAUSTED;case Hu.INTERNAL:return zr.INTERNAL;case Hu.UNAVAILABLE:return zr.UNAVAILABLE;case Hu.UNAUTHENTICATED:return zr.UNAUTHENTICATED;case Hu.INVALID_ARGUMENT:return zr.INVALID_ARGUMENT;case Hu.NOT_FOUND:return zr.NOT_FOUND;case Hu.ALREADY_EXISTS:return zr.ALREADY_EXISTS;case Hu.PERMISSION_DENIED:return zr.PERMISSION_DENIED;case Hu.FAILED_PRECONDITION:return zr.FAILED_PRECONDITION;case Hu.ABORTED:return zr.ABORTED;case Hu.OUT_OF_RANGE:return zr.OUT_OF_RANGE;case Hu.UNIMPLEMENTED:return zr.UNIMPLEMENTED;case Hu.DATA_LOSS:return zr.DATA_LOSS;default:return Kr()}}(Wu=Hu||(Hu={}))[Wu.OK=0]="OK",Wu[Wu.CANCELLED=1]="CANCELLED",Wu[Wu.UNKNOWN=2]="UNKNOWN",Wu[Wu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Wu[Wu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Wu[Wu.NOT_FOUND=5]="NOT_FOUND",Wu[Wu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Wu[Wu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Wu[Wu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Wu[Wu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Wu[Wu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Wu[Wu.ABORTED=10]="ABORTED",Wu[Wu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Wu[Wu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Wu[Wu.INTERNAL=13]="INTERNAL",Wu[Wu.UNAVAILABLE=14]="UNAVAILABLE",Wu[Wu.DATA_LOSS=15]="DATA_LOSS";var to=function(){function e(t,n){(0,s.Z)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return(0,c.Z)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,d.Z)(r.value,2),u=a[0],s=a[1];if(this.equalsFn(u,e))return s}}catch(c){i.e(c)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t]),this.innerSize++}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(e){qi(this.inner,(function(t,n){var r,i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=(0,d.Z)(r.value,2),u=a[0],s=a[1];e(u,s)}}catch(c){i.e(c)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return Ki(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),e}(),no=new Gi(vi.comparator);function ro(){return no}var io=new Gi(vi.comparator);function ao(){for(var e=io,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.insert(u.key,u)}return e}function uo(e){var t=io;return e.forEach((function(e,n){return t=t.insert(e,n.overlayedDocument)})),t}function oo(){return co()}function so(){return co()}function co(){return new to((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)}))}var lo=new Gi(vi.comparator),ho=new Qi(vi.comparator);function fo(){for(var e=ho,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.add(u)}return e}var vo=new Qi(ai);function yo(){return vo}var po=function(){function e(t,n,r,i,a){(0,s.Z)(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return(0,c.Z)(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n){var r=new Map;return r.set(t,mo.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(ci.min(),r,yo(),ro(),fo())}}]),e}(),mo=function(){function e(t,n,r,i,a){(0,s.Z)(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return(0,c.Z)(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n){return new e(Yi.EMPTY_BYTE_STRING,n,fo(),fo(),fo())}}]),e}(),go=(0,c.Z)((function e(t,n,r,i){(0,s.Z)(this,e),this.gt=t,this.removedTargetIds=n,this.key=r,this.yt=i})),ko=(0,c.Z)((function e(t,n){(0,s.Z)(this,e),this.targetId=t,this.It=n})),wo=(0,c.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Yi.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,s.Z)(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i})),bo=function(){function e(){(0,s.Z)(this,e),this.Tt=0,this.Et=Zo(),this.At=Yi.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}return(0,c.Z)(e,[{key:"current",get:function(){return this.Rt}},{key:"resumeToken",get:function(){return this.At}},{key:"Pt",get:function(){return 0!==this.Tt}},{key:"vt",get:function(){return this.bt}},{key:"Vt",value:function(e){e.approximateByteSize()>0&&(this.bt=!0,this.At=e)}},{key:"St",value:function(){var e=fo(),t=fo(),n=fo();return this.Et.forEach((function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Kr()}})),new mo(this.At,this.Rt,e,t,n)}},{key:"Dt",value:function(){this.bt=!1,this.Et=Zo()}},{key:"Ct",value:function(e,t){this.bt=!0,this.Et=this.Et.insert(e,t)}},{key:"xt",value:function(e){this.bt=!0,this.Et=this.Et.remove(e)}},{key:"Nt",value:function(){this.Tt+=1}},{key:"kt",value:function(){this.Tt-=1}},{key:"Ot",value:function(){this.bt=!0,this.Rt=!0}}]),e}(),xo=function(){function e(t){(0,s.Z)(this,e),this.Mt=t,this.Ft=new Map,this.$t=ro(),this.Bt=Io(),this.Lt=new Qi(ai)}return(0,c.Z)(e,[{key:"Ut",value:function(e){var t,n=(0,o.Z)(e.gt);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.yt&&e.yt.isFoundDocument()?this.qt(r,e.yt):this.Kt(r,e.key,e.yt)}}catch(s){n.e(s)}finally{n.f()}var i,a=(0,o.Z)(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var u=i.value;this.Kt(u,e.key,e.yt)}}catch(s){a.e(s)}finally{a.f()}}},{key:"Gt",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.Qt(n);switch(e.state){case 0:t.jt(n)&&r.Vt(e.resumeToken);break;case 1:r.kt(),r.Pt||r.Dt(),r.Vt(e.resumeToken);break;case 2:r.kt(),r.Pt||t.removeTarget(n);break;case 3:t.jt(n)&&(r.Ot(),r.Vt(e.resumeToken));break;case 4:t.jt(n)&&(t.Wt(n),r.Vt(e.resumeToken));break;default:Kr()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.Ft.forEach((function(e,r){n.jt(r)&&t(r)}))}},{key:"zt",value:function(e){var t=e.targetId,n=e.It.count,r=this.Ht(t);if(r){var i=r.target;if(Fa(i))if(0===n){var a=new vi(i.path);this.Kt(t,a,Ra.newNoDocument(a,ci.min()))}else Gr(1===n);else this.Jt(t)!==n&&(this.Wt(t),this.Lt=this.Lt.add(t))}}},{key:"Yt",value:function(e){var t=this,n=new Map;this.Ft.forEach((function(r,i){var a=t.Ht(i);if(a){if(r.current&&Fa(a.target)){var u=new vi(a.target.path);null!==t.$t.get(u)||t.Xt(i,u)||t.Kt(i,u,Ra.newNoDocument(u,e))}r.vt&&(n.set(i,r.St()),r.Dt())}}));var r=fo();this.Bt.forEach((function(e,n){var i=!0;n.forEachWhile((function(e){var n=t.Ht(e);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(e))})),this.$t.forEach((function(t,n){return n.setReadTime(e)}));var i=new po(e,n,this.Lt,this.$t,r);return this.$t=ro(),this.Bt=Io(),this.Lt=new Qi(ai),i}},{key:"qt",value:function(e,t){if(this.jt(e)){var n=this.Xt(e,t.key)?2:0;this.Qt(e).Ct(t.key,n),this.$t=this.$t.insert(t.key,t),this.Bt=this.Bt.insert(t.key,this.Zt(t.key).add(e))}}},{key:"Kt",value:function(e,t,n){if(this.jt(e)){var r=this.Qt(e);this.Xt(e,t)?r.Ct(t,1):r.xt(t),this.Bt=this.Bt.insert(t,this.Zt(t).delete(e)),n&&(this.$t=this.$t.insert(t,n))}}},{key:"removeTarget",value:function(e){this.Ft.delete(e)}},{key:"Jt",value:function(e){var t=this.Qt(e).St();return this.Mt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"Nt",value:function(e){this.Qt(e).Nt()}},{key:"Qt",value:function(e){var t=this.Ft.get(e);return t||(t=new bo,this.Ft.set(e,t)),t}},{key:"Zt",value:function(e){var t=this.Bt.get(e);return t||(t=new Qi(ai),this.Bt=this.Bt.insert(e,t)),t}},{key:"jt",value:function(e){var t=null!==this.Ht(e);return t||Pr("WatchChangeAggregator","Detected inactive target",e),t}},{key:"Ht",value:function(e){var t=this.Ft.get(e);return t&&t.Pt?null:this.Mt.te(e)}},{key:"Wt",value:function(e){var t=this;this.Ft.set(e,new bo),this.Mt.getRemoteKeysForTarget(e).forEach((function(n){t.Kt(e,n,null)}))}},{key:"Xt",value:function(e,t){return this.Mt.getRemoteKeysForTarget(e).has(t)}}]),e}();function Io(){return new Gi(vi.comparator)}function Zo(){return new Gi(vi.comparator)}var Eo={asc:"ASCENDING",desc:"DESCENDING"},To={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},So=(0,c.Z)((function e(t,n){(0,s.Z)(this,e),this.databaseId=t,this.dt=n}));function _o(e,t){return e.dt?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Do(e,t){return e.dt?t.toBase64():t.toUint8Array()}function Ao(e,t){return _o(e,t.toTimestamp())}function Co(e){return Gr(!!e),ci.fromTimestamp(function(e){var t=$i(e);return new si(t.seconds,t.nanos)}(e))}function No(e,t){return function(e){return new hi(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Ro(e){var t=hi.fromString(e);return Gr(ns(t)),t}function Mo(e,t){return No(e.databaseId,t.path)}function Vo(e,t){var n=Ro(t);if(n.get(1)!==e.databaseId.projectId)throw new Qr(zr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Qr(zr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new vi(Po(n))}function Lo(e,t){return No(e.databaseId,t)}function Oo(e){var t=Ro(e);return 4===t.length?hi.emptyPath():Po(t)}function Fo(e){return new hi(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Po(e){return Gr(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Uo(e,t,n){return{name:Mo(e,t),fields:n.value.mapValue.fields}}function Bo(e,t,n){var r=Vo(e,t.name),i=Co(t.updateTime),a=new Ca({mapValue:{fields:t.fields}}),u=Ra.newFoundDocument(r,i,a);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function qo(e,t){return"found"in t?function(e,t){Gr(!!t.found),t.found.name,t.found.updateTime;var n=Vo(e,t.found.name),r=Co(t.found.updateTime),i=new Ca({mapValue:{fields:t.found.fields}});return Ra.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){Gr(!!t.missing),Gr(!!t.readTime);var n=Vo(e,t.missing),r=Co(t.readTime);return Ra.newNoDocument(n,r)}(e,t):Kr()}function Ko(e,t){var n;if(t instanceof Ku)n={update:Uo(e,t.key,t.value)};else if(t instanceof Xu)n={delete:Mo(e,t.key)};else if(t instanceof Gu)n={update:Uo(e,t.key,t.data),updateMask:ts(t.fieldMask)};else{if(!(t instanceof Yu))return Kr();n={verify:Mo(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof Eu)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Tu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof _u)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Au)return{fieldPath:t.field.canonicalString(),increment:n._t};throw Kr()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Ao(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Kr()}(e,t.precondition)),n}function Go(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?Vu.updateTime(Co(e.updateTime)):void 0!==e.exists?Vu.exists(e.exists):Vu.none()}(t.currentDocument):Vu.none(),r=t.updateTransforms?t.updateTransforms.map((function(t){return function(e,t){var n=null;if("setToServerValue"in t)Gr("REQUEST_TIME"===t.setToServerValue),n=new Eu;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Tu(r)}else if("removeAllFromArray"in t){var i=t.removeAllFromArray.values||[];n=new _u(i)}else"increment"in t?n=new Au(e,t.increment):Kr();var a=di.fromServerFormat(t.fieldPath);return new Ru(a,n)}(e,t)})):[];if(t.update){t.update.name;var i=Vo(e,t.update.name),a=new Ca({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=function(e){var t=e.fieldPaths||[];return new Xi(t.map((function(e){return di.fromServerFormat(e)})))}(t.updateMask);return new Gu(i,a,u,n,r)}return new Ku(i,a,n,r)}if(t.delete){var o=Vo(e,t.delete);return new Xu(o,n)}if(t.verify){var s=Vo(e,t.verify);return new Yu(s,n)}return Kr()}function jo(e,t){return{documents:[Lo(e,t.path)]}}function zo(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Lo(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Lo(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map((function(e){return function(e){if("=="===e.op){if(Ia(e.value))return{unaryFilter:{field:Yo(e.field),op:"IS_NAN"}};if(xa(e.value))return{unaryFilter:{field:Yo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ia(e.value))return{unaryFilter:{field:Yo(e.field),op:"IS_NOT_NAN"}};if(xa(e.value))return{unaryFilter:{field:Yo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Yo(e.field),op:Xo(e.op),value:e.value}}}(e)}));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:Yo(e.field),direction:Wo(e.dir)}}(e)}))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var u,o=function(e,t){return e.dt||oa(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(u=t.startAt).inclusive,values:u.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Qo(e){var t=Oo(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Gr(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var u=[];n.where&&(u=Ho(n.where));var o=[];n.orderBy&&(o=n.orderBy.map((function(e){return function(e){return new Ja(Jo(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)})));var s=null;n.limit&&(s=function(e){var t;return oa(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=function(e){var t=!!e.before,n=e.values||[];return new Ya(n,t)}(n.startAt));var l=null;return n.endAt&&(l=function(e){var t=!e.before,n=e.values||[];return new Ya(n,t)}(n.endAt)),ru(t,i,o,u,s,"F",c,l)}function Ho(e){return e?void 0!==e.unaryFilter?[es(e)]:void 0!==e.fieldFilter?[$o(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return Ho(e)})).reduce((function(e,t){return e.concat(t)})):Kr():[]}function Wo(e){return Eo[e]}function Xo(e){return To[e]}function Yo(e){return{fieldPath:e.canonicalString()}}function Jo(e){return di.fromServerFormat(e.fieldPath)}function $o(e){return qa.create(Jo(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Kr()}}(e.fieldFilter.op),e.fieldFilter.value)}function es(e){switch(e.unaryFilter.op){case"IS_NAN":var t=Jo(e.unaryFilter.field);return qa.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=Jo(e.unaryFilter.field);return qa.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Jo(e.unaryFilter.field);return qa.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Jo(e.unaryFilter.field);return qa.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Kr()}}function ts(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function ns(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function rs(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=as(t)),t=is(e.get(n),t);return as(t)}function is(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=a}}return n}function as(e){return e+"\x01\x01"}function us(e){var t=e.length;if(Gr(t>=2),2===t)return Gr("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),hi.emptyPath();for(var n=t-2,r=[],i="",a=0;a<t;){var u=e.indexOf("\x01",a);switch((u<0||u>n)&&Kr(),e.charAt(u+1)){case"\x01":var o=e.substring(a,u),s=void 0;0===i.length?s=o:(s=i+=o,i=""),r.push(s);break;case"\x10":i+=e.substring(a,u),i+="\0";break;case"\x11":i+=e.substring(a,u+1);break;default:Kr()}a=u+2}return new hi(r)}var os=["userId","batchId"];function ss(e,t){return[e,rs(t)]}function cs(e,t,n){return[e,rs(t),n]}var ls={},hs=["prefixPath","collectionGroup","readTime","documentId"],fs=["prefixPath","collectionGroup","documentId"],ds=["collectionGroup","readTime","prefixPath","documentId"],vs=["canonicalId","targetId"],ys=["targetId","path"],ps=["path","targetId"],ms=["collectionId","parent"],gs=["indexId","uid"],ks=["uid","sequenceNumber"],ws=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],bs=["indexId","uid","orderedDocumentKey"],xs=["userId","collectionPath","documentId"],Is=["userId","collectionPath","largestBatchId"],Zs=["userId","collectionGroup","largestBatchId"],Es=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]),Ts=[].concat((0,p.Z)(Es),["documentOverlays"]),Ss=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],_s=Ss,Ds=[].concat(_s,["indexConfiguration","indexState","indexEntries"]),As=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this)).ee=e,i.currentSequenceNumber=r,i}return(0,c.Z)(n)}(Ei);function Cs(e,t){var n=jr(e);return Ai.N(n.ee,t)}var Ns=function(){function e(t,n,r,i){(0,s.Z)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return(0,c.Z)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&Pu(i,e,n[r])}}},{key:"applyToLocalView",value:function(e,t){var n,r=(0,o.Z)(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.key.isEqual(e.key)&&(t=Uu(i,e,t,this.localWriteTime))}}catch(c){r.e(c)}finally{r.f()}var a,u=(0,o.Z)(this.mutations);try{for(u.s();!(a=u.n()).done;){var s=a.value;s.key.isEqual(e.key)&&(t=Uu(s,e,t,this.localWriteTime))}}catch(c){u.e(c)}finally{u.f()}return t}},{key:"applyToLocalDocumentSet",value:function(e,t){var n=this,r=so();return this.mutations.forEach((function(i){var a=e.get(i.key),u=a.overlayedDocument,o=n.applyToLocalView(u,a.mutatedFields),s=Fu(u,o=t.has(i.key)?null:o);null!==s&&r.set(i.key,s),u.isValidDocument()||u.convertToNoDocument(ci.min())})),r}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),fo())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&ui(this.mutations,e.mutations,(function(e,t){return qu(e,t)}))&&ui(this.baseMutations,e.baseMutations,(function(e,t){return qu(e,t)}))}}]),e}(),Rs=function(){function e(t,n,r,i){(0,s.Z)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return(0,c.Z)(e,null,[{key:"from",value:function(t,n,r){Gr(t.mutations.length===r.length);for(var i=lo,a=t.mutations,u=0;u<a.length;u++)i=i.insert(a[u].key,r[u].version);return new e(t,n,r,i)}}]),e}(),Ms=function(){function e(t,n){(0,s.Z)(this,e),this.largestBatchId=t,this.mutation=n}return(0,c.Z)(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}(),Vs=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ci.min(),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ci.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Yi.EMPTY_BYTE_STRING;(0,s.Z)(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=o}return(0,c.Z)(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),Ls=(0,c.Z)((function e(t){(0,s.Z)(this,e),this.ne=t}));function Os(e,t){var n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Fs(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Mo(e,t.key),fields:t.data.value.mapValue.fields,updateTime:_o(e,t.version.toTimestamp())}}(e.ne,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Ps(t.version)};else{if(!t.isUnknownDocument())return Kr();r.unknownDocument={path:n.path.toArray(),version:Ps(t.version)}}return r}function Fs(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Ps(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Us(e){var t=new si(e.seconds,e.nanoseconds);return ci.fromTimestamp(t)}function Bs(e,t){for(var n=(t.baseMutations||[]).map((function(t){return Go(e.ne,t)})),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var u=t.mutations.map((function(t){return Go(e.ne,t)})),o=si.fromMillis(t.localWriteTimeMs);return new Ns(t.batchId,o,n,u)}function qs(e){var t,n,r=Us(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?Us(e.lastLimboFreeSnapshotVersion):ci.min();return void 0!==e.query.documents?(Gr(1===(n=e.query).documents.length),t=cu(iu(Oo(n.documents[0])))):t=function(e){return cu(Qo(e))}(e.query),new Vs(t,e.targetId,0,e.lastListenSequenceNumber,r,i,Yi.fromBase64String(e.resumeToken))}function Ks(e,t){var n,r=Ps(t.snapshotVersion),i=Ps(t.lastLimboFreeSnapshotVersion);n=Fa(t.target)?jo(e.ne,t.target):zo(e.ne,t.target);var a=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:La(t.target),readTime:r,resumeToken:a,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:n}}function Gs(e){var t=Qo({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?lu(t,t.limit,"L"):t}function js(e,t){return new Ms(t.largestBatchId,Go(e.ne,t.overlayMutation))}function zs(e,t){var n=t.path.lastSegment();return[e,rs(t.path.popLast()),n]}function Qs(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Ps(r.readTime),documentKey:rs(r.documentKey.path),largestBatchId:r.largestBatchId}}var Hs=function(){function e(){(0,s.Z)(this,e)}return(0,c.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return Ws(e).get(t).next((function(e){if(e)return{id:(t=e).bundleId,createTime:Us(t.createTime),version:t.version};var t}))}},{key:"saveBundleMetadata",value:function(e,t){return Ws(e).put({bundleId:(n=t).id,createTime:Ps(Co(n.createTime)),version:n.version});var n}},{key:"getNamedQuery",value:function(e,t){return Xs(e).get(t).next((function(e){if(e)return{name:(t=e).name,query:Gs(t.bundledQuery),readTime:Us(t.readTime)};var t}))}},{key:"saveNamedQuery",value:function(e,t){return Xs(e).put(function(e){return{name:e.name,readTime:Ps(Co(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function Ws(e){return Cs(e,"bundles")}function Xs(e){return Cs(e,"namedQueries")}var Ys=function(){function e(t,n){(0,s.Z)(this,e),this.wt=t,this.userId=n}return(0,c.Z)(e,[{key:"getOverlay",value:function(e,t){var n=this;return Js(e).get(zs(this.userId,t)).next((function(e){return e?js(n.wt,e):null}))}},{key:"getOverlays",value:function(e,t){var n=this,r=oo();return _i.forEach(t,(function(t){return n.getOverlay(e,t).next((function(e){null!==e&&r.set(t,e)}))})).next((function(){return r}))}},{key:"saveOverlays",value:function(e,t,n){var r=this,i=[];return n.forEach((function(n,a){var u=new Ms(t,a);i.push(r.ie(e,u))})),_i.waitFor(i)}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=new Set;t.forEach((function(e){return i.add(rs(e.getCollectionPath()))}));var a=[];return i.forEach((function(t){var i=IDBKeyRange.bound([r.userId,t,n],[r.userId,t,n+1],!1,!0);a.push(Js(e).W("collectionPathOverlayIndex",i))})),_i.waitFor(a)}},{key:"getOverlaysForCollection",value:function(e,t,n){var r=this,i=oo(),a=rs(t),u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,Number.POSITIVE_INFINITY],!0);return Js(e).K("collectionPathOverlayIndex",u).next((function(e){var t,n=(0,o.Z)(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,u=js(r.wt,a);i.set(u.getKey(),u)}}catch(s){n.e(s)}finally{n.f()}return i}))}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){var i,a=this,u=oo(),o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Js(e).J({index:"collectionGroupOverlayIndex",range:o},(function(e,t,n){var o=js(a.wt,t);u.size()<r||o.largestBatchId===i?(u.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((function(){return u}))}},{key:"ie",value:function(e,t){return Js(e).put(function(e,t,n){var r=zs(t,n.mutation.key),i=(0,d.Z)(r,3);i[0];return{userId:t,collectionPath:i[1],documentId:i[2],collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Ko(e.ne,n.mutation)}}(this.wt,this.userId,t))}}],[{key:"se",value:function(t,n){return new e(t,n.uid||"")}}]),e}();function Js(e){return Cs(e,"documentOverlays")}var $s=function(){function e(){(0,s.Z)(this,e)}return(0,c.Z)(e,[{key:"re",value:function(e,t){this.oe(e,t),t.ue()}},{key:"oe",value:function(e,t){if("nullValue"in e)this.ce(t,5);else if("booleanValue"in e)this.ce(t,10),t.ae(e.booleanValue?1:0);else if("integerValue"in e)this.ce(t,15),t.ae(ea(e.integerValue));else if("doubleValue"in e){var n=ea(e.doubleValue);isNaN(n)?this.ce(t,13):(this.ce(t,15),sa(n)?t.ae(0):t.ae(n))}else if("timestampValue"in e){var r=e.timestampValue;this.ce(t,20),"string"==typeof r?t.he(r):(t.he("".concat(r.seconds||"")),t.ae(r.nanos||0))}else if("stringValue"in e)this.le(e.stringValue,t),this.fe(t);else if("bytesValue"in e)this.ce(t,30),t.de(ta(e.bytesValue)),this.fe(t);else if("referenceValue"in e)this._e(e.referenceValue,t);else if("geoPointValue"in e){var i=e.geoPointValue;this.ce(t,45),t.ae(i.latitude||0),t.ae(i.longitude||0)}else"mapValue"in e?Ta(e)?this.ce(t,Number.MAX_SAFE_INTEGER):(this.we(e.mapValue,t),this.fe(t)):"arrayValue"in e?(this.me(e.arrayValue,t),this.fe(t)):Kr()}},{key:"le",value:function(e,t){this.ce(t,25),this.ge(e,t)}},{key:"ge",value:function(e,t){t.he(e)}},{key:"we",value:function(e,t){var n=e.fields||{};this.ce(t,55);for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];this.le(a,t),this.oe(n[a],t)}}},{key:"me",value:function(e,t){var n=e.values||[];this.ce(t,50);var r,i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.oe(a,t)}}catch(u){i.e(u)}finally{i.f()}}},{key:"_e",value:function(e,t){var n=this;this.ce(t,37),vi.fromName(e).path.forEach((function(e){n.ce(t,60),n.ge(e,t)}))}},{key:"ce",value:function(e,t){e.ae(t)}},{key:"fe",value:function(e){e.ae(2)}}]),e}();function ec(e){if(0===e)return 8;var t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function tc(e){var t=64-function(e){for(var t=0,n=0;n<8;++n){var r=ec(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}$s.ye=new $s;var nc=function(){function e(){(0,s.Z)(this,e),this.buffer=new Uint8Array(1024),this.position=0}return(0,c.Z)(e,[{key:"pe",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.Ie(n.value),n=t.next();this.Te()}},{key:"Ee",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.Ae(n.value),n=t.next();this.Re()}},{key:"be",value:function(e){var t,n=(0,o.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.Ie(i);else if(i<2048)this.Ie(960|i>>>6),this.Ie(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.Ie(480|i>>>12),this.Ie(128|63&i>>>6),this.Ie(128|63&i);else{var a=r.codePointAt(0);this.Ie(240|a>>>18),this.Ie(128|63&a>>>12),this.Ie(128|63&a>>>6),this.Ie(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.Te()}},{key:"Pe",value:function(e){var t,n=(0,o.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.charCodeAt(0);if(i<128)this.Ae(i);else if(i<2048)this.Ae(960|i>>>6),this.Ae(128|63&i);else if(r<"\ud800"||"\udbff"<r)this.Ae(480|i>>>12),this.Ae(128|63&i>>>6),this.Ae(128|63&i);else{var a=r.codePointAt(0);this.Ae(240|a>>>18),this.Ae(128|63&a>>>12),this.Ae(128|63&a>>>6),this.Ae(128|63&a)}}}catch(u){n.e(u)}finally{n.f()}this.Re()}},{key:"ve",value:function(e){var t=this.Ve(e),n=tc(t);this.Se(1+n),this.buffer[this.position++]=255&n;for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}},{key:"De",value:function(e){var t=this.Ve(e),n=tc(t);this.Se(1+n),this.buffer[this.position++]=~(255&n);for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}},{key:"Ce",value:function(){this.xe(255),this.xe(255)}},{key:"Ne",value:function(){this.ke(255),this.ke(255)}},{key:"reset",value:function(){this.position=0}},{key:"seed",value:function(e){this.Se(e.length),this.buffer.set(e,this.position),this.position+=e.length}},{key:"Oe",value:function(){return this.buffer.slice(0,this.position)}},{key:"Ve",value:function(e){var t=function(e){var t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(var r=1;r<t.length;++r)t[r]^=n?255:0;return t}},{key:"Ie",value:function(e){var t=255&e;0===t?(this.xe(0),this.xe(255)):255===t?(this.xe(255),this.xe(0)):this.xe(t)}},{key:"Ae",value:function(e){var t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(e)}},{key:"Te",value:function(){this.xe(0),this.xe(1)}},{key:"Re",value:function(){this.ke(0),this.ke(1)}},{key:"xe",value:function(e){this.Se(1),this.buffer[this.position++]=e}},{key:"ke",value:function(e){this.Se(1),this.buffer[this.position++]=~e}},{key:"Se",value:function(e){var t=e+this.position;if(!(t<=this.buffer.length)){var n=2*this.buffer.length;n<t&&(n=t);var r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}}]),e}(),rc=function(){function e(t){(0,s.Z)(this,e),this.Me=t}return(0,c.Z)(e,[{key:"de",value:function(e){this.Me.pe(e)}},{key:"he",value:function(e){this.Me.be(e)}},{key:"ae",value:function(e){this.Me.ve(e)}},{key:"ue",value:function(){this.Me.Ce()}}]),e}(),ic=function(){function e(t){(0,s.Z)(this,e),this.Me=t}return(0,c.Z)(e,[{key:"de",value:function(e){this.Me.Ee(e)}},{key:"he",value:function(e){this.Me.Pe(e)}},{key:"ae",value:function(e){this.Me.De(e)}},{key:"ue",value:function(){this.Me.Ne()}}]),e}(),ac=function(){function e(){(0,s.Z)(this,e),this.Me=new nc,this.Fe=new rc(this.Me),this.$e=new ic(this.Me)}return(0,c.Z)(e,[{key:"seed",value:function(e){this.Me.seed(e)}},{key:"Be",value:function(e){return 0===e?this.Fe:this.$e}},{key:"Oe",value:function(){return this.Me.Oe()}},{key:"reset",value:function(){this.Me.reset()}}]),e}(),uc=function(){function e(t,n,r,i){(0,s.Z)(this,e),this.indexId=t,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}return(0,c.Z)(e,[{key:"Le",value:function(){var t=this.directionalValue.length,n=0===t||255===this.directionalValue[t-1]?t+1:t,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new e(this.indexId,this.documentKey,this.arrayValue,r)}}]),e}();function oc(e,t){var n=e.indexId-t.indexId;return 0!==n?n:0!==(n=sc(e.arrayValue,t.arrayValue))?n:0!==(n=sc(e.directionalValue,t.directionalValue))?n:vi.comparator(e.documentKey,t.documentKey)}function sc(e,t){for(var n=0;n<e.length&&n<t.length;++n){var r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}var cc=function(){function e(t){(0,s.Z)(this,e),this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Ue=t.orderBy,this.qe=[];var n,r=(0,o.Z)(t.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;i.ht()?this.Ke=i:this.qe.push(i)}}catch(a){r.e(a)}finally{r.f()}}return(0,c.Z)(e,[{key:"Ge",value:function(e){var t=pi(e);if(void 0!==t&&!this.Qe(t))return!1;for(var n=mi(e),r=0,i=0;r<n.length&&this.Qe(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Ke){var a=n[r];if(!this.je(this.Ke,a)||!this.We(this.Ue[i++],a))return!1;++r}for(;r<n.length;++r){var u=n[r];if(i>=this.Ue.length||!this.We(this.Ue[i++],u))return!1}return!0}},{key:"Qe",value:function(e){var t,n=(0,o.Z)(this.qe);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.je(r,e))return!0}}catch(i){n.e(i)}finally{n.f()}return!1}},{key:"je",value:function(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}},{key:"We",value:function(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}]),e}(),lc=function(){function e(){(0,s.Z)(this,e),this.ze=new hc}return(0,c.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.ze.add(t),_i.resolve()}},{key:"getCollectionParents",value:function(e,t){return _i.resolve(this.ze.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return _i.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return _i.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t){return _i.resolve(null)}},{key:"getIndexType",value:function(e,t){return _i.resolve(0)}},{key:"getFieldIndexes",value:function(e,t){return _i.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return _i.resolve(null)}},{key:"getMinOffset",value:function(e,t){return _i.resolve(xi.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return _i.resolve(xi.min())}},{key:"updateCollectionGroup",value:function(e,t,n){return _i.resolve()}},{key:"updateIndexEntries",value:function(e,t){return _i.resolve()}}]),e}(),hc=function(){function e(){(0,s.Z)(this,e),this.index={}}return(0,c.Z)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Qi(hi.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new Qi(hi.comparator)).toArray()}}]),e}(),fc=new Uint8Array(0),dc=function(){function e(t,n){(0,s.Z)(this,e),this.user=t,this.databaseId=n,this.He=new hc,this.Je=new to((function(e){return La(e)}),(function(e,t){return Oa(e,t)})),this.uid=t.uid||""}return(0,c.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.He.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((function(){n.He.add(t)}));var a={collectionId:r,parent:rs(i)};return vc(e).put(a)}return _i.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[oi(t),""],!1,!0);return vc(e).K(r).next((function(e){var r,i=(0,o.Z)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push(us(a.parent))}}catch(u){i.e(u)}finally{i.f()}return n}))}},{key:"addFieldIndex",value:function(e,t){var n=this,r=pc(e),i=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((function(e){return[e.fieldPath.canonicalString(),e.kind]}))}}(t);delete i.indexId;var a=r.add(i);if(t.indexState){var u=mc(e);return a.next((function(e){u.put(Qs(e,n.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return a.next()}},{key:"deleteFieldIndex",value:function(e,t){var n=pc(e),r=mc(e),i=yc(e);return n.delete(t.indexId).next((function(){return r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))})).next((function(){return i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))}))}},{key:"getDocumentsMatchingTarget",value:function(e,t){var n=this,r=yc(e),i=!0,a=new Map;return _i.forEach(this.Ye(t),(function(t){return n.Xe(e,t).next((function(e){i&&(i=!!e),a.set(t,e)}))})).next((function(){if(i){var e=fo(),u=[];return _i.forEach(a,(function(i,a){var s;Pr("IndexedDbIndexManager","Using index ".concat((s=i,"id=".concat(s.indexId,"|cg=").concat(s.collectionGroup,"|f=").concat(s.fields.map((function(e){return"".concat(e.fieldPath,":").concat(e.kind)})).join(",")))," to execute ").concat(La(t)));var c=function(e,t){var n=pi(t);if(void 0===n)return null;var r,i=(0,o.Z)(Pa(e,n.fieldPath));try{for(i.s();!(r=i.n()).done;){var a=r.value;switch(a.op){case"array-contains-any":return a.value.arrayValue.values||[];case"array-contains":return[a.value]}}}catch(u){i.e(u)}finally{i.f()}return null}(a,i),l=function(e,t){var n,r=new Map,i=(0,o.Z)(mi(t));try{for(i.s();!(n=i.n()).done;){var a,u=n.value,s=(0,o.Z)(Pa(e,u.fieldPath));try{for(s.s();!(a=s.n()).done;){var c=a.value;switch(c.op){case"==":case"in":r.set(u.fieldPath.canonicalString(),c.value);break;case"not-in":case"!=":return r.set(u.fieldPath.canonicalString(),c.value),Array.from(r.values())}}}catch(l){s.e(l)}finally{s.f()}}}catch(l){i.e(l)}finally{i.f()}return null}(a,i),h=function(e,t){var n,r=[],i=!0,a=(0,o.Z)(mi(t));try{for(a.s();!(n=a.n()).done;){var u=n.value,s=0===u.kind?Ua(e,u.fieldPath,e.startAt):Ba(e,u.fieldPath,e.startAt);r.push(s.value),i&&(i=s.inclusive)}}catch(c){a.e(c)}finally{a.f()}return new Ya(r,i)}(a,i),f=function(e,t){var n,r=[],i=!0,a=(0,o.Z)(mi(t));try{for(a.s();!(n=a.n()).done;){var u=n.value,s=0===u.kind?Ba(e,u.fieldPath,e.endAt):Ua(e,u.fieldPath,e.endAt);r.push(s.value),i&&(i=s.inclusive)}}catch(c){a.e(c)}finally{a.f()}return new Ya(r,i)}(a,i),d=n.Ze(i,a,h),v=n.Ze(i,a,f),y=n.tn(i,a,l),p=n.en(i.indexId,c,d,h.inclusive,v,f.inclusive,y);return _i.forEach(p,(function(n){return r.j(n,t.limit).next((function(t){t.forEach((function(t){var n=vi.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),u.push(n))}))}))}))})).next((function(){return u}))}return _i.resolve(null)}))}},{key:"Ye",value:function(e){var t=this.Je.get(e);return t||(t=[e],this.Je.set(e,t),t)}},{key:"en",value:function(e,t,n,r,i,a,u){for(var o=this,s=(null!=t?t.length:1)*Math.max(n.length,i.length),c=s/(null!=t?t.length:1),l=[],h=function(s){var h=t?o.nn(t[s/c]):fc,f=o.sn(e,h,n[s%c],r),d=o.rn(e,h,i[s%c],a),v=u.map((function(t){return o.sn(e,h,t,!0)}));l.push.apply(l,(0,p.Z)(o.createRange(f,d,v)))},f=0;f<s;++f)h(f);return l}},{key:"sn",value:function(e,t,n,r){var i=new uc(e,vi.empty(),t,n);return r?i:i.Le()}},{key:"rn",value:function(e,t,n,r){var i=new uc(e,vi.empty(),t,n);return r?i.Le():i}},{key:"Xe",value:function(e,t){var n=new cc(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((function(e){var t,r=null,i=(0,o.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n.Ge(a)&&(!r||a.fields.length>r.fields.length)&&(r=a)}}catch(u){i.e(u)}finally{i.f()}return r}))}},{key:"getIndexType",value:function(e,t){var n=this,r=2;return _i.forEach(this.Ye(t),(function(t){return n.Xe(e,t).next((function(e){e?0!==r&&e.fields.length<function(e){var t,n=new Qi(di.comparator),r=!1,i=(0,o.Z)(e.filters);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.field.isKeyField()||("array-contains"===a.op||"array-contains-any"===a.op?r=!0:n=n.add(a.field))}}catch(l){i.e(l)}finally{i.f()}var u,s=(0,o.Z)(e.orderBy);try{for(s.s();!(u=s.n()).done;){var c=u.value;c.field.isKeyField()||(n=n.add(c.field))}}catch(l){s.e(l)}finally{s.f()}return n.size+(r?1:0)}(t)&&(r=1):r=0}))})).next((function(){return r}))}},{key:"on",value:function(e,t){var n,r=new ac,i=(0,o.Z)(mi(e));try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.fieldPath);if(null==u)return null;var s=r.Be(a.kind);$s.ye.re(u,s)}}catch(c){i.e(c)}finally{i.f()}return r.Oe()}},{key:"nn",value:function(e){var t=new ac;return $s.ye.re(e,t.Be(0)),t.Oe()}},{key:"un",value:function(e,t){var n=new ac;return $s.ye.re(ka(this.databaseId,t),n.Be(function(e){var t=mi(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Oe()}},{key:"tn",value:function(e,t,n){if(null===n)return[];var r=[];r.push(new ac);var i,a=0,u=(0,o.Z)(mi(e));try{for(u.s();!(i=u.n()).done;){var s,c=i.value,l=n[a++],h=(0,o.Z)(r);try{for(h.s();!(s=h.n()).done;){var f=s.value;if(this.cn(t,c.fieldPath)&&ba(l))r=this.an(r,c,l);else{var d=f.Be(c.kind);$s.ye.re(l,d)}}}catch(v){h.e(v)}finally{h.f()}}}catch(v){u.e(v)}finally{u.f()}return this.hn(r)}},{key:"Ze",value:function(e,t,n){return this.tn(e,t,n.position)}},{key:"hn",value:function(e){for(var t=[],n=0;n<e.length;++n)t[n]=e[n].Oe();return t}},{key:"an",value:function(e,t,n){var r,i=(0,p.Z)(e),a=[],u=(0,o.Z)(n.arrayValue.values||[]);try{for(u.s();!(r=u.n()).done;){var s,c=r.value,l=(0,o.Z)(i);try{for(l.s();!(s=l.n()).done;){var h=s.value,f=new ac;f.seed(h.Oe()),$s.ye.re(c,f.Be(t.kind)),a.push(f)}}catch(d){l.e(d)}finally{l.f()}}}catch(d){u.e(d)}finally{u.f()}return a}},{key:"cn",value:function(e,t){return!!e.filters.find((function(e){return e instanceof qa&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)}))}},{key:"getFieldIndexes",value:function(e,t){var n=this,r=pc(e),i=mc(e);return(t?r.K("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.K()).next((function(e){var t=[];return _i.forEach(e,(function(e){return i.get([e.indexId,n.uid]).next((function(n){t.push(function(e,t){var n=t?new ki(t.sequenceNumber,new xi(Us(t.readTime),new vi(us(t.documentKey)),t.largestBatchId)):ki.empty(),r=e.fields.map((function(e){var t=(0,d.Z)(e,2),n=t[0],r=t[1];return new gi(di.fromServerFormat(n),r)}));return new yi(e.indexId,e.collectionGroup,r,n)}(e,n))}))})).next((function(){return t}))}))}},{key:"getNextCollectionGroupToUpdate",value:function(e){return this.getFieldIndexes(e).next((function(e){return 0===e.length?null:(e.sort((function(e,t){var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:ai(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)}))}},{key:"updateCollectionGroup",value:function(e,t,n){var r=this,i=pc(e),a=mc(e);return this.ln(e).next((function(e){return i.K("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((function(t){return _i.forEach(t,(function(t){return a.put(Qs(t.indexId,r.user,e,n))}))}))}))}},{key:"updateIndexEntries",value:function(e,t){var n=this,r=new Map;return _i.forEach(t,(function(t,i){var a=r.get(t.collectionGroup);return(a?_i.resolve(a):n.getFieldIndexes(e,t.collectionGroup)).next((function(a){return r.set(t.collectionGroup,a),_i.forEach(a,(function(r){return n.fn(e,t,r).next((function(t){var a=n.dn(i,r);return t.isEqual(a)?_i.resolve():n._n(e,i,r,t,a)}))}))}))}))}},{key:"wn",value:function(e,t,n,r){return yc(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.un(n,t.key),documentKey:t.key.path.toArray()})}},{key:"mn",value:function(e,t,n,r){return yc(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.un(n,t.key),t.key.path.toArray()])}},{key:"fn",value:function(e,t,n){var r=yc(e),i=new Qi(oc);return r.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.un(n,t)])},(function(e,r){i=i.add(new uc(n.indexId,t,r.arrayValue,r.directionalValue))})).next((function(){return i}))}},{key:"dn",value:function(e,t){var n=new Qi(oc),r=this.on(t,e);if(null==r)return n;var i=pi(t);if(null!=i){var a=e.data.field(i.fieldPath);if(ba(a)){var u,s=(0,o.Z)(a.arrayValue.values||[]);try{for(s.s();!(u=s.n()).done;){var c=u.value;n=n.add(new uc(t.indexId,e.key,this.nn(c),r))}}catch(l){s.e(l)}finally{s.f()}}}else n=n.add(new uc(t.indexId,e.key,fc,r));return n}},{key:"_n",value:function(e,t,n,r,i){var a=this;Pr("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);var u=[];return function(e,t,n,r,i){for(var a=e.getIterator(),u=t.getIterator(),o=Wi(a),s=Wi(u);o||s;){var c=!1,l=!1;if(o&&s){var h=n(o,s);h<0?l=!0:h>0&&(c=!0)}else null!=o?l=!0:c=!0;c?(r(s),s=Wi(u)):l?(i(o),o=Wi(a)):(o=Wi(a),s=Wi(u))}}(r,i,oc,(function(r){u.push(a.wn(e,t,n,r))}),(function(r){u.push(a.mn(e,t,n,r))})),_i.waitFor(u)}},{key:"ln",value:function(e){var t=1;return mc(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(function(e,n,r){r.done(),t=n.sequenceNumber+1})).next((function(){return t}))}},{key:"createRange",value:function(e,t,n){n=n.sort((function(e,t){return oc(e,t)})).filter((function(e,t,n){return!t||0!==oc(e,n[t-1])}));var r=[];r.push(e);var i,a=(0,o.Z)(n);try{for(a.s();!(i=a.n()).done;){var u=i.value,s=oc(u,e),c=oc(u,t);if(0===s)r[0]=e.Le();else if(s>0&&c<0)r.push(u),r.push(u.Le());else if(c>0)break}}catch(f){a.e(f)}finally{a.f()}r.push(t);for(var l=[],h=0;h<r.length;h+=2)l.push(IDBKeyRange.bound([r[h].indexId,this.uid,r[h].arrayValue,r[h].directionalValue,fc,[]],[r[h+1].indexId,this.uid,r[h+1].arrayValue,r[h+1].directionalValue,fc,[]]));return l}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return this.getFieldIndexes(e,t).next(gc)}},{key:"getMinOffset",value:function(e,t){var n=this;return _i.mapArray(this.Ye(t),(function(t){return n.Xe(e,t).next((function(e){return e||Kr()}))})).next(gc)}}]),e}();function vc(e){return Cs(e,"collectionParents")}function yc(e){return Cs(e,"indexEntries")}function pc(e){return Cs(e,"indexConfiguration")}function mc(e){return Cs(e,"indexState")}function gc(e){Gr(0!==e.length);for(var t=e[0].indexState.offset,n=t.largestBatchId,r=1;r<e.length;r++){var i=e[r].indexState.offset;Ii(i,t)<0&&(t=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new xi(t.readTime,t.documentKey,n)}var kc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},wc=function(){function e(t,n,r){(0,s.Z)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return(0,c.Z)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function bc(e,t,n){var r=e.store("mutations"),i=e.store("documentMutations"),a=[],u=IDBKeyRange.only(n.batchId),s=0,c=r.J({range:u},(function(e,t,n){return s++,n.delete()}));a.push(c.next((function(){Gr(1===s)})));var l,h=[],f=(0,o.Z)(n.mutations);try{for(f.s();!(l=f.n()).done;){var d=l.value,v=cs(t,d.key.path,n.batchId);a.push(i.delete(v)),h.push(d.key)}}catch(y){f.e(y)}finally{f.f()}return _i.waitFor(a).next((function(){return h}))}function xc(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Kr();t=e.noDocument}return JSON.stringify(t).length}wc.DEFAULT_COLLECTION_PERCENTILE=10,wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,wc.DEFAULT=new wc(41943040,wc.DEFAULT_COLLECTION_PERCENTILE,wc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),wc.DISABLED=new wc(-1,0,0);var Ic=function(){function e(t,n,r,i){(0,s.Z)(this,e),this.userId=t,this.wt=n,this.indexManager=r,this.referenceDelegate=i,this.gn={}}return(0,c.Z)(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ec(e).J({index:"userMutationsIndex",range:n},(function(e,n,r){t=!1,r.done()})).next((function(){return t}))}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this,a=Tc(e),u=Ec(e);return u.add({}).next((function(s){Gr("number"==typeof s);var c,l=new Ns(s,t,n,r),h=function(e,t,n){var r=n.baseMutations.map((function(t){return Ko(e.ne,t)})),i=n.mutations.map((function(t){return Ko(e.ne,t)}));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(i.wt,i.userId,l),f=[],d=new Qi((function(e,t){return ai(e.canonicalString(),t.canonicalString())})),v=(0,o.Z)(r);try{for(v.s();!(c=v.n()).done;){var y=c.value,p=cs(i.userId,y.key.path,s);d=d.add(y.key.path.popLast()),f.push(u.put(h)),f.push(a.put(p,ls))}}catch(m){v.e(m)}finally{v.f()}return d.forEach((function(t){f.push(i.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((function(){i.gn[s]=l.keys()})),_i.waitFor(f).next((function(){return l}))}))}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return Ec(e).get(t).next((function(e){return e?(Gr(e.userId===n.userId),Bs(n.wt,e)):null}))}},{key:"yn",value:function(e,t){var n=this;return this.gn[t]?_i.resolve(this.gn[t]):this.lookupMutationBatch(e,t).next((function(e){if(e){var r=e.keys();return n.gn[t]=r,r}return null}))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return Ec(e).J({index:"userMutationsIndex",range:i},(function(e,t,i){t.userId===n.userId&&(Gr(t.batchId>=r),a=Bs(n.wt,t)),i.done()})).next((function(){return a}))}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Ec(e).J({index:"userMutationsIndex",range:t,reverse:!0},(function(e,t,r){n=t.batchId,r.done()})).next((function(){return n}))}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ec(e).K("userMutationsIndex",n).next((function(e){return e.map((function(e){return Bs(t.wt,e)}))}))}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=ss(this.userId,t.path),i=IDBKeyRange.lowerBound(r),a=[];return Tc(e).J({range:i},(function(r,i,u){var o=(0,d.Z)(r,3),s=o[0],c=o[1],l=o[2],h=us(c);if(s===n.userId&&t.path.isEqual(h))return Ec(e).get(l).next((function(e){if(!e)throw Kr();Gr(e.userId===n.userId),a.push(Bs(n.wt,e))}));u.done()})).next((function(){return a}))}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Qi(ai),i=[];return t.forEach((function(t){var a=ss(n.userId,t.path),u=IDBKeyRange.lowerBound(a),o=Tc(e).J({range:u},(function(e,i,a){var u=(0,d.Z)(e,3),o=u[0],s=u[1],c=u[2],l=us(s);o===n.userId&&t.path.isEqual(l)?r=r.add(c):a.done()}));i.push(o)})),_i.waitFor(i).next((function(){return n.pn(e,r)}))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,i=r.length+1,a=ss(this.userId,r),u=IDBKeyRange.lowerBound(a),o=new Qi(ai);return Tc(e).J({range:u},(function(e,t,a){var u=(0,d.Z)(e,3),s=u[0],c=u[1],l=u[2],h=us(c);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(o=o.add(l)):a.done()})).next((function(){return n.pn(e,o)}))}},{key:"pn",value:function(e,t){var n=this,r=[],i=[];return t.forEach((function(t){i.push(Ec(e).get(t).next((function(e){if(null===e)throw Kr();Gr(e.userId===n.userId),r.push(Bs(n.wt,e))})))})),_i.waitFor(i).next((function(){return r}))}},{key:"removeMutationBatch",value:function(e,t){var n=this;return bc(e.ee,this.userId,t).next((function(r){return e.addOnCommittedListener((function(){n.In(t.batchId)})),_i.forEach(r,(function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)}))}))}},{key:"In",value:function(e){delete this.gn[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next((function(n){if(!n)return _i.resolve();var r=IDBKeyRange.lowerBound([t.userId]),i=[];return Tc(e).J({range:r},(function(e,n,r){if(e[0]===t.userId){var a=us(e[1]);i.push(a)}else r.done()})).next((function(){Gr(0===i.length)}))}))}},{key:"containsKey",value:function(e,t){return Zc(e,this.userId,t)}},{key:"Tn",value:function(e){var t=this;return Sc(e).get(this.userId).next((function(e){return e||{userId:t.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}}))}}],[{key:"se",value:function(t,n,r,i){return Gr(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)}}]),e}();function Zc(e,t,n){var r=ss(t,n.path),i=r[1],a=IDBKeyRange.lowerBound(r),u=!1;return Tc(e).J({range:a,H:!0},(function(e,n,r){var a=(0,d.Z)(e,3),o=a[0],s=a[1];a[2];o===t&&s===i&&(u=!0),r.done()})).next((function(){return u}))}function Ec(e){return Cs(e,"mutations")}function Tc(e){return Cs(e,"documentMutations")}function Sc(e){return Cs(e,"mutationQueues")}var _c=function(){function e(t){(0,s.Z)(this,e),this.En=t}return(0,c.Z)(e,[{key:"next",value:function(){return this.En+=2,this.En}}],[{key:"An",value:function(){return new e(0)}},{key:"Rn",value:function(){return new e(-1)}}]),e}(),Dc=function(){function e(t,n){(0,s.Z)(this,e),this.referenceDelegate=t,this.wt=n}return(0,c.Z)(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.bn(e).next((function(n){var r=new _c(n.highestTargetId);return n.highestTargetId=r.next(),t.Pn(e,n).next((function(){return n.highestTargetId}))}))}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.bn(e).next((function(e){return ci.fromTimestamp(new si(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))}))}},{key:"getHighestSequenceNumber",value:function(e){return this.bn(e).next((function(e){return e.highestListenSequenceNumber}))}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.bn(e).next((function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.Pn(e,i)}))}},{key:"addTargetData",value:function(e,t){var n=this;return this.vn(e,t).next((function(){return n.bn(e).next((function(r){return r.targetCount+=1,n.Vn(t,r),n.Pn(e,r)}))}))}},{key:"updateTargetData",value:function(e,t){return this.vn(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next((function(){return Ac(e).delete(t.targetId)})).next((function(){return n.bn(e)})).next((function(t){return Gr(t.targetCount>0),t.targetCount-=1,n.Pn(e,t)}))}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return Ac(e).J((function(u,o){var s=qs(o);s.sequenceNumber<=t&&null===n.get(s.targetId)&&(i++,a.push(r.removeTargetData(e,s)))})).next((function(){return _i.waitFor(a)})).next((function(){return i}))}},{key:"forEachTarget",value:function(e,t){return Ac(e).J((function(e,n){var r=qs(n);t(r)}))}},{key:"bn",value:function(e){return Cc(e).get("targetGlobalKey").next((function(e){return Gr(null!==e),e}))}},{key:"Pn",value:function(e,t){return Cc(e).put("targetGlobalKey",t)}},{key:"vn",value:function(e,t){return Ac(e).put(Ks(this.wt,t))}},{key:"Vn",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.bn(e).next((function(e){return e.targetCount}))}},{key:"getTargetData",value:function(e,t){var n=La(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Ac(e).J({range:r,index:"queryTargetsIndex"},(function(e,n,r){var a=qs(n);Oa(t,a.target)&&(i=a,r.done())})).next((function(){return i}))}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,i=[],a=Nc(e);return t.forEach((function(t){var u=rs(t.path);i.push(a.put({targetId:n,path:u})),i.push(r.referenceDelegate.addReference(e,n,t))})),_i.waitFor(i)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,i=Nc(e);return _i.forEach(t,(function(t){var a=rs(t.path);return _i.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])}))}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=Nc(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Nc(e),i=fo();return r.J({range:n,H:!0},(function(e,t,n){var r=us(e[1]),a=new vi(r);i=i.add(a)})).next((function(){return i}))}},{key:"containsKey",value:function(e,t){var n=rs(t.path),r=IDBKeyRange.bound([n],[oi(n)],!1,!0),i=0;return Nc(e).J({index:"documentTargetsIndex",H:!0,range:r},(function(e,t,n){var r=(0,d.Z)(e,2),a=r[0];r[1];0!==a&&(i++,n.done())})).next((function(){return i>0}))}},{key:"te",value:function(e,t){return Ac(e).get(t).next((function(e){return e?qs(e):null}))}}]),e}();function Ac(e){return Cs(e,"targets")}function Cc(e){return Cs(e,"targetGlobal")}function Nc(e){return Cs(e,"targetDocuments")}function Rc(e,t){var n=(0,d.Z)(e,2),r=n[0],i=n[1],a=(0,d.Z)(t,2),u=a[0],o=a[1],s=ai(r,u);return 0===s?ai(i,o):s}var Mc=function(){function e(t){(0,s.Z)(this,e),this.Sn=t,this.buffer=new Qi(Rc),this.Dn=0}return(0,c.Z)(e,[{key:"Cn",value:function(){return++this.Dn}},{key:"xn",value:function(e){var t=[e,this.Cn()];if(this.buffer.size<this.Sn)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();Rc(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),Vc=function(){function e(t,n,r){(0,s.Z)(this,e),this.garbageCollector=t,this.asyncQueue=n,this.localStore=r,this.Nn=null}return(0,c.Z)(e,[{key:"start",value:function(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.kn(6e4)}},{key:"stop",value:function(){this.Nn&&(this.Nn.cancel(),this.Nn=null)}},{key:"started",get:function(){return null!==this.Nn}},{key:"kn",value:function(e){var t=this;Pr("LruGarbageCollector","Garbage collection scheduled in ".concat(e,"ms")),this.Nn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.Nn=null,e.prev=1,e.next=4,t.localStore.collectGarbage(t.garbageCollector);case 4:e.next=14;break;case 6:if(e.prev=6,e.t0=e.catch(1),!Ri(e.t0)){e.next=12;break}Pr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e.t0),e.next=14;break;case 12:return e.next=14,Ti(e.t0);case 14:return e.next=16,t.kn(3e5);case 16:case"end":return e.stop()}}),e,null,[[1,6]])}))))}}]),e}(),Lc=function(){function e(t,n){(0,s.Z)(this,e),this.On=t,this.params=n}return(0,c.Z)(e,[{key:"calculateTargetCount",value:function(e,t){return this.On.Mn(e).next((function(e){return Math.floor(t/100*e)}))}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return _i.resolve(Ui.ot);var r=new Mc(t);return this.On.forEachTarget(e,(function(e){return r.xn(e.sequenceNumber)})).next((function(){return n.On.Fn(e,(function(e){return r.xn(e)}))})).next((function(){return r.maxValue}))}},{key:"removeTargets",value:function(e,t,n){return this.On.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.On.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Pr("LruGarbageCollector","Garbage collection skipped; disabled"),_i.resolve(kc)):this.getCacheSize(e).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(Pr("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),kc):n.$n(e,t)}))}},{key:"getCacheSize",value:function(e){return this.On.getCacheSize(e)}},{key:"$n",value:function(e,t){var n,r,i,a,u,o,s,c=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((function(t){return t>c.params.maximumSequenceNumbersToCollect?(Pr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(c.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=c.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),c.nthSequenceNumber(e,r)})).next((function(r){return n=r,u=Date.now(),c.removeTargets(e,n,t)})).next((function(t){return i=t,o=Date.now(),c.removeOrphanedDocuments(e,n)})).next((function(e){return s=Date.now(),Fr()<=k.in.DEBUG&&Pr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(a-l,"ms\n\tDetermined least recently used ").concat(r," in ")+(u-a)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(o-u)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(s-o)+"ms\n"+"Total Duration: ".concat(s-l,"ms")),_i.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})}))}}]),e}(),Oc=function(){function e(t,n){(0,s.Z)(this,e),this.db=t,this.garbageCollector=function(e,t){return new Lc(e,t)}(this,n)}return(0,c.Z)(e,[{key:"Mn",value:function(e){var t=this.Bn(e);return this.db.getTargetCache().getTargetCount(e).next((function(e){return t.next((function(t){return e+t}))}))}},{key:"Bn",value:function(e){var t=0;return this.Fn(e,(function(e){t++})).next((function(){return t}))}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"Fn",value:function(e,t){return this.Ln(e,(function(e,n){return t(n)}))}},{key:"addReference",value:function(e,t,n){return Fc(e,n)}},{key:"removeReference",value:function(e,t,n){return Fc(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return Fc(e,t)}},{key:"Un",value:function(e,t){return function(e,t){var n=!1;return Sc(e).Y((function(r){return Zc(e,r,t).next((function(e){return e&&(n=!0),_i.resolve(!e)}))})).next((function(){return n}))}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this.Ln(e,(function(u,o){if(o<=t){var s=n.Un(e,u).next((function(t){if(!t)return a++,r.getEntry(e,u).next((function(){return r.removeEntry(u,ci.min()),Nc(e).delete([0,rs(u.path)])}))}));i.push(s)}})).next((function(){return _i.waitFor(i)})).next((function(){return r.apply(e)})).next((function(){return a}))}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return Fc(e,t)}},{key:"Ln",value:function(e,t){var n,r=Nc(e),i=Ui.ot;return r.J({index:"documentTargetsIndex"},(function(e,r){var a=(0,d.Z)(e,2),u=a[0],o=(a[1],r.path),s=r.sequenceNumber;0===u?(i!==Ui.ot&&t(new vi(us(n)),i),i=s,n=o):i=Ui.ot})).next((function(){i!==Ui.ot&&t(new vi(us(n)),i)}))}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function Fc(e,t){return Nc(e).put(function(e,t){return{targetId:0,path:rs(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}var Pc=function(){function e(){(0,s.Z)(this,e),this.changes=new to((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return(0,c.Z)(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,Ra.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?_i.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),Uc=function(){function e(t){(0,s.Z)(this,e),this.wt=t}return(0,c.Z)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t,n){return Gc(e).put(n)}},{key:"removeEntry",value:function(e,t,n){return Gc(e).delete(function(e,t){var n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],Fs(t),n[n.length-1]]}(t,n))}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next((function(r){return r.byteSize+=t,n.qn(e,r)}))}},{key:"getEntry",value:function(e,t){var n=this,r=Ra.newInvalidDocument(t);return Gc(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(jc(t))},(function(e,i){r=n.Kn(t,i)})).next((function(){return r}))}},{key:"Gn",value:function(e,t){var n=this,r={size:0,document:Ra.newInvalidDocument(t)};return Gc(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(jc(t))},(function(e,i){r={document:n.Kn(t,i),size:xc(i)}})).next((function(){return r}))}},{key:"getEntries",value:function(e,t){var n=this,r=ro();return this.Qn(e,t,(function(e,t){var i=n.Kn(e,t);r=r.insert(e,i)})).next((function(){return r}))}},{key:"jn",value:function(e,t){var n=this,r=ro(),i=new Gi(vi.comparator);return this.Qn(e,t,(function(e,t){var a=n.Kn(e,t);r=r.insert(e,a),i=i.insert(e,xc(t))})).next((function(){return{documents:r,Wn:i}}))}},{key:"Qn",value:function(e,t,n){if(t.isEmpty())return _i.resolve();var r=new Qi(Qc);t.forEach((function(e){return r=r.add(e)}));var i=IDBKeyRange.bound(jc(r.first()),jc(r.last())),a=r.getIterator(),u=a.getNext();return Gc(e).J({index:"documentKeyIndex",range:i},(function(e,t,r){for(var i=vi.fromSegments([].concat((0,p.Z)(t.prefixPath),[t.collectionGroup,t.documentId]));u&&Qc(u,i)<0;)n(u,null),u=a.getNext();u&&u.isEqual(i)&&(n(u,t),u=a.hasNext()?a.getNext():null),u?r.q(jc(u)):r.done()})).next((function(){for(;u;)n(u,null),u=a.hasNext()?a.getNext():null}))}},{key:"getAllFromCollection",value:function(e,t,n){var r=this,i=[t.popLast().toArray(),t.lastSegment(),Fs(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],a=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Gc(e).K(IDBKeyRange.bound(i,a,!0)).next((function(e){var t,n=ro(),i=(0,o.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,u=r.Kn(vi.fromSegments(a.prefixPath.concat(a.collectionGroup,a.documentId)),a);n=n.insert(u.key,u)}}catch(s){i.e(s)}finally{i.f()}return n}))}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){var i=this,a=ro(),u=zc(t,n),o=zc(t,xi.max());return Gc(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,o,!0)},(function(e,t,n){var u=i.Kn(vi.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(a=a.insert(u.key,u)).size===r&&n.done()})).next((function(){return a}))}},{key:"newChangeBuffer",value:function(e){return new qc(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next((function(e){return e.byteSize}))}},{key:"getMetadata",value:function(e){return Kc(e).get("remoteDocumentGlobalKey").next((function(e){return Gr(!!e),e}))}},{key:"qn",value:function(e,t){return Kc(e).put("remoteDocumentGlobalKey",t)}},{key:"Kn",value:function(e,t){if(t){var n=function(e,t){var n;if(t.document)n=Bo(e.ne,t.document,!!t.hasCommittedMutations);else if(t.noDocument){var r=vi.fromSegments(t.noDocument.path),i=Us(t.noDocument.readTime);n=Ra.newNoDocument(r,i),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Kr();var a=vi.fromSegments(t.unknownDocument.path),u=Us(t.unknownDocument.version);n=Ra.newUnknownDocument(a,u)}return t.readTime&&n.setReadTime(function(e){var t=new si(e[0],e[1]);return ci.fromTimestamp(t)}(t.readTime)),n}(this.wt,t);if(!n.isNoDocument()||!n.version.isEqual(ci.min()))return n}return Ra.newInvalidDocument(e)}}]),e}();function Bc(e){return new Uc(e)}var qc=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this)).zn=e,i.trackRemovals=r,i.Hn=new to((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),i}return(0,c.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,i=new Qi((function(e,t){return ai(e.canonicalString(),t.canonicalString())}));return this.changes.forEach((function(a,u){var o=t.Hn.get(a);if(n.push(t.zn.removeEntry(e,a,o.readTime)),u.isValidDocument()){var s=Os(t.zn.wt,u);i=i.add(a.path.popLast());var c=xc(s);r+=c-o.size,n.push(t.zn.addEntry(e,a,s))}else if(r-=o.size,t.trackRemovals){var l=Os(t.zn.wt,u.convertToNoDocument(ci.min()));n.push(t.zn.addEntry(e,a,l))}})),i.forEach((function(r){n.push(t.zn.indexManager.addToCollectionParentIndex(e,r))})),n.push(this.zn.updateMetadata(e,r)),_i.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.zn.Gn(e,t).next((function(e){return n.Hn.set(t,{size:e.size,readTime:e.document.readTime}),e.document}))}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.zn.jn(e,t).next((function(e){var t=e.documents;return e.Wn.forEach((function(e,r){n.Hn.set(e,{size:r,readTime:t.get(e).readTime})})),t}))}}]),n}(Pc);function Kc(e){return Cs(e,"remoteDocumentGlobal")}function Gc(e){return Cs(e,"remoteDocumentsV14")}function jc(e){var t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function zc(e,t){var n=t.documentKey.path.toArray();return[e,Fs(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Qc(e,t){for(var n=e.path.toArray(),r=t.path.toArray(),i=0,a=0;a<n.length-2&&a<r.length-2;++a)if(i=ai(n[a],r[a]))return i;return(i=ai(n.length,r.length))||((i=ai(n[n.length-2],r[r.length-2]))||ai(n[n.length-1],r[r.length-1]))}var Hc=(0,c.Z)((function e(t,n){(0,s.Z)(this,e),this.overlayedDocument=t,this.mutatedFields=n})),Wc=function(){function e(t,n,r,i){(0,s.Z)(this,e),this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}return(0,c.Z)(e,[{key:"getDocument",value:function(e,t){var n=this,r=null;return this.documentOverlayCache.getOverlay(e,t).next((function(i){return r=i,n.getBaseDocument(e,t,r)})).next((function(e){return null!==r&&Uu(r.mutation,e,Xi.empty(),si.now()),e}))}},{key:"getDocuments",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.getLocalViewOfDocuments(e,t,fo()).next((function(){return t}))}))}},{key:"getLocalViewOfDocuments",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:fo(),i=oo();return this.populateOverlays(e,i,t).next((function(){return n.computeViews(e,t,i,r).next((function(e){var t=ao();return e.forEach((function(e,n){t=t.insert(e,n.overlayedDocument)})),t}))}))}},{key:"getOverlayedDocuments",value:function(e,t){var n=this,r=oo();return this.populateOverlays(e,r,t).next((function(){return n.computeViews(e,t,r,fo())}))}},{key:"populateOverlays",value:function(e,t,n){var r=[];return n.forEach((function(e){t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((function(e){e.forEach((function(e,n){t.set(e,n)}))}))}},{key:"computeViews",value:function(e,t,n,r){var i=ro(),a=co(),u=co();return t.forEach((function(e,t){var u=n.get(t.key);r.has(t.key)&&(void 0===u||u.mutation instanceof Gu)?i=i.insert(t.key,t):void 0!==u&&(a.set(t.key,u.mutation.getFieldMask()),Uu(u.mutation,t,u.mutation.getFieldMask(),si.now()))})),this.recalculateAndSaveOverlays(e,i).next((function(e){return e.forEach((function(e,t){return a.set(e,t)})),t.forEach((function(e,t){var n;return u.set(e,new Hc(t,null!==(n=a.get(e))&&void 0!==n?n:null))})),u}))}},{key:"recalculateAndSaveOverlays",value:function(e,t){var n=this,r=co(),i=new Gi((function(e,t){return e-t})),a=fo();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){var n,a=(0,o.Z)(e);try{var u=function(){var e=n.value;e.keys().forEach((function(n){var a=t.get(n);if(null!==a){var u=r.get(n)||Xi.empty();u=e.applyToLocalView(a,u),r.set(n,u);var o=(i.get(e.batchId)||fo()).add(n);i=i.insert(e.batchId,o)}}))};for(a.s();!(n=a.n()).done;)u()}catch(s){a.e(s)}finally{a.f()}})).next((function(){for(var u=[],o=i.getReverseIterator(),s=function(){var i=o.getNext(),s=i.key,c=i.value,l=so();c.forEach((function(e){if(!a.has(e)){var n=Fu(t.get(e),r.get(e));null!==n&&l.set(e,n),a=a.add(e)}})),u.push(n.documentOverlayCache.saveOverlays(e,s,l))};o.hasNext();)s();return _i.waitFor(u)})).next((function(){return r}))}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.recalculateAndSaveOverlays(e,t)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return function(e){return vi.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):ou(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}},{key:"getNextDocuments",value:function(e,t,n,r){var i=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((function(a){var u=r-a.size>0?i.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-a.size):_i.resolve(oo()),o=-1,s=a;return u.next((function(t){return _i.forEach(t,(function(t,n){return o<n.largestBatchId&&(o=n.largestBatchId),a.get(t)?_i.resolve():i.getBaseDocument(e,t,n).next((function(e){s=s.insert(t,e)}))})).next((function(){return i.populateOverlays(e,t,a)})).next((function(){return i.computeViews(e,s,t,fo())})).next((function(e){return{batchId:o,changes:uo(e)}}))}))}))}},{key:"getDocumentsMatchingDocumentQuery",value:function(e,t){return this.getDocument(e,new vi(t)).next((function(e){var t=ao();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(e,t,n){var r=this,i=t.collectionGroup,a=ao();return this.indexManager.getCollectionParents(e,i).next((function(u){return _i.forEach(u,(function(u){var o=function(e,t){return new nu(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,u.child(i));return r.getDocumentsMatchingCollectionQuery(e,o,n).next((function(e){e.forEach((function(e,t){a=a.insert(e,t)}))}))})).next((function(){return a}))}))}},{key:"getDocumentsMatchingCollectionQuery",value:function(e,t,n){var r,i=this;return this.remoteDocumentCache.getAllFromCollection(e,t.path,n).next((function(a){return r=a,i.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId)})).next((function(e){e.forEach((function(e,t){var n=t.getKey();null===r.get(n)&&(r=r.insert(n,Ra.newInvalidDocument(n)))}));var n=ao();return r.forEach((function(r,i){var a=e.get(r);void 0!==a&&Uu(a.mutation,i,Xi.empty(),si.now()),vu(t,i)&&(n=n.insert(r,i))})),n}))}},{key:"getBaseDocument",value:function(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):_i.resolve(Ra.newInvalidDocument(t))}}]),e}(),Xc=function(){function e(t){(0,s.Z)(this,e),this.wt=t,this.Jn=new Map,this.Yn=new Map}return(0,c.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return _i.resolve(this.Jn.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Jn.set(t.id,{id:(n=t).id,version:n.version,createTime:Co(n.createTime)}),_i.resolve()}},{key:"getNamedQuery",value:function(e,t){return _i.resolve(this.Yn.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.Yn.set(t.name,function(e){return{name:e.name,query:Gs(e.bundledQuery),readTime:Co(e.readTime)}}(t)),_i.resolve()}}]),e}(),Yc=function(){function e(){(0,s.Z)(this,e),this.overlays=new Gi(vi.comparator),this.Xn=new Map}return(0,c.Z)(e,[{key:"getOverlay",value:function(e,t){return _i.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function(e,t){var n=this,r=oo();return _i.forEach(t,(function(t){return n.getOverlay(e,t).next((function(e){null!==e&&r.set(t,e)}))})).next((function(){return r}))}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach((function(n,i){r.ie(e,t,i)})),_i.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,i=this.Xn.get(n);return void 0!==i&&(i.forEach((function(e){return r.overlays=r.overlays.remove(e)})),this.Xn.delete(n)),_i.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=oo(),i=t.length+1,a=new vi(t.child("")),u=this.overlays.getIteratorFrom(a);u.hasNext();){var o=u.getNext().value,s=o.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&o.largestBatchId>n&&r.set(o.getKey(),o)}return _i.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var i=new Gi((function(e,t){return e-t})),a=this.overlays.getIterator();a.hasNext();){var u=a.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>n){var o=i.get(u.largestBatchId);null===o&&(o=oo(),i=i.insert(u.largestBatchId,o)),o.set(u.getKey(),u)}}for(var s=oo(),c=i.getIterator();c.hasNext()&&(c.getNext().value.forEach((function(e,t){return s.set(e,t)})),!(s.size()>=r)););return _i.resolve(s)}},{key:"ie",value:function(e,t,n){var r=this.overlays.get(n.key);if(null!==r){var i=this.Xn.get(r.largestBatchId).delete(n.key);this.Xn.set(r.largestBatchId,i)}this.overlays=this.overlays.insert(n.key,new Ms(t,n));var a=this.Xn.get(t);void 0===a&&(a=fo(),this.Xn.set(t,a)),this.Xn.set(t,a.add(n.key))}}]),e}(),Jc=function(){function e(){(0,s.Z)(this,e),this.Zn=new Qi($c.ts),this.es=new Qi($c.ns)}return(0,c.Z)(e,[{key:"isEmpty",value:function(){return this.Zn.isEmpty()}},{key:"addReference",value:function(e,t){var n=new $c(e,t);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}},{key:"ss",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.rs(new $c(e,t))}},{key:"os",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"us",value:function(e){var t=this,n=new vi(new hi([])),r=new $c(n,e),i=new $c(n,e+1),a=[];return this.es.forEachInRange([r,i],(function(e){t.rs(e),a.push(e.key)})),a}},{key:"cs",value:function(){var e=this;this.Zn.forEach((function(t){return e.rs(t)}))}},{key:"rs",value:function(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}},{key:"hs",value:function(e){var t=new vi(new hi([])),n=new $c(t,e),r=new $c(t,e+1),i=fo();return this.es.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new $c(e,0),n=this.Zn.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),$c=function(){function e(t,n){(0,s.Z)(this,e),this.key=t,this.ls=n}return(0,c.Z)(e,null,[{key:"ts",value:function(e,t){return vi.comparator(e.key,t.key)||ai(e.ls,t.ls)}},{key:"ns",value:function(e,t){return ai(e.ls,t.ls)||vi.comparator(e.key,t.key)}}]),e}(),el=function(){function e(t,n){(0,s.Z)(this,e),this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.fs=1,this.ds=new Qi($c.ts)}return(0,c.Z)(e,[{key:"checkEmpty",value:function(e){return _i.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.fs;this.fs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var a=new Ns(i,t,n,r);this.mutationQueue.push(a);var u,s=(0,o.Z)(r);try{for(s.s();!(u=s.n()).done;){var c=u.value;this.ds=this.ds.add(new $c(c.key,i)),this.indexManager.addToCollectionParentIndex(e,c.key.path.popLast())}}catch(l){s.e(l)}finally{s.f()}return _i.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return _i.resolve(this._s(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.ws(n),i=r<0?0:r;return _i.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return _i.resolve(0===this.mutationQueue.length?-1:this.fs-1)}},{key:"getAllMutationBatches",value:function(e){return _i.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new $c(t,0),i=new $c(t,Number.POSITIVE_INFINITY),a=[];return this.ds.forEachInRange([r,i],(function(e){var t=n._s(e.ls);a.push(t)})),_i.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Qi(ai);return t.forEach((function(e){var t=new $c(e,0),i=new $c(e,Number.POSITIVE_INFINITY);n.ds.forEachInRange([t,i],(function(e){r=r.add(e.ls)}))})),_i.resolve(this.gs(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;vi.isDocumentKey(i)||(i=i.child(""));var a=new $c(new vi(i),0),u=new Qi(ai);return this.ds.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(u=u.add(e.ls)),!0)}),a),_i.resolve(this.gs(u))}},{key:"gs",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t._s(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;Gr(0===this.ys(t.batchId,"removed")),this.mutationQueue.shift();var r=this.ds;return _i.forEach(t.mutations,(function(i){var a=new $c(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.ds=r}))}},{key:"In",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new $c(t,0),r=this.ds.firstAfterOrEqual(n);return _i.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.mutationQueue.length,_i.resolve()}},{key:"ys",value:function(e,t){return this.ws(e)}},{key:"ws",value:function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}},{key:"_s",value:function(e){var t=this.ws(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}]),e}(),tl=function(){function e(t){(0,s.Z)(this,e),this.ps=t,this.docs=new Gi(vi.comparator),this.size=0}return(0,c.Z)(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),i=r?r.size:0,a=this.ps(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return _i.resolve(n?n.document.mutableCopy():Ra.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=ro();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():Ra.newInvalidDocument(e))})),_i.resolve(r)}},{key:"getAllFromCollection",value:function(e,t,n){for(var r=ro(),i=new vi(t.child("")),a=this.docs.getIteratorFrom(i);a.hasNext();){var u=a.getNext(),o=u.key,s=u.value.document;if(!t.isPrefixOf(o.path))break;o.path.length>t.length+1||Ii(bi(s),n)<=0||(r=r.insert(s.key,s.mutableCopy()))}return _i.resolve(r)}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){Kr()}},{key:"Is",value:function(e,t){return _i.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new nl(this)}},{key:"getSize",value:function(e){return _i.resolve(this.size)}}]),e}(),nl=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this)).zn=e,r}return(0,c.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.isValidDocument()?n.push(t.zn.addEntry(e,i)):t.zn.removeEntry(r)})),_i.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.zn.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.zn.getEntries(e,t)}}]),n}(Pc),rl=function(){function e(t){(0,s.Z)(this,e),this.persistence=t,this.Ts=new to((function(e){return La(e)}),Oa),this.lastRemoteSnapshotVersion=ci.min(),this.highestTargetId=0,this.Es=0,this.As=new Jc,this.targetCount=0,this.Rs=_c.An()}return(0,c.Z)(e,[{key:"forEachTarget",value:function(e,t){return this.Ts.forEach((function(e,n){return t(n)})),_i.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return _i.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return _i.resolve(this.Es)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Rs.next(),_i.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Es&&(this.Es=t),_i.resolve()}},{key:"vn",value:function(e){this.Ts.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Rs=new _c(t),this.highestTargetId=t),e.sequenceNumber>this.Es&&(this.Es=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.vn(t),this.targetCount+=1,_i.resolve()}},{key:"updateTargetData",value:function(e,t){return this.vn(t),_i.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Ts.delete(t.target),this.As.us(t.targetId),this.targetCount-=1,_i.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Ts.forEach((function(u,o){o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r.Ts.delete(u),a.push(r.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),_i.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return _i.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Ts.get(t)||null;return _i.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.As.ss(t,n),_i.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.As.os(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),_i.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.As.us(t),_i.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.As.hs(t);return _i.resolve(n)}},{key:"containsKey",value:function(e,t){return _i.resolve(this.As.containsKey(t))}}]),e}(),il=function(){function e(t,n){var r=this;(0,s.Z)(this,e),this.bs={},this.overlays={},this.Ps=new Ui(0),this.vs=!1,this.vs=!0,this.referenceDelegate=t(this),this.Vs=new rl(this),this.indexManager=new lc,this.remoteDocumentCache=new tl((function(e){return r.referenceDelegate.Ss(e)})),this.wt=new Ls(n),this.Ds=new Xc(this.wt)}return(0,c.Z)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.vs=!1,Promise.resolve()}},{key:"started",get:function(){return this.vs}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new Yc,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.bs[e.toKey()];return n||(n=new el(t,this.referenceDelegate),this.bs[e.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Vs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.Ds}},{key:"runTransaction",value:function(e,t,n){var r=this;Pr("MemoryPersistence","Starting transaction:",e);var i=new al(this.Ps.next());return this.referenceDelegate.Cs(),n(i).next((function(e){return r.referenceDelegate.xs(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Ns",value:function(e,t){return _i.or(Object.values(this.bs).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),al=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return(0,c.Z)(n)}(Ei),ul=function(){function e(t){(0,s.Z)(this,e),this.persistence=t,this.ks=new Jc,this.Os=null}return(0,c.Z)(e,[{key:"Fs",get:function(){if(this.Os)return this.Os;throw Kr()}},{key:"addReference",value:function(e,t,n){return this.ks.addReference(n,t),this.Fs.delete(n.toString()),_i.resolve()}},{key:"removeReference",value:function(e,t,n){return this.ks.removeReference(n,t),this.Fs.add(n.toString()),_i.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Fs.add(t.toString()),_i.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.ks.us(t.targetId).forEach((function(e){return n.Fs.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.Fs.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"Cs",value:function(){this.Os=new Set}},{key:"xs",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _i.forEach(this.Fs,(function(r){var i=vi.fromPath(r);return t.$s(e,i).next((function(e){e||n.removeEntry(i,ci.min())}))})).next((function(){return t.Os=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.$s(e,t).next((function(e){e?n.Fs.delete(t.toString()):n.Fs.add(t.toString())}))}},{key:"Ss",value:function(e){return 0}},{key:"$s",value:function(e,t){var n=this;return _i.or([function(){return _i.resolve(n.ks.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Ns(e,t)}])}}],[{key:"Ms",value:function(t){return new e(t)}}]),e}(),ol=function(){function e(t){(0,s.Z)(this,e),this.wt=t}return(0,c.Z)(e,[{key:"O",value:function(e,t,n,r){var i=this,a=new Di("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",os,{unique:!0}),e.createObjectStore("documentMutations")}(e),sl(e),function(e){e.createObjectStore("remoteDocuments")}(e));var u=_i.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),sl(e)),u=u.next((function(){return function(e){var t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ci.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(a)}))),n<4&&r>=4&&(0!==n&&(u=u.next((function(){return function(e,t){return t.store("mutations").K().next((function(n){e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",os,{unique:!0});var r=t.store("mutations"),i=n.map((function(e){return r.put(e)}));return _i.waitFor(i)}))}(e,a)}))),u=u.next((function(){!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(u=u.next((function(){return i.Bs(a)}))),n<6&&r>=6&&(u=u.next((function(){return function(e){e.createObjectStore("remoteDocumentGlobal")}(e),i.Ls(a)}))),n<7&&r>=7&&(u=u.next((function(){return i.Us(a)}))),n<8&&r>=8&&(u=u.next((function(){return i.qs(e,a)}))),n<9&&r>=9&&(u=u.next((function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(u=u.next((function(){return i.Ks(a)}))),n<11&&r>=11&&(u=u.next((function(){!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(u=u.next((function(){!function(e){var t=e.createObjectStore("documentOverlays",{keyPath:xs});t.createIndex("collectionPathOverlayIndex",Is,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Zs,{unique:!1})}(e)}))),n<13&&r>=13&&(u=u.next((function(){return function(e){var t=e.createObjectStore("remoteDocumentsV14",{keyPath:hs});t.createIndex("documentKeyIndex",fs),t.createIndex("collectionGroupIndex",ds)}(e)})).next((function(){return i.Gs(e,a)})).next((function(){return e.deleteObjectStore("remoteDocuments")}))),n<14&&r>=14&&(u=u.next((function(){return i.Qs(e,a)}))),n<15&&r>=15&&(u=u.next((function(){return function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:gs}).createIndex("sequenceNumberIndex",ks,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:ws}).createIndex("documentKeyIndex",bs,{unique:!1})}(e)}))),u}},{key:"Ls",value:function(e){var t=0;return e.store("remoteDocuments").J((function(e,n){t+=xc(n)})).next((function(){var n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}},{key:"Bs",value:function(e){var t=this,n=e.store("mutationQueues"),r=e.store("mutations");return n.K().next((function(n){return _i.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.K("userMutationsIndex",i).next((function(r){return _i.forEach(r,(function(r){Gr(r.userId===n.userId);var i=Bs(t.wt,r);return bc(e,n.userId,i).next((function(){}))}))}))}))}))}},{key:"Us",value:function(e){var t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((function(e){var r=[];return n.J((function(n,i){var a=new hi(n),u=function(e){return[0,rs(e)]}(a);r.push(t.get(u).next((function(n){return n?_i.resolve():function(n){return t.put({targetId:0,path:rs(n),sequenceNumber:e.highestListenSequenceNumber})}(a)})))})).next((function(){return _i.waitFor(r)}))}))}},{key:"qs",value:function(e,t){e.createObjectStore("collectionParents",{keyPath:ms});var n=t.store("collectionParents"),r=new hc,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:rs(i)})}};return t.store("remoteDocuments").J({H:!0},(function(e,t){var n=new hi(e);return i(n.popLast())})).next((function(){return t.store("documentMutations").J({H:!0},(function(e,t){var n=(0,d.Z)(e,3),r=(n[0],n[1]),a=(n[2],us(r));return i(a.popLast())}))}))}},{key:"Ks",value:function(e){var t=this,n=e.store("targets");return n.J((function(e,r){var i=qs(r),a=Ks(t.wt,i);return n.put(a)}))}},{key:"Gs",value:function(e,t){var n=t.store("remoteDocuments"),r=[];return n.J((function(e,n){var i,a=t.store("remoteDocumentsV14"),u=(i=n,i.document?new vi(hi.fromString(i.document.name).popFirst(5)):i.noDocument?vi.fromSegments(i.noDocument.path):i.unknownDocument?vi.fromSegments(i.unknownDocument.path):Kr()).path.toArray(),o={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(a.put(o))})).next((function(){return _i.waitFor(r)}))}},{key:"Qs",value:function(e,t){var n=this,r=t.store("mutations"),i=Bc(this.wt),a=new il(ul.Ms,this.wt.ne);return r.K().next((function(e){var r=new Map;return e.forEach((function(e){var t,i=null!==(t=r.get(e.userId))&&void 0!==t?t:fo();Bs(n.wt,e).keys().forEach((function(e){return i=i.add(e)})),r.set(e.userId,i)})),_i.forEach(r,(function(e,r){var u=new Vr(r),o=Ys.se(n.wt,u),s=a.getIndexManager(u),c=Ic.se(u,n.wt,s,a.referenceDelegate);return new Wc(i,c,o,s).recalculateAndSaveOverlaysForDocumentKeys(new As(t,Ui.ot),e).next()}))}))}}]),e}();function sl(e){e.createObjectStore("targetDocuments",{keyPath:ys}).createIndex("documentTargetsIndex",ps,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",vs,{unique:!0}),e.createObjectStore("targetGlobal")}var cl="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",ll=function(){function e(t,n,r,i,a,u,o,c,l,h){var f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:14;if((0,s.Z)(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.js=a,this.window=u,this.document=o,this.Ws=l,this.zs=h,this.Hs=f,this.Ps=null,this.vs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Js=null,this.inForeground=!1,this.Ys=null,this.Xs=null,this.Zs=Number.NEGATIVE_INFINITY,this.ti=function(e){return Promise.resolve()},!e.V())throw new Qr(zr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Oc(this,i),this.ei=n+"main",this.wt=new Ls(c),this.ni=new Ai(this.ei,this.Hs,new ol(this.wt)),this.Vs=new Dc(this.referenceDelegate,this.wt),this.remoteDocumentCache=Bc(this.wt),this.Ds=new Hs,this.window&&this.window.localStorage?this.si=this.window.localStorage:(this.si=null,!1===h&&Ur("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return(0,c.Z)(e,[{key:"start",value:function(){var e=this;return this.ii().then((function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Qr(zr.FAILED_PRECONDITION,cl);return e.ri(),e.oi(),e.ui(),e.runTransaction("getHighestListenSequenceNumber","readonly",(function(t){return e.Vs.getHighestSequenceNumber(t)}))})).then((function(t){e.Ps=new Ui(t,e.Ws)})).then((function(){e.vs=!0})).catch((function(t){return e.ni&&e.ni.close(),Promise.reject(t)}))}},{key:"ci",value:function(e){var t=this;return this.ti=function(){var n=(0,y.Z)((0,v.Z)().mark((function n(r){return(0,v.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.ni.F(function(){var t=(0,y.Z)((0,v.Z)().mark((function t(n){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.js.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.ii();case 4:case"end":return e.stop()}}),e)})))))}},{key:"ii",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(t){return fl(t).put({clientId:e.clientId,updateTimeMs:Date.now(),networkEnabled:e.networkEnabled,inForeground:e.inForeground}).next((function(){if(e.isPrimary)return e.ai(t).next((function(t){t||(e.isPrimary=!1,e.js.enqueueRetryable((function(){return e.ti(!1)})))}))})).next((function(){return e.hi(t)})).next((function(n){return e.isPrimary&&!n?e.li(t).next((function(){return!1})):!!n&&e.fi(t).next((function(){return!0}))}))})).catch((function(t){if(Ri(t))return Pr("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return Pr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((function(t){e.isPrimary!==t&&e.js.enqueueRetryable((function(){return e.ti(t)})),e.isPrimary=t}))}},{key:"ai",value:function(e){var t=this;return hl(e).get("owner").next((function(e){return _i.resolve(t.di(e))}))}},{key:"_i",value:function(e){return fl(e).delete(this.clientId)}},{key:"wi",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t,n,r,i,a=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.mi(this.Zs,18e5)){e.next=6;break}return this.Zs=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var t=Cs(e,"clientMetadata");return t.K().next((function(e){var n=a.gi(e,18e5),r=e.filter((function(e){return-1===n.indexOf(e)}));return _i.forEach(r,(function(e){return t.delete(e.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}));case 4:if(t=e.sent,this.si){n=(0,o.Z)(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.si.removeItem(this.yi(i.clientId))}catch(u){n.e(u)}finally{n.f()}}case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ui",value:function(){var e=this;this.Xs=this.js.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return e.ii().then((function(){return e.wi()})).then((function(){return e.ui()}))}))}},{key:"di",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"hi",value:function(e){var t=this;return this.zs?_i.resolve(!0):hl(e).get("owner").next((function(n){if(null!==n&&t.mi(n.leaseTimestampMs,5e3)&&!t.pi(n.ownerId)){if(t.di(n)&&t.networkEnabled)return!0;if(!t.di(n)){if(!n.allowTabSynchronization)throw new Qr(zr.FAILED_PRECONDITION,cl);return!1}}return!(!t.networkEnabled||!t.inForeground)||fl(e).K().next((function(e){return void 0===t.gi(e,5e3).find((function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(e){return t.isPrimary!==e&&Pr("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e}))}},{key:"shutdown",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.vs=!1,this.Ii(),this.Xs&&(this.Xs.cancel(),this.Xs=null),this.Ti(),this.Ei(),e.next=7,this.ni.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(function(e){var n=new As(e,Ui.ot);return t.li(n).next((function(){return t._i(n)}))}));case 7:this.ni.close(),this.Ai();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gi",value:function(e,t){var n=this;return e.filter((function(e){return n.mi(e.updateTimeMs,t)&&!n.pi(e.clientId)}))}},{key:"Ri",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",(function(t){return fl(t).K().next((function(t){return e.gi(t,18e5).map((function(e){return e.clientId}))}))}))}},{key:"started",get:function(){return this.vs}},{key:"getMutationQueue",value:function(e,t){return Ic.se(e,this.wt,t,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.Vs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getIndexManager",value:function(e){return new dc(e,this.wt.ne.databaseId)}},{key:"getDocumentOverlayCache",value:function(e){return Ys.se(this.wt,e)}},{key:"getBundleCache",value:function(){return this.Ds}},{key:"runTransaction",value:function(e,t,n){var r=this;Pr("IndexedDbPersistence","Starting transaction:",e);var i,a,u="readonly"===t?"readonly":"readwrite",o=15===(i=this.Hs)?Ds:14===i?_s:13===i?Ss:12===i?Ts:11===i?Es:void Kr();return this.ni.runTransaction(e,u,o,(function(i){return a=new As(i,r.Ps?r.Ps.next():Ui.ot),"readwrite-primary"===t?r.ai(a).next((function(e){return!!e||r.hi(a)})).next((function(t){if(!t)throw Ur("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.js.enqueueRetryable((function(){return r.ti(!1)})),new Qr(zr.FAILED_PRECONDITION,Zi);return n(a)})).next((function(e){return r.fi(a).next((function(){return e}))})):r.bi(a).next((function(){return n(a)}))})).then((function(e){return a.raiseOnCommittedEvent(),e}))}},{key:"bi",value:function(e){var t=this;return hl(e).get("owner").next((function(e){if(null!==e&&t.mi(e.leaseTimestampMs,5e3)&&!t.pi(e.ownerId)&&!t.di(e)&&!(t.zs||t.allowTabSynchronization&&e.allowTabSynchronization))throw new Qr(zr.FAILED_PRECONDITION,cl)}))}},{key:"fi",value:function(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return hl(e).put("owner",t)}},{key:"li",value:function(e){var t=this,n=hl(e);return n.get("owner").next((function(e){return t.di(e)?(Pr("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):_i.resolve()}))}},{key:"mi",value:function(e,t){var n=Date.now();return!(e<n-t)&&(!(e>n)||(Ur("Detected an update time that is in the future: ".concat(e," > ").concat(n)),!1))}},{key:"ri",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ys=function(){e.js.enqueueAndForget((function(){return e.inForeground="visible"===e.document.visibilityState,e.ii()}))},this.document.addEventListener("visibilitychange",this.Ys),this.inForeground="visible"===this.document.visibilityState)}},{key:"Ti",value:function(){this.Ys&&(this.document.removeEventListener("visibilitychange",this.Ys),this.Ys=null)}},{key:"oi",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Js=function(){t.Ii(),(0,w.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&t.js.enterRestrictedMode(!0),t.js.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("pagehide",this.Js))}},{key:"Ei",value:function(){this.Js&&(this.window.removeEventListener("pagehide",this.Js),this.Js=null)}},{key:"pi",value:function(e){var t;try{var n=null!==(null===(t=this.si)||void 0===t?void 0:t.getItem(this.yi(e)));return Pr("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return Ur("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"Ii",value:function(){if(this.si)try{this.si.setItem(this.yi(this.clientId),String(Date.now()))}catch(M){Ur("Failed to set zombie client id.",M)}}},{key:"Ai",value:function(){if(this.si)try{this.si.removeItem(this.yi(this.clientId))}catch(M){}}},{key:"yi",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"V",value:function(){return Ai.V()}}]),e}();function hl(e){return Cs(e,"owner")}function fl(e){return Cs(e,"clientMetadata")}function dl(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var vl=function(){function e(t,n,r,i){(0,s.Z)(this,e),this.targetId=t,this.fromCache=n,this.Pi=r,this.vi=i}return(0,c.Z)(e,null,[{key:"Vi",value:function(t,n){var r,i=fo(),a=fo(),u=(0,o.Z)(n.docChanges);try{for(u.s();!(r=u.n()).done;){var s=r.value;switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:a=a.add(s.doc.key)}}}catch(c){u.e(c)}finally{u.f()}return new e(t,n.fromCache,i,a)}}]),e}(),yl=function(){function e(){(0,s.Z)(this,e),this.Si=!1}return(0,c.Z)(e,[{key:"initialize",value:function(e,t){this.Di=e,this.indexManager=t,this.Si=!0}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this;return this.Ci(e,t).next((function(a){return a||i.xi(e,t,r,n)})).next((function(n){return n||i.Ni(e,t)}))}},{key:"Ci",value:function(e,t){return _i.resolve(null)}},{key:"xi",value:function(e,t,n,r){var i=this;return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||r.isEqual(ci.min())?this.Ni(e,t):this.Di.getDocuments(e,n).next((function(a){var u=i.ki(t,a);return i.Oi(t,u,n,r)?i.Ni(e,t):(Fr()<=k.in.DEBUG&&Pr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),du(t)),i.Mi(e,u,t,wi(r,-1)))}))}},{key:"ki",value:function(e,t){var n=new Qi(pu(e));return t.forEach((function(t,r){vu(e,r)&&(n=n.add(r))})),n}},{key:"Oi",value:function(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Ni",value:function(e,t){return Fr()<=k.in.DEBUG&&Pr("QueryEngine","Using full collection scan to execute query:",du(t)),this.Di.getDocumentsMatchingQuery(e,t,xi.min())}},{key:"Mi",value:function(e,t,n,r){return this.Di.getDocumentsMatchingQuery(e,n,r).next((function(e){return t.forEach((function(t){e=e.insert(t.key,t)})),e}))}}]),e}(),pl=function(){function e(t,n,r,i){(0,s.Z)(this,e),this.persistence=t,this.Fi=n,this.wt=i,this.$i=new Gi(ai),this.Bi=new to((function(e){return La(e)}),Oa),this.Li=new Map,this.Ui=t.getRemoteDocumentCache(),this.Vs=t.getTargetCache(),this.Ds=t.getBundleCache(),this.qi(r)}return(0,c.Z)(e,[{key:"qi",value:function(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Wc(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.$i)}))}}]),e}();function ml(e,t,n,r){return new pl(e,t,n,r)}function gl(e,t){return kl.apply(this,arguments)}function kl(){return kl=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=jr(t),e.next=3,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.mutationQueue.getAllMutationBatches(e).next((function(i){return t=i,r.qi(n),r.mutationQueue.getAllMutationBatches(e)})).next((function(n){var i,a=[],u=[],s=fo(),c=(0,o.Z)(t);try{for(c.s();!(i=c.n()).done;){var l=i.value;a.push(l.batchId);var h,f=(0,o.Z)(l.mutations);try{for(f.s();!(h=f.n()).done;){var d=h.value;s=s.add(d.key)}}catch(w){f.e(w)}finally{f.f()}}}catch(w){c.e(w)}finally{c.f()}var v,y=(0,o.Z)(n);try{for(y.s();!(v=y.n()).done;){var p=v.value;u.push(p.batchId);var m,g=(0,o.Z)(p.mutations);try{for(g.s();!(m=g.n()).done;){var k=m.value;s=s.add(k.key)}}catch(w){g.e(w)}finally{g.f()}}}catch(w){y.e(w)}finally{y.f()}return r.localDocuments.getDocuments(e,s).next((function(e){return{Ki:e,removedBatchIds:a,addedBatchIds:u}}))}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),kl.apply(this,arguments)}function wl(e,t){var n=jr(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n.Ui.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),u=_i.resolve();return a.forEach((function(e){u=u.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);Gr(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),u.next((function(){return e.mutationQueue.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){for(var t=fo(),n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}function bl(e){var t=jr(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.Vs.getLastRemoteSnapshotVersion(e)}))}function xl(e,t){var n=jr(e),r=t.snapshotVersion,i=n.$i;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var a=n.Ui.newChangeBuffer({trackRemovals:!0});i=n.$i;var u=[];t.targetChanges.forEach((function(a,o){var s=i.get(o);if(s){u.push(n.Vs.removeMatchingKeys(e,a.removedDocuments,o).next((function(){return n.Vs.addMatchingKeys(e,a.addedDocuments,o)})));var c=s.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(o)?c=c.withResumeToken(Yi.EMPTY_BYTE_STRING,ci.min()).withLastLimboFreeSnapshotVersion(ci.min()):a.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(a.resumeToken,r)),i=i.insert(o,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(s,c,a)&&u.push(n.Vs.updateTargetData(e,c))}}));var o=ro(),s=fo();if(t.documentUpdates.forEach((function(r){t.resolvedLimboDocuments.has(r)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),u.push(Il(e,a,t.documentUpdates).next((function(e){o=e.Gi,s=e.Qi}))),!r.isEqual(ci.min())){var c=n.Vs.getLastRemoteSnapshotVersion(e).next((function(t){return n.Vs.setTargetsMetadata(e,e.currentSequenceNumber,r)}));u.push(c)}return _i.waitFor(u).next((function(){return a.apply(e)})).next((function(){return n.localDocuments.getLocalViewOfDocuments(e,o,s)})).next((function(){return o}))})).then((function(e){return n.$i=i,e}))}function Il(e,t,n){var r=fo(),i=fo();return n.forEach((function(e){return r=r.add(e)})),t.getEntries(e,r).next((function(e){var r=ro();return n.forEach((function(n,a){var u=e.get(n);a.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(n)),a.isNoDocument()&&a.version.isEqual(ci.min())?(t.removeEntry(n,a.readTime),r=r.insert(n,a)):!u.isValidDocument()||a.version.compareTo(u.version)>0||0===a.version.compareTo(u.version)&&u.hasPendingWrites?(t.addEntry(a),r=r.insert(n,a)):Pr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",u.version," Watch version:",a.version)})),{Gi:r,Qi:i}}))}function Zl(e,t){var n=jr(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)}))}function El(e,t){var n=jr(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.Vs.getTargetData(e,t).next((function(i){return i?(r=i,_i.resolve(r)):n.Vs.allocateTargetId(e).next((function(i){return r=new Vs(t,i,0,e.currentSequenceNumber),n.Vs.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.$i.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.$i=n.$i.insert(e.targetId,e),n.Bi.set(t,e.targetId)),e}))}function Tl(e,t,n){return Sl.apply(this,arguments)}function Sl(){return Sl=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a,u;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=jr(t),a=i.$i.get(n),u=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",u,(function(e){return i.persistence.referenceDelegate.removeTarget(e,a)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),Ri(e.t1)){e.next=12;break}throw e.t1;case 12:Pr("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.$i=i.$i.remove(n),i.Bi.delete(a.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])}))),Sl.apply(this,arguments)}function _l(e,t,n){var r=jr(e),i=ci.min(),a=fo();return r.persistence.runTransaction("Execute query","readonly",(function(e){return function(e,t,n){var r=jr(e),i=r.Bi.get(n);return void 0!==i?_i.resolve(r.$i.get(i)):r.Vs.getTargetData(t,n)}(r,e,cu(t)).next((function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Vs.getMatchingKeysForTargetId(e,t.targetId).next((function(e){a=e}))})).next((function(){return r.Fi.getDocumentsMatchingQuery(e,t,n?i:ci.min(),n?a:fo())})).next((function(e){return Cl(r,yu(t),e),{documents:e,ji:a}}))}))}function Dl(e,t){var n=jr(e),r=jr(n.Vs),i=n.$i.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(e){return r.te(e,t).next((function(e){return e?e.target:null}))}))}function Al(e,t){var n=jr(e),r=n.Li.get(t)||ci.min();return n.persistence.runTransaction("Get new document changes","readonly",(function(e){return n.Ui.getAllFromCollectionGroup(e,t,wi(r,-1),Number.MAX_SAFE_INTEGER)})).then((function(e){return Cl(n,t,e),e}))}function Cl(e,t,n){var r=ci.min();n.forEach((function(e,t){t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Li.set(t,r)}function Nl(e,t,n,r){return Rl.apply(this,arguments)}function Rl(){return Rl=(0,y.Z)((0,v.Z)().mark((function e(t,n,r,i){var a,u,s,c,l,h,f,d,y,p;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=jr(t),u=fo(),s=ro(),c=(0,o.Z)(r);try{for(c.s();!(l=c.n()).done;)h=l.value,f=n.Wi(h.metadata.name),h.document&&(u=u.add(f)),(d=n.zi(h)).setReadTime(n.Hi(h.metadata.readTime)),s=s.insert(f,d)}catch(v){c.e(v)}finally{c.f()}return y=a.Ui.newChangeBuffer({trackRemovals:!0}),e.next=7,El(a,function(e){return cu(iu(hi.fromString("__bundle__/docs/".concat(e))))}(i));case 7:return p=e.sent,e.abrupt("return",a.persistence.runTransaction("Apply bundle documents","readwrite",(function(e){return Il(e,y,s).next((function(t){return y.apply(e),t})).next((function(t){return a.Vs.removeMatchingKeysForTargetId(e,p.targetId).next((function(){return a.Vs.addMatchingKeys(e,u,p.targetId)})).next((function(){return a.localDocuments.getLocalViewOfDocuments(e,t.Gi,t.Qi)})).next((function(){return t.Gi}))}))})));case 9:case"end":return e.stop()}}),e)}))),Rl.apply(this,arguments)}function Ml(e,t){return Vl.apply(this,arguments)}function Vl(){return Vl=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a,u=arguments;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:fo(),e.next=3,El(t,cu(Gs(n.bundledQuery)));case 3:return i=e.sent,a=jr(t),e.abrupt("return",a.persistence.runTransaction("Save named query","readwrite",(function(e){var t=Co(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a.Ds.saveNamedQuery(e,n);var u=i.withResumeToken(Yi.EMPTY_BYTE_STRING,t);return a.$i=a.$i.insert(u.targetId,u),a.Vs.updateTargetData(e,u).next((function(){return a.Vs.removeMatchingKeysForTargetId(e,i.targetId)})).next((function(){return a.Vs.addMatchingKeys(e,r,i.targetId)})).next((function(){return a.Ds.saveNamedQuery(e,n)}))})));case 6:case"end":return e.stop()}}),e)}))),Vl.apply(this,arguments)}function Ll(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function Ol(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function Fl(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var Pl=function(){function e(t,n,r,i){(0,s.Z)(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return(0,c.Z)(e,[{key:"Yi",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Ji",value:function(t,n,r){var i,a=JSON.parse(r),u="object"==typeof a&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return u&&a.error&&((u="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(i=new Qr(a.error.code,a.error.message))),u?new e(t,n,a.state,i):(Ur("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),Ul=function(){function e(t,n,r){(0,s.Z)(this,e),this.targetId=t,this.state=n,this.error=r}return(0,c.Z)(e,[{key:"Yi",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Ji",value:function(t,n){var r,i=JSON.parse(n),a="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&((a="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Qr(i.error.code,i.error.message))),a?new e(t,i.state,r):(Ur("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),Bl=function(){function e(t,n){(0,s.Z)(this,e),this.clientId=t,this.activeTargetIds=n}return(0,c.Z)(e,null,[{key:"Ji",value:function(t,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,a=yo(),u=0;i&&u<r.activeTargetIds.length;++u)i=ca(r.activeTargetIds[u]),a=a.add(r.activeTargetIds[u]);return i?new e(t,a):(Ur("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),ql=function(){function e(t,n){(0,s.Z)(this,e),this.clientId=t,this.onlineState=n}return(0,c.Z)(e,null,[{key:"Ji",value:function(t){var n=JSON.parse(t);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(Ur("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),Kl=function(){function e(){(0,s.Z)(this,e),this.activeTargetIds=yo()}return(0,c.Z)(e,[{key:"Xi",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Zi",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"Yi",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),Gl=function(){function e(t,n,r,i,a){(0,s.Z)(this,e),this.window=t,this.js=n,this.persistenceKey=r,this.tr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.er=this.nr.bind(this),this.sr=new Gi(ai),this.started=!1,this.ir=[];var u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.rr=Ll(this.persistenceKey,this.tr),this.ur=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.sr=this.sr.insert(this.tr,new Kl),this.cr=new RegExp("^firestore_clients_".concat(u,"_([^_]*)$")),this.ar=new RegExp("^firestore_mutations_".concat(u,"_(\\d+)(?:_(.*))?$")),this.hr=new RegExp("^firestore_targets_".concat(u,"_(\\d+)$")),this.lr=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.dr=function(e){return"firestore_bundle_loaded_v2_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.er)}return(0,c.Z)(e,[{key:"start",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t,n,r,i,a,u,s,c,l,h,f,d=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.Ri();case 2:t=e.sent,n=(0,o.Z)(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.tr){e.next=10;break}return e.abrupt("continue",12);case 10:(a=this.getItem(Ll(this.persistenceKey,i)))&&(u=Bl.Ji(i,a))&&(this.sr=this.sr.insert(u.clientId,u));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this._r(),(s=this.storage.getItem(this.lr))&&(c=this.wr(s))&&this.mr(c),l=(0,o.Z)(this.ir);try{for(l.s();!(h=l.n()).done;)f=h.value,this.nr(f)}catch(v){l.e(v)}finally{l.f()}this.ir=[],this.window.addEventListener("pagehide",(function(){return d.shutdown()})),this.started=!0;case 28:case"end":return e.stop()}}),e,this,[[4,16,19,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"writeSequenceNumber",value:function(e){this.setItem(this.ur,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.gr(this.sr)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.sr.forEach((function(n,r){r.activeTargetIds.has(e)&&(t=!0)})),t}},{key:"addPendingMutation",value:function(e){this.yr(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.yr(e,t,n),this.pr(e)}},{key:"addLocalQueryTarget",value:function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(Fl(this.persistenceKey,e));if(n){var r=Ul.Ji(e,n);r&&(t=r.state)}}return this.Ir.Xi(e),this._r(),t}},{key:"removeLocalQueryTarget",value:function(e){this.Ir.Zi(e),this._r()}},{key:"isLocalQueryTarget",value:function(e){return this.Ir.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(Fl(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.Tr(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach((function(e){r.pr(e)})),this.currentUser=e,n.forEach((function(e){r.addPendingMutation(e)}))}},{key:"setOnlineState",value:function(e){this.Er(e)}},{key:"notifyBundleLoaded",value:function(e){this.Ar(e)}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this.er),this.removeItem(this.rr),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return Pr("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){Pr("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){Pr("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"nr",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(Pr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.rr)return void Ur("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.js.enqueueRetryable((0,y.Z)((0,v.Z)().mark((function e(){var r,i,a,u,o,s,c;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=43;break}if(null===n.key){e.next=41;break}if(!t.cr.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.Rr(n.key),e.abrupt("return",t.br(r,null));case 6:if(!(i=t.Pr(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.br(i.clientId,i));case 9:e.next=41;break;case 11:if(!t.ar.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.vr(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.Vr(a));case 16:e.next=41;break;case 18:if(!t.hr.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(u=t.Sr(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.Dr(u));case 23:e.next=41;break;case 25:if(n.key!==t.lr){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(o=t.wr(n.newValue))){e.next=30;break}return e.abrupt("return",t.mr(o));case 30:e.next=41;break;case 32:if(n.key!==t.ur){e.next=37;break}s=function(e){var t=Ui.ot;if(null!=e)try{var n=JSON.parse(e);Gr("number"==typeof n),t=n}catch(e){Ur("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue),s!==Ui.ot&&t.sequenceNumberHandler(s),e.next=41;break;case 37:if(n.key!==t.dr){e.next=41;break}return c=t.Cr(n.newValue),e.next=41,Promise.all(c.map((function(e){return t.syncEngine.Nr(e)})));case 41:e.next=44;break;case 43:t.ir.push(n);case 44:case"end":return e.stop()}}),e)}))))}}},{key:"Ir",get:function(){return this.sr.get(this.tr)}},{key:"_r",value:function(){this.setItem(this.rr,this.Ir.Yi())}},{key:"yr",value:function(e,t,n){var r=new Pl(this.currentUser,e,t,n),i=Ol(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Yi())}},{key:"pr",value:function(e){var t=Ol(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"Er",value:function(e){var t={clientId:this.tr,onlineState:e};this.storage.setItem(this.lr,JSON.stringify(t))}},{key:"Tr",value:function(e,t,n){var r=Fl(this.persistenceKey,e),i=new Ul(e,t,n);this.setItem(r,i.Yi())}},{key:"Ar",value:function(e){var t=JSON.stringify(Array.from(e));this.setItem(this.dr,t)}},{key:"Rr",value:function(e){var t=this.cr.exec(e);return t?t[1]:null}},{key:"Pr",value:function(e,t){var n=this.Rr(e);return Bl.Ji(n,t)}},{key:"vr",value:function(e,t){var n=this.ar.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Pl.Ji(new Vr(i),r,t)}},{key:"Sr",value:function(e,t){var n=this.hr.exec(e),r=Number(n[1]);return Ul.Ji(r,t)}},{key:"wr",value:function(e){return ql.Ji(e)}},{key:"Cr",value:function(e){return JSON.parse(e)}},{key:"Vr",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine.kr(t.batchId,t.state,t.error));case 2:Pr("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Dr",value:function(e){return this.syncEngine.Or(e.targetId,e.state,e.error)}},{key:"br",value:function(e,t){var n=this,r=t?this.sr.insert(e,t):this.sr.remove(e),i=this.gr(this.sr),a=this.gr(r),u=[],o=[];return a.forEach((function(e){i.has(e)||u.push(e)})),i.forEach((function(e){a.has(e)||o.push(e)})),this.syncEngine.Mr(u,o).then((function(){n.sr=r}))}},{key:"mr",value:function(e){this.sr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"gr",value:function(e){var t=yo();return e.forEach((function(e,n){t=t.unionWith(n.activeTargetIds)})),t}}],[{key:"V",value:function(e){return!(!e||!e.localStorage)}}]),e}(),jl=function(){function e(){(0,s.Z)(this,e),this.Fr=new Kl,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return(0,c.Z)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.Fr.Xi(e),this.$r[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.$r[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.Fr.Zi(e)}},{key:"isLocalQueryTarget",value:function(e){return this.Fr.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.$r[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.Fr.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.Fr.activeTargetIds.has(e)}},{key:"start",value:function(){return this.Fr=new Kl,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(e){}}]),e}(),zl=function(){function e(){(0,s.Z)(this,e)}return(0,c.Z)(e,[{key:"Br",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),Ql=function(){function e(){var t=this;(0,s.Z)(this,e),this.Lr=function(){return t.Ur()},this.qr=function(){return t.Kr()},this.Gr=[],this.Qr()}return(0,c.Z)(e,[{key:"Br",value:function(e){this.Gr.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}},{key:"Qr",value:function(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}},{key:"Ur",value:function(){Pr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=(0,o.Z)(this.Gr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"Kr",value:function(){Pr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=(0,o.Z)(this.Gr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"V",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),Hl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Wl=function(){function e(t){(0,s.Z)(this,e),this.jr=t.jr,this.Wr=t.Wr}return(0,c.Z)(e,[{key:"zr",value:function(e){this.Hr=e}},{key:"Jr",value:function(e){this.Yr=e}},{key:"onMessage",value:function(e){this.Xr=e}},{key:"close",value:function(){this.Wr()}},{key:"send",value:function(e){this.jr(e)}},{key:"Zr",value:function(){this.Hr()}},{key:"eo",value:function(e){this.Yr(e)}},{key:"no",value:function(e){this.Xr(e)}}]),e}(),Xl=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return(0,c.Z)(n,[{key:"co",value:function(e,t,n,r){return new Promise((function(i,a){var u=new Rr;u.listenOnce(_r.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case Sr.NO_ERROR:var t=u.getResponseJson();Pr("Connection","XHR received:",JSON.stringify(t)),i(t);break;case Sr.TIMEOUT:Pr("Connection",'RPC "'+e+'" timed out'),a(new Qr(zr.DEADLINE_EXCEEDED,"Request time out"));break;case Sr.HTTP_ERROR:var n=u.getStatus();if(Pr("Connection",'RPC "'+e+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var o=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(zr).indexOf(t)>=0?t:zr.UNKNOWN}(r.status);a(new Qr(o,r.message))}else a(new Qr(zr.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new Qr(zr.UNAVAILABLE,"Connection failed."));break;default:Kr()}}finally{Pr("Connection",'RPC "'+e+'" completed.')}}));var o=JSON.stringify(r);u.send(t,"POST",o,n,15)}))}},{key:"ho",value:function(e,t,n){var r=[this.so,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Er(),a=Tr(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(u.xmlHttpFactory=new Cr({})),this.uo(u.initMessageHeaders,t,n),(0,w.uI)()||(0,w.b$)()||(0,w.d)()||(0,w.w1)()||(0,w.Mn)()||(0,w.ru)()||(u.httpHeadersOverwriteParam="$httpHeaders");var o=r.join("");Pr("Connection","Creating WebChannel: "+o,u);var s=i.createWebChannel(o,u),c=!1,l=!1,h=new Wl({jr:function(e){l?Pr("Connection","Not sending because WebChannel is closed:",e):(c||(Pr("Connection","Opening WebChannel transport."),s.open(),c=!0),Pr("Connection","WebChannel sending:",e),s.send(e))},Wr:function(){return s.close()}}),f=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return f(s,Nr.EventType.OPEN,(function(){l||Pr("Connection","WebChannel transport opened.")})),f(s,Nr.EventType.CLOSE,(function(){l||(l=!0,Pr("Connection","WebChannel transport closed"),h.eo())})),f(s,Nr.EventType.ERROR,(function(e){l||(l=!0,Br("Connection","WebChannel transport errored:",e),h.eo(new Qr(zr.UNAVAILABLE,"The operation could not be completed")))})),f(s,Nr.EventType.MESSAGE,(function(e){var t;if(!l){var n=e.data[0];Gr(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){Pr("Connection","WebChannel received error:",i);var a=i.status,u=function(e){var t=Hu[e];if(void 0!==t)return eo(t)}(a),o=i.message;void 0===u&&(u=zr.INTERNAL,o="Unknown error status: "+a+" with message "+i.message),l=!0,h.eo(new Qr(u,o)),s.close()}else Pr("Connection","WebChannel received:",n),h.no(n)}})),f(a,Dr.STAT_EVENT,(function(e){e.stat===Ar.PROXY?Pr("Connection","Detected buffering proxy"):e.stat===Ar.NOPROXY&&Pr("Connection","Detected no buffering proxy")})),setTimeout((function(){h.Zr()}),0),h}}]),n}(function(){function e(t){(0,s.Z)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.so=n+"://"+t.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return(0,c.Z)(e,[{key:"ro",value:function(e,t,n,r,i){var a=this.oo(e,t);Pr("RestConnection","Sending: ",a,n);var u={};return this.uo(u,r,i),this.co(e,a,u,n).then((function(e){return Pr("RestConnection","Received: ",e),e}),(function(t){throw Br("RestConnection","".concat(e," failed with error: "),t,"url: ",a,"request:",n),t}))}},{key:"ao",value:function(e,t,n,r,i,a){return this.ro(e,t,n,r,i)}},{key:"uo",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Lr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((function(t,n){return e[n]=t})),n&&n.headers.forEach((function(t,n){return e[n]=t}))}},{key:"oo",value:function(e,t){var n=Hl[e];return"".concat(this.so,"/v1/").concat(t,":").concat(n)}}]),e}());function Yl(){return"undefined"!=typeof window?window:null}function Jl(){return"undefined"!=typeof document?document:null}function $l(e){return new So(e,!0)}var eh=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;(0,s.Z)(this,e),this.js=t,this.timerId=n,this.lo=r,this.fo=i,this._o=a,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}return(0,c.Z)(e,[{key:"reset",value:function(){this.wo=0}},{key:"po",value:function(){this.wo=this._o}},{key:"Io",value:function(e){var t=this;this.cancel();var n=Math.floor(this.wo+this.To()),r=Math.max(0,Date.now()-this.yo),i=Math.max(0,n-r);i>0&&Pr("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.wo," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.mo=this.js.enqueueAfterDelay(this.timerId,i,(function(){return t.yo=Date.now(),e()})),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}},{key:"Eo",value:function(){null!==this.mo&&(this.mo.skipDelay(),this.mo=null)}},{key:"cancel",value:function(){null!==this.mo&&(this.mo.cancel(),this.mo=null)}},{key:"To",value:function(){return(Math.random()-.5)*this.wo}}]),e}(),th=function(){function e(t,n,r,i,a,u,o,c){(0,s.Z)(this,e),this.js=t,this.Ao=r,this.Ro=i,this.bo=a,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=o,this.listener=c,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new eh(t,n)}return(0,c.Z)(e,[{key:"Do",value:function(){return 1===this.state||5===this.state||this.Co()}},{key:"Co",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.xo()}},{key:"stop",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.Do(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"No",value:function(){this.state=0,this.So.reset()}},{key:"ko",value:function(){var e=this;this.Co()&&null===this.vo&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,(function(){return e.Oo()})))}},{key:"Mo",value:function(e){this.Fo(),this.stream.send(e)}},{key:"Oo",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.Co()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Fo",value:function(){this.vo&&(this.vo.cancel(),this.vo=null)}},{key:"$o",value:function(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}},{key:"close",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Fo(),this.$o(),this.So.cancel(),this.Po++,4!==t?this.So.reset():n&&n.code===zr.RESOURCE_EXHAUSTED?(Ur(n.toString()),Ur("Using maximum backoff delay to prevent overloading the backend."),this.So.po()):n&&n.code===zr.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Bo(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Jr(n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"Bo",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.Lo(this.Po),n=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((function(t){var r=(0,d.Z)(t,2),i=r[0],a=r[1];e.Po===n&&e.Uo(i,a)}),(function(n){t((function(){var t=new Qr(zr.UNKNOWN,"Fetching auth token failed: "+n.message);return e.qo(t)}))}))}},{key:"Uo",value:function(e,t){var n=this,r=this.Lo(this.Po);this.stream=this.Ko(e,t),this.stream.zr((function(){r((function(){return n.state=2,n.Vo=n.js.enqueueAfterDelay(n.Ro,1e4,(function(){return n.Co()&&(n.state=3),Promise.resolve()})),n.listener.zr()}))})),this.stream.Jr((function(e){r((function(){return n.qo(e)}))})),this.stream.onMessage((function(e){r((function(){return n.onMessage(e)}))}))}},{key:"xo",value:function(){var e=this;this.state=5,this.So.Io((0,y.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"qo",value:function(e){return Pr("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"Lo",value:function(e){var t=this;return function(n){t.js.enqueueAndForget((function(){return t.Po===e?n():(Pr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),nh=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,a,u,o){var c;return(0,s.Z)(this,n),(c=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,o)).wt=u,c}return(0,c.Z)(n,[{key:"Ko",value:function(e,t){return this.bo.ho("Listen",e,t)}},{key:"onMessage",value:function(e){this.So.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Kr()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.dt?(Gr(void 0===t||"string"==typeof t),Yi.fromBase64String(t||"")):(Gr(void 0===t||t instanceof Uint8Array),Yi.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),u=t.targetChange.cause,o=u&&function(e){var t=void 0===e.code?zr.UNKNOWN:eo(e.code);return new Qr(t,e.message||"")}(u);n=new wo(r,i,a,o||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var c=Vo(e,s.document.name),l=Co(s.document.updateTime),h=new Ca({mapValue:{fields:s.document.fields}}),f=Ra.newFoundDocument(c,l,h),d=s.targetIds||[],v=s.removedTargetIds||[];n=new go(d,v,f.key,f)}else if("documentDelete"in t){t.documentDelete;var y=t.documentDelete;y.document;var p=Vo(e,y.document),m=y.readTime?Co(y.readTime):ci.min(),g=Ra.newNoDocument(p,m),k=y.removedTargetIds||[];n=new go([],k,g.key,g)}else if("documentRemove"in t){t.documentRemove;var w=t.documentRemove;w.document;var b=Vo(e,w.document),x=w.removedTargetIds||[];n=new go([],x,b,null)}else{if(!("filter"in t))return Kr();t.filter;var I=t.filter;I.targetId;var Z=I.count||0,E=new Ju(Z),T=I.targetId;n=new ko(T,E)}return n}(this.wt,e),n=function(e){if(!("targetChange"in e))return ci.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?ci.min():t.readTime?Co(t.readTime):ci.min()}(e);return this.listener.Go(t,n)}},{key:"Qo",value:function(e){var t={};t.database=Fo(this.wt),t.addTarget=function(e,t){var n,r=t.target;return(n=Fa(r)?{documents:jo(e,r)}:{query:zo(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Do(e,t.resumeToken):t.snapshotVersion.compareTo(ci.min())>0&&(n.readTime=_o(e,t.snapshotVersion.toTimestamp())),n}(this.wt,e);var n=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Kr()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.wt,e);n&&(t.labels=n),this.Mo(t)}},{key:"jo",value:function(e){var t={};t.database=Fo(this.wt),t.removeTarget=e,this.Mo(t)}}]),n}(th),rh=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,a,u,o){var c;return(0,s.Z)(this,n),(c=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,o)).wt=u,c.Wo=!1,c}return(0,c.Z)(n,[{key:"zo",get:function(){return this.Wo}},{key:"start",value:function(){this.Wo=!1,this.lastStreamToken=void 0,(0,h.Z)((0,f.Z)(n.prototype),"start",this).call(this)}},{key:"Bo",value:function(){this.Wo&&this.Ho([])}},{key:"Ko",value:function(e,t){return this.bo.ho("Write",e,t)}},{key:"onMessage",value:function(e){if(Gr(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Wo){this.So.reset();var t=function(e,t){return e&&e.length>0?(Gr(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?Co(e.updateTime):Co(t);return n.isEqual(ci.min())&&(n=Co(t)),new Mu(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=Co(e.commitTime);return this.listener.Jo(n,t)}return Gr(!e.writeResults||0===e.writeResults.length),this.Wo=!0,this.listener.Yo()}},{key:"Xo",value:function(){var e={};e.database=Fo(this.wt),this.Mo(e)}},{key:"Ho",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return Ko(t.wt,e)}))};this.Mo(n)}}]),n}(th),ih=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,a){var u;return(0,s.Z)(this,n),(u=t.call(this)).authCredentials=e,u.appCheckCredentials=r,u.bo=i,u.wt=a,u.Zo=!1,u}return(0,c.Z)(n,[{key:"tu",value:function(){if(this.Zo)throw new Qr(zr.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"ro",value:function(e,t,n){var r=this;return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var a=(0,d.Z)(i,2),u=a[0],o=a[1];return r.bo.ro(e,t,n,u,o)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===zr.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new Qr(zr.UNKNOWN,e.toString())}))}},{key:"ao",value:function(e,t,n,r){var i=this;return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(a){var u=(0,d.Z)(a,2),o=u[0],s=u[1];return i.bo.ao(e,t,n,o,s,r)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===zr.UNAUTHENTICATED&&(i.authCredentials.invalidateToken(),i.appCheckCredentials.invalidateToken()),e):new Qr(zr.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.Zo=!0}}]),n}(function(){return(0,c.Z)((function e(){(0,s.Z)(this,e)}))}()),ah=function(){function e(t,n){(0,s.Z)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}return(0,c.Z)(e,[{key:"iu",value:function(){var e=this;0===this.eu&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.nu=null,e.ou("Backend didn't respond within 10 seconds."),e.ru("Offline"),Promise.resolve()})))}},{key:"uu",value:function(e){"Online"===this.state?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.ru("Offline")))}},{key:"set",value:function(e){this.cu(),this.eu=0,"Online"===e&&(this.su=!1),this.ru(e)}},{key:"ru",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"ou",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.su?(Ur(t),this.su=!1):Pr("OnlineStateTracker",t)}},{key:"cu",value:function(){null!==this.nu&&(this.nu.cancel(),this.nu=null)}}]),e}(),uh=(0,c.Z)((function e(t,n,r,i,a){var u=this;(0,s.Z)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=a,this.du.Br((function(e){r.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=mh(u),!e.t0){e.next=5;break}return Pr("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=jr(t)).lu.add(4),e.next=4,ch(n);case 4:return n._u.set("Unknown"),n.lu.delete(4),e.next=8,oh(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(u);case 5:case"end":return e.stop()}}),e)}))))})),this._u=new ah(r,i)}));function oh(e){return sh.apply(this,arguments)}function sh(){return sh=(0,y.Z)((0,v.Z)().mark((function e(t){var n,r,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!mh(t)){e.next=18;break}n=(0,o.Z)(t.fu),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])}))),sh.apply(this,arguments)}function ch(e){return lh.apply(this,arguments)}function lh(){return lh=(0,y.Z)((0,v.Z)().mark((function e(t){var n,r,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=(0,o.Z)(t.fu),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])}))),lh.apply(this,arguments)}function hh(e,t){var n=jr(e);n.hu.has(t.targetId)||(n.hu.set(t.targetId,t),ph(n)?yh(n):zh(n).Co()&&dh(n,t))}function fh(e,t){var n=jr(e),r=zh(n);n.hu.delete(t),r.Co()&&vh(n,t),0===n.hu.size&&(r.Co()?r.ko():mh(n)&&n._u.set("Unknown"))}function dh(e,t){e.wu.Nt(t.targetId),zh(e).Qo(t)}function vh(e,t){e.wu.Nt(t),zh(e).jo(t)}function yh(e){e.wu=new xo({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},te:function(t){return e.hu.get(t)||null}}),zh(e).start(),e._u.iu()}function ph(e){return mh(e)&&!zh(e).Do()&&e.hu.size>0}function mh(e){return 0===jr(e).lu.size}function gh(e){e.wu=void 0}function kh(e){return wh.apply(this,arguments)}function wh(){return wh=(0,y.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.hu.forEach((function(e,n){dh(t,e)}));case 1:case"end":return e.stop()}}),e)}))),wh.apply(this,arguments)}function bh(e,t){return xh.apply(this,arguments)}function xh(){return xh=(0,y.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:gh(t),ph(t)?(t._u.uu(n),yh(t)):t._u.set("Unknown");case 1:case"end":return e.stop()}}),e)}))),xh.apply(this,arguments)}function Ih(e,t,n){return Zh.apply(this,arguments)}function Zh(){return Zh=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._u.set("Online"),!(n instanceof wo&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a,u;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=(0,o.Z)(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(u=a.value,e.t0=t.hu.has(u),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(u,r);case 10:t.hu.delete(u),t.wu.removeTarget(u);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),Pr("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,Eh(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof go?t.wu.Ut(n):n instanceof ko?t.wu.zt(n):t.wu.Gt(n),r.isEqual(ci.min())){e.next=29;break}return e.prev=14,e.next=17,bl(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.wu.Yt(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.hu.get(r);i&&e.hu.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.hu.get(t);if(n){e.hu.set(t,n.withResumeToken(Yi.EMPTY_BYTE_STRING,n.snapshotVersion)),vh(e,t);var r=new Vs(n.target,t,1,n.sequenceNumber);dh(e,r)}})),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),Pr("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,Eh(t,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),Zh.apply(this,arguments)}function Eh(e,t,n){return Th.apply(this,arguments)}function Th(){return Th=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ri(n)){e.next=2;break}throw n;case 2:return t.lu.add(1),e.next=5,ch(t);case 5:t._u.set("Offline"),r||(r=function(){return bl(t.localStore)}),t.asyncQueue.enqueueRetryable((0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Pr("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.lu.delete(1),e.next=6,oh(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)}))),Th.apply(this,arguments)}function Sh(e,t){return t().catch((function(n){return Eh(e,n,t)}))}function _h(e){return Dh.apply(this,arguments)}function Dh(){return Dh=(0,y.Z)((0,v.Z)().mark((function e(t){var n,r,i,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=jr(t),r=Qh(n),i=n.au.length>0?n.au[n.au.length-1].batchId:-1;case 2:if(!Ah(n)){e.next=19;break}return e.prev=3,e.next=6,Zl(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.au.length&&r.ko(),e.abrupt("break",19);case 10:i=a.batchId,Ch(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,Eh(n,e.t0);case 17:e.next=2;break;case 19:Nh(n)&&Rh(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])}))),Dh.apply(this,arguments)}function Ah(e){return mh(e)&&e.au.length<10}function Ch(e,t){e.au.push(t);var n=Qh(e);n.Co()&&n.zo&&n.Ho(t.mutations)}function Nh(e){return mh(e)&&!Qh(e).Do()&&e.au.length>0}function Rh(e){Qh(e).start()}function Mh(e){return Vh.apply(this,arguments)}function Vh(){return Vh=(0,y.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Qh(t).Xo();case 1:case"end":return e.stop()}}),e)}))),Vh.apply(this,arguments)}function Lh(e){return Oh.apply(this,arguments)}function Oh(){return Oh=(0,y.Z)((0,v.Z)().mark((function e(t){var n,r,i,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Qh(t),r=(0,o.Z)(t.au);try{for(r.s();!(i=r.n()).done;)a=i.value,n.Ho(a.mutations)}catch(u){r.e(u)}finally{r.f()}case 3:case"end":return e.stop()}}),e)}))),Oh.apply(this,arguments)}function Fh(e,t,n){return Ph.apply(this,arguments)}function Ph(){return Ph=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.au.shift(),a=Rs.from(i,n,r),e.next=3,Sh(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,_h(t);case 5:case"end":return e.stop()}}),e)}))),Ph.apply(this,arguments)}function Uh(e,t){return Bh.apply(this,arguments)}function Bh(){return Bh=(0,y.Z)((0,v.Z)().mark((function e(t,n){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&Qh(t).zo,!e.t0){e.next=4;break}return e.next=4,function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!$u(i=n.code)||i===zr.ABORTED){e.next=7;break}return r=t.au.shift(),Qh(t).No(),e.next=5,Sh(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,_h(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:Nh(t)&&Rh(t);case 5:case"end":return e.stop()}}),e)}))),Bh.apply(this,arguments)}function qh(e,t){return Kh.apply(this,arguments)}function Kh(){return Kh=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=jr(t)).asyncQueue.verifyOperationInProgress(),Pr("RemoteStore","RemoteStore received new credentials"),i=mh(r),r.lu.add(3),e.next=6,ch(r);case 6:return i&&r._u.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.lu.delete(3),e.next=12,oh(r);case 12:case"end":return e.stop()}}),e)}))),Kh.apply(this,arguments)}function Gh(e,t){return jh.apply(this,arguments)}function jh(){return jh=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=jr(t),!n){e.next=7;break}return r.lu.delete(2),e.next=5,oh(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.lu.add(2),e.next=12,ch(r);case 12:r._u.set("Unknown");case 13:case"end":return e.stop()}}),e)}))),jh.apply(this,arguments)}function zh(e){return e.mu||(e.mu=function(e,t,n){var r=jr(e);return r.tu(),new nh(t,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(e.datastore,e.asyncQueue,{zr:kh.bind(null,e),Jr:bh.bind(null,e),Go:Ih.bind(null,e)}),e.fu.push(function(){var t=(0,y.Z)((0,v.Z)().mark((function t(n){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.mu.No(),ph(e)?yh(e):e._u.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.mu.stop();case 6:gh(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.mu}function Qh(e){return e.gu||(e.gu=function(e,t,n){var r=jr(e);return r.tu(),new rh(t,r.bo,r.authCredentials,r.appCheckCredentials,r.wt,n)}(e.datastore,e.asyncQueue,{zr:Mh.bind(null,e),Jr:Uh.bind(null,e),Yo:Lh.bind(null,e),Jo:Fh.bind(null,e)}),e.fu.push(function(){var t=(0,y.Z)((0,v.Z)().mark((function t(n){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.gu.No(),t.next=4,_h(e);case 4:t.next=9;break;case 6:return t.next=8,e.gu.stop();case 8:e.au.length>0&&(Pr("RemoteStore","Stopping write stream with ".concat(e.au.length," pending writes")),e.au=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.gu}var Hh=function(){function e(t,n,r,i,a){(0,s.Z)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new Hr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return(0,c.Z)(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Qr(zr.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var u=new e(t,n,Date.now()+r,i,a);return u.start(r),u}}]),e}();function Wh(e,t){if(Ur("AsyncQueue","".concat(t,": ").concat(e)),Ri(e))return new Qr(zr.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var Xh=function(){function e(t){(0,s.Z)(this,e),this.comparator=t?function(e,n){return t(e,n)||vi.comparator(e.key,n.key)}:function(e,t){return vi.comparator(e.key,t.key)},this.keyedMap=ao(),this.sortedSet=new Gi(this.comparator)}return(0,c.Z)(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),Yh=function(){function e(){(0,s.Z)(this,e),this.yu=new Gi(vi.comparator)}return(0,c.Z)(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.yu.get(t);n?0!==e.type&&3===n.type?this.yu=this.yu.insert(t,e):3===e.type&&1!==n.type?this.yu=this.yu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.yu=this.yu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.yu=this.yu.remove(t):1===e.type&&2===n.type?this.yu=this.yu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):Kr():this.yu=this.yu.insert(t,e)}},{key:"pu",value:function(){var e=[];return this.yu.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),Jh=function(){function e(t,n,r,i,a,u,o,c){(0,s.Z)(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=o,this.excludesMetadataChanges=c}return(0,c.Z)(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&hu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i){var a=[];return n.forEach((function(e){a.push({type:0,doc:e})})),new e(t,n,Xh.emptySet(n),a,r,i,!0,!1)}}]),e}(),$h=(0,c.Z)((function e(){(0,s.Z)(this,e),this.Iu=void 0,this.listeners=[]})),ef=(0,c.Z)((function e(){(0,s.Z)(this,e),this.queries=new to((function(e){return fu(e)}),hu),this.onlineState="Unknown",this.Tu=new Set}));function tf(e,t){return nf.apply(this,arguments)}function nf(){return nf=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a,u,o;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=jr(t),i=n.query,a=!1,(u=r.queries.get(i))||(a=!0,u=new $h),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:u.Iu=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),o=Wh(e.t0,"Initialization of query '".concat(du(n.query),"' failed")),e.abrupt("return",void n.onError(o));case 13:r.queries.set(i,u),u.listeners.push(n),n.Eu(r.onlineState),u.Iu&&n.Au(u.Iu)&&sf(r);case 14:case"end":return e.stop()}}),e,null,[[3,9]])}))),nf.apply(this,arguments)}function rf(e,t){return af.apply(this,arguments)}function af(){return af=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a,u,o;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=jr(t),i=n.query,a=!1,(u=r.queries.get(i))&&(o=u.listeners.indexOf(n))>=0&&(u.listeners.splice(o,1),a=0===u.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}}),e)}))),af.apply(this,arguments)}function uf(e,t){var n,r=jr(e),i=!1,a=(0,o.Z)(t);try{for(a.s();!(n=a.n()).done;){var u=n.value,s=u.query,c=r.queries.get(s);if(c){var l,h=(0,o.Z)(c.listeners);try{for(h.s();!(l=h.n()).done;){l.value.Au(u)&&(i=!0)}}catch(f){h.e(f)}finally{h.f()}c.Iu=u}}}catch(f){a.e(f)}finally{a.f()}i&&sf(r)}function of(e,t,n){var r=jr(e),i=r.queries.get(t);if(i){var a,u=(0,o.Z)(i.listeners);try{for(u.s();!(a=u.n()).done;){a.value.onError(n)}}catch(s){u.e(s)}finally{u.f()}}r.queries.delete(t)}function sf(e){e.Tu.forEach((function(e){e.next()}))}var cf=function(){function e(t,n,r){(0,s.Z)(this,e),this.query=t,this.Ru=n,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=r||{}}return(0,c.Z)(e,[{key:"Au",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=(0,o.Z)(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(u){r.e(u)}finally{r.f()}e=new Jh(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var a=!1;return this.bu?this.vu(e)&&(this.Ru.next(e),a=!0):this.Vu(e,this.onlineState)&&(this.Su(e),a=!0),this.Pu=e,a}},{key:"onError",value:function(e){this.Ru.error(e)}},{key:"Eu",value:function(e){this.onlineState=e;var t=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,e)&&(this.Su(this.Pu),t=!0),t}},{key:"Vu",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return(!this.options.Du||!n)&&(!e.docs.isEmpty()||"Offline"===t)}},{key:"vu",value:function(e){if(e.docChanges.length>0)return!0;var t=this.Pu&&this.Pu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"Su",value:function(e){e=Jh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Ru.next(e)}}]),e}(),lf=function(){function e(t,n){(0,s.Z)(this,e),this.payload=t,this.byteLength=n}return(0,c.Z)(e,[{key:"Cu",value:function(){return"metadata"in this.payload}}]),e}(),hf=function(){function e(t){(0,s.Z)(this,e),this.wt=t}return(0,c.Z)(e,[{key:"Wi",value:function(e){return Vo(this.wt,e)}},{key:"zi",value:function(e){return e.metadata.exists?Bo(this.wt,e.document,!1):Ra.newNoDocument(this.Wi(e.metadata.name),this.Hi(e.metadata.readTime))}},{key:"Hi",value:function(e){return Co(e)}}]),e}(),ff=function(){function e(t,n,r){(0,s.Z)(this,e),this.xu=t,this.localStore=n,this.wt=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=df(t)}return(0,c.Z)(e,[{key:"Nu",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;var n=hi.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"ku",value:function(e){var t,n=new Map,r=new hf(this.wt),i=(0,o.Z)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var u,s=r.Wi(a.metadata.name),c=(0,o.Z)(a.metadata.queries);try{for(c.s();!(u=c.n()).done;){var l=u.value,h=(n.get(l)||fo()).add(s);n.set(l,h)}}catch(f){c.e(f)}finally{c.f()}}}}catch(f){i.e(f)}finally{i.f()}return n}},{key:"complete",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t,n,r,i,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Nl(this.localStore,new hf(this.wt),this.documents,this.xu.id);case 2:t=e.sent,n=this.ku(this.documents),r=(0,o.Z)(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,Ml(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",{progress:this.progress,Ou:this.collectionGroups,Mu:t}));case 22:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(){return e.apply(this,arguments)}}()}]),e}();function df(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var vf=(0,c.Z)((function e(t){(0,s.Z)(this,e),this.key=t})),yf=(0,c.Z)((function e(t){(0,s.Z)(this,e),this.key=t})),pf=function(){function e(t,n){(0,s.Z)(this,e),this.query=t,this.Fu=n,this.$u=null,this.current=!1,this.Bu=fo(),this.mutatedKeys=fo(),this.Lu=pu(t),this.Uu=new Xh(this.Lu)}return(0,c.Z)(e,[{key:"qu",get:function(){return this.Fu}},{key:"Ku",value:function(e,t){var n=this,r=t?t.Gu:new Yh,i=t?t.Uu:this.Uu,a=t?t.mutatedKeys:this.mutatedKeys,u=i,o=!1,s="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((function(e,t){var l=i.get(e),h=vu(n.query,t)?t:null,f=!!l&&n.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),v=!1;l&&h?l.data.isEqual(h.data)?f!==d&&(r.track({type:3,doc:h}),v=!0):n.Qu(l,h)||(r.track({type:2,doc:h}),v=!0,(s&&n.Lu(h,s)>0||c&&n.Lu(h,c)<0)&&(o=!0)):!l&&h?(r.track({type:0,doc:h}),v=!0):l&&!h&&(r.track({type:1,doc:l}),v=!0,(s||c)&&(o=!0)),v&&(h?(u=u.add(h),a=d?a.add(e):a.delete(e)):(u=u.delete(e),a=a.delete(e)))})),null!==this.query.limit)for(;u.size>this.query.limit;){var l="F"===this.query.limitType?u.last():u.first();u=u.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{Uu:u,Gu:r,Oi:o,mutatedKeys:a}}},{key:"Qu",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.Uu;this.Uu=e.Uu,this.mutatedKeys=e.mutatedKeys;var a=e.Gu.pu();a.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kr()}};return n(e)-n(t)}(e.type,t.type)||r.Lu(e.doc,t.doc)})),this.ju(n);var u=t?this.Wu():[],o=0===this.Bu.size&&this.current?1:0,s=o!==this.$u;return this.$u=o,0!==a.length||s?{snapshot:new Jh(this.query,e.Uu,i,a,e.mutatedKeys,0===o,s,!1),zu:u}:{zu:u}}},{key:"Eu",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new Yh,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}},{key:"Hu",value:function(e){return!this.Fu.has(e)&&!!this.Uu.has(e)&&!this.Uu.get(e).hasLocalMutations}},{key:"ju",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t.Fu=t.Fu.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t.Fu=t.Fu.delete(e)})),this.current=e.current)}},{key:"Wu",value:function(){var e=this;if(!this.current)return[];var t=this.Bu;this.Bu=fo(),this.Uu.forEach((function(t){e.Hu(t.key)&&(e.Bu=e.Bu.add(t.key))}));var n=[];return t.forEach((function(t){e.Bu.has(t)||n.push(new yf(t))})),this.Bu.forEach((function(e){t.has(e)||n.push(new vf(e))})),n}},{key:"Ju",value:function(e){this.Fu=e.ji,this.Bu=fo();var t=this.Ku(e.documents);return this.applyChanges(t,!0)}},{key:"Yu",value:function(){return Jh.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,0===this.$u)}}]),e}(),mf=(0,c.Z)((function e(t,n,r){(0,s.Z)(this,e),this.query=t,this.targetId=n,this.view=r})),gf=(0,c.Z)((function e(t){(0,s.Z)(this,e),this.key=t,this.Xu=!1})),kf=function(){function e(t,n,r,i,a,u){(0,s.Z)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.Zu={},this.tc=new to((function(e){return fu(e)}),hu),this.ec=new Map,this.nc=new Set,this.sc=new Gi(vi.comparator),this.ic=new Map,this.rc=new Jc,this.oc={},this.uc=new Map,this.cc=_c.Rn(),this.onlineState="Unknown",this.ac=void 0}return(0,c.Z)(e,[{key:"isPrimaryClient",get:function(){return!0===this.ac}}]),e}();function wf(e,t){return bf.apply(this,arguments)}function bf(){return bf=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a,u,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=dd(t),!(u=r.tc.get(n))){e.next=6;break}i=u.targetId,r.sharedClientState.addLocalQueryTarget(i),a=u.view.Yu(),e.next=15;break;case 6:return e.next=8,El(r.localStore,cu(n));case 8:return o=e.sent,r.isPrimaryClient&&hh(r.remoteStore,o),s=r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.targetId,e.next=14,xf(r,n,i,"current"===s);case 14:a=e.sent;case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)}))),bf.apply(this,arguments)}function xf(e,t,n,r){return If.apply(this,arguments)}function If(){return If=(0,y.Z)((0,v.Z)().mark((function e(t,n,r,i){var a,u,o,s,c,l;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.hc=function(e,n,r){return function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n,r,i){var a,u,o;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.Ku(r),e.t0=a.Oi,!e.t0){e.next=6;break}return e.next=5,_l(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.Ku(t,a)}));case 5:a=e.sent;case 6:return u=i&&i.targetChanges.get(n.targetId),o=n.view.applyChanges(a,t.isPrimaryClient,u),e.abrupt("return",(Kf(t,n.targetId,o.zu),o.snapshot));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()(t,e,n,r)},e.next=3,_l(t.localStore,n,!0);case 3:return a=e.sent,u=new pf(n,a.ji),o=u.Ku(a.documents),s=mo.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState),c=u.applyChanges(o,t.isPrimaryClient,s),Kf(t,r,c.zu),l=new mf(n,r,u),e.abrupt("return",(t.tc.set(n,l),t.ec.has(r)?t.ec.get(r).push(n):t.ec.set(r,[n]),c.snapshot));case 11:case"end":return e.stop()}}),e)}))),If.apply(this,arguments)}function Zf(e,t){return Ef.apply(this,arguments)}function Ef(){return Ef=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=jr(t),i=r.tc.get(n),!((a=r.ec.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.ec.set(i.targetId,a.filter((function(e){return!hu(e,n)}))),void r.tc.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,Tl(r.localStore,i.targetId,!1).then((function(){r.sharedClientState.clearQueryState(i.targetId),fh(r.remoteStore,i.targetId),Bf(r,i.targetId)})).catch(Ti);case 9:e.next=14;break;case 11:return Bf(r,i.targetId),e.next=14,Tl(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}}),e)}))),Ef.apply(this,arguments)}function Tf(e,t,n){return Sf.apply(this,arguments)}function Sf(){return Sf=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a,u;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=vd(t),e.prev=1,e.next=4,function(e,t){var n,r,i=jr(e),a=si.now(),u=t.reduce((function(e,t){return e.add(t.key)}),fo());return i.persistence.runTransaction("Locally write mutations","readwrite",(function(e){var s=ro(),c=fo();return i.Ui.getEntries(e,u).next((function(e){(s=e).forEach((function(e,t){t.isValidDocument()||(c=c.add(e))}))})).next((function(){return i.localDocuments.getOverlayedDocuments(e,s)})).next((function(r){n=r;var u,s=[],c=(0,o.Z)(t);try{for(c.s();!(u=c.n()).done;){var l=u.value,h=Bu(l,n.get(l.key).overlayedDocument);null!=h&&s.push(new Gu(l.key,h,Na(h.value.mapValue),Vu.exists(!0)))}}catch(f){c.e(f)}finally{c.f()}return i.mutationQueue.addMutationBatch(e,a,s,t)})).next((function(t){r=t;var a=t.applyToLocalDocumentSet(n,c);return i.documentOverlayCache.saveOverlays(e,t.batchId,a)}))})).then((function(){return{batchId:r.batchId,changes:uo(n)}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.oc[e.currentUser.toKey()];r||(r=new Gi(ai)),r=r.insert(t,n),e.oc[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,zf(i,a.changes);case 9:return e.next=11,_h(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),u=Wh(e.t0,"Failed to persist write"),r.reject(u);case 17:case"end":return e.stop()}}),e,null,[[1,13]])}))),Sf.apply(this,arguments)}function _f(e,t){return Df.apply(this,arguments)}function Df(){return Df=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=jr(t),e.prev=1,e.next=4,xl(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach((function(e,t){var n=r.ic.get(t);n&&(Gr(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.Xu=!0:e.modifiedDocuments.size>0?Gr(n.Xu):e.removedDocuments.size>0&&(Gr(n.Xu),n.Xu=!1))})),e.next=8,zf(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,Ti(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),Df.apply(this,arguments)}function Af(e,t,n){var r=jr(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.tc.forEach((function(e,n){var r=n.view.Eu(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=jr(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=(0,o.Z)(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.Eu(t)&&(r=!0)}}catch(u){a.e(u)}finally{a.f()}})),r&&sf(n)}(r.eventManager,t),i.length&&r.Zu.Go(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Cf(e,t,n){return Nf.apply(this,arguments)}function Nf(){return Nf=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a,u,o,s,c;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=jr(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.ic.get(n),!(u=a&&a.key)){e.next=14;break}return o=(o=new Gi(vi.comparator)).insert(u,Ra.newNoDocument(u,ci.min())),s=fo().add(u),c=new po(ci.min(),new Map,new Qi(ai),o,s),e.next=9,_f(i,c);case 9:i.sc=i.sc.remove(u),i.ic.delete(n),jf(i),e.next=16;break;case 14:return e.next=16,Tl(i.localStore,n,!1).then((function(){return Bf(i,n,r)})).catch(Ti);case 16:case"end":return e.stop()}}),e)}))),Nf.apply(this,arguments)}function Rf(e,t){return Mf.apply(this,arguments)}function Mf(){return Mf=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=jr(t),i=n.batch.batchId,e.prev=1,e.next=4,wl(r.localStore,n);case 4:return a=e.sent,Uf(r,i,null),Pf(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,zf(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Ti(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Mf.apply(this,arguments)}function Vf(e,t,n){return Lf.apply(this,arguments)}function Lf(){return Lf=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=jr(t),e.prev=1,e.next=4,function(e,t){var n=jr(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.mutationQueue.lookupMutationBatch(e,t).next((function(t){return Gr(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,Uf(i,n,r),Pf(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,zf(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Ti(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Lf.apply(this,arguments)}function Of(e,t){return Ff.apply(this,arguments)}function Ff(){return Ff=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a,u;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return mh((r=jr(t)).remoteStore)||Pr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=jr(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)}))}(r.localStore);case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(a=r.uc.get(i)||[]).push(n),r.uc.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),u=Wh(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(u);case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),Ff.apply(this,arguments)}function Pf(e,t){(e.uc.get(t)||[]).forEach((function(e){e.resolve()})),e.uc.delete(t)}function Uf(e,t,n){var r=jr(e),i=r.oc[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.oc[r.currentUser.toKey()]=i}}function Bf(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=(0,o.Z)(e.ec.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.tc.delete(a),n&&e.Zu.lc(a,n)}}catch(u){i.e(u)}finally{i.f()}e.ec.delete(t),e.isPrimaryClient&&e.rc.us(t).forEach((function(t){e.rc.containsKey(t)||qf(e,t)}))}function qf(e,t){e.nc.delete(t.path.canonicalString());var n=e.sc.get(t);null!==n&&(fh(e.remoteStore,n),e.sc=e.sc.remove(t),e.ic.delete(n),jf(e))}function Kf(e,t,n){var r,i=(0,o.Z)(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof vf?(e.rc.addReference(a.key,t),Gf(e,a)):a instanceof yf?(Pr("SyncEngine","Document no longer in limbo: "+a.key),e.rc.removeReference(a.key,t),e.rc.containsKey(a.key)||qf(e,a.key)):Kr()}}catch(u){i.e(u)}finally{i.f()}}function Gf(e,t){var n=t.key,r=n.path.canonicalString();e.sc.get(n)||e.nc.has(r)||(Pr("SyncEngine","New document in limbo: "+n),e.nc.add(r),jf(e))}function jf(e){for(;e.nc.size>0&&e.sc.size<e.maxConcurrentLimboResolutions;){var t=e.nc.values().next().value;e.nc.delete(t);var n=new vi(hi.fromString(t)),r=e.cc.next();e.ic.set(r,new gf(n)),e.sc=e.sc.insert(n,r),hh(e.remoteStore,new Vs(cu(iu(n.path)),r,2,Ui.ot))}}function zf(e,t,n){return Qf.apply(this,arguments)}function Qf(){return Qf=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a,u,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=jr(t),a=[],u=[],s=[],e.t0=i.tc.isEmpty(),e.t0){e.next=9;break}return i.tc.forEach((function(e,t){s.push(i.hc(t,n,r).then((function(e){if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),a.push(e);var n=vl.Vi(t.targetId,e);u.push(n)}})))})),e.next=6,Promise.all(s);case 6:return i.Zu.Go(a),e.next=9,function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a,u,s,c,l,h;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=jr(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return _i.forEach(n,(function(t){return _i.forEach(t.Pi,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return _i.forEach(t.vi,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Ri(e.t0)){e.next=10;break}throw e.t0;case 10:Pr("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=(0,o.Z)(n);try{for(i.s();!(a=i.n()).done;)u=a.value,s=u.targetId,u.fromCache||(c=r.$i.get(s),l=c.snapshotVersion,h=c.withLastLimboFreeSnapshotVersion(l),r.$i=r.$i.insert(s,h))}catch(f){i.e(f)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,u);case 9:case"end":return e.stop()}}),e)}))),Qf.apply(this,arguments)}function Hf(e,t){return Wf.apply(this,arguments)}function Wf(){return Wf=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=jr(t)).currentUser.isEqual(n)){e.next=11;break}return Pr("SyncEngine","User change. New user:",n.toKey()),e.next=5,gl(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.uc.forEach((function(e){e.forEach((function(e){e.reject(new Qr(zr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.uc.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,zf(r,i.Ki);case 11:case"end":return e.stop()}}),e)}))),Wf.apply(this,arguments)}function Xf(e,t){var n=jr(e),r=n.ic.get(t);if(r&&r.Xu)return fo().add(r.key);var i=fo(),a=n.ec.get(t);if(!a)return i;var u,s=(0,o.Z)(a);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=n.tc.get(c);i=i.unionWith(l.view.qu)}}catch(h){s.e(h)}finally{s.f()}return i}function Yf(e,t){return Jf.apply(this,arguments)}function Jf(){return Jf=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=jr(t),e.next=3,_l(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.Ju(i),e.abrupt("return",(r.isPrimaryClient&&Kf(r,n.targetId,a.zu),a));case 6:case"end":return e.stop()}}),e)}))),Jf.apply(this,arguments)}function $f(e,t){return ed.apply(this,arguments)}function ed(){return ed=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=jr(t),e.abrupt("return",Al(r.localStore,n).then((function(e){return zf(r,e)})));case 2:case"end":return e.stop()}}),e)}))),ed.apply(this,arguments)}function td(e,t,n,r){return nd.apply(this,arguments)}function nd(){return nd=(0,y.Z)((0,v.Z)().mark((function e(t,n,r,i){var a,u;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=jr(t),e.next=3,function(e,t){var n=jr(e),r=jr(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(e){return r.yn(e,t).next((function(t){return t?n.localDocuments.getDocuments(e,t):_i.resolve(null)}))}))}(a.localStore,n);case 3:if(null===(u=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,_h(a.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?(Uf(a,n,i||null),Pf(a,n),function(e,t){jr(jr(e).mutationQueue).In(t)}(a.localStore,n)):Kr();case 11:return e.next=13,zf(a,u);case 13:e.next=16;break;case 15:Pr("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}}),e)}))),nd.apply(this,arguments)}function rd(e,t){return id.apply(this,arguments)}function id(){return id=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a,u,s,c,l,h;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(dd(r=jr(t)),vd(r),!0!==n||!0===r.ac){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,ad(r,i.toArray());case 5:return a=e.sent,r.ac=!0,e.next=9,Gh(r.remoteStore,!0);case 9:u=(0,o.Z)(a);try{for(u.s();!(s=u.n()).done;)c=s.value,hh(r.remoteStore,c)}catch(f){u.e(f)}finally{u.f()}e.next=25;break;case 13:if(!1!==n||!1===r.ac){e.next=25;break}return l=[],h=Promise.resolve(),r.ec.forEach((function(e,t){r.sharedClientState.isLocalQueryTarget(t)?l.push(t):h=h.then((function(){return Bf(r,t),Tl(r.localStore,t,!0)})),fh(r.remoteStore,t)})),e.next=19,h;case 19:return e.next=21,ad(r,l);case 21:return function(e){var t=jr(e);t.ic.forEach((function(e,n){fh(t.remoteStore,n)})),t.rc.cs(),t.ic=new Map,t.sc=new Gi(vi.comparator)}(r),r.ac=!1,e.next=25,Gh(r.remoteStore,!1);case 25:case"end":return e.stop()}}),e)}))),id.apply(this,arguments)}function ad(e,t,n){return ud.apply(this,arguments)}function ud(){return ud=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a,u,s,c,l,h,f,d,y,p,m,g,k;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=jr(t),a=[],u=[],s=(0,o.Z)(n),e.prev=2,s.s();case 4:if((c=s.n()).done){e.next=45;break}if(l=c.value,h=void 0,!(f=i.ec.get(l))||0===f.length){e.next=34;break}return e.next=11,El(i.localStore,cu(f[0]));case 11:h=e.sent,d=(0,o.Z)(f),e.prev=13,d.s();case 15:if((y=d.n()).done){e.next=24;break}return p=y.value,m=i.tc.get(p),e.next=20,Yf(i,m);case 20:(g=e.sent).snapshot&&u.push(g.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),d.e(e.t0);case 29:return e.prev=29,d.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,Dl(i.localStore,l);case 36:return k=e.sent,e.next=39,El(i.localStore,k);case 39:return h=e.sent,e.next=42,xf(i,od(k),l,!1);case 42:a.push(h);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),s.e(e.t1);case 50:return e.prev=50,s.f(),e.finish(50);case 53:return e.abrupt("return",(i.Zu.Go(u),a));case 54:case"end":return e.stop()}}),e,null,[[2,47,50,53],[13,26,29,32]])}))),ud.apply(this,arguments)}function od(e){return ru(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function sd(e){var t=jr(e);return jr(jr(t.localStore).persistence).Ri()}function cd(e,t,n,r){return ld.apply(this,arguments)}function ld(){return ld=(0,y.Z)((0,v.Z)().mark((function e(t,n,r,i){var a,u,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=jr(t)).ac){e.next=3;break}return e.abrupt("return",void Pr("SyncEngine","Ignoring unexpected query state notification."));case 3:if(!((u=a.ec.get(n))&&u.length>0)){e.next=20;break}e.t0=r,e.next="current"===e.t0||"not-current"===e.t0?8:"rejected"===e.t0?15:19;break;case 8:return e.next=10,Al(a.localStore,yu(u[0]));case 10:return o=e.sent,s=po.createSynthesizedRemoteEventForCurrentChange(n,"current"===r),e.next=14,zf(a,o,s);case 14:return e.abrupt("break",20);case 15:return e.next=17,Tl(a.localStore,n,!0);case 17:return Bf(a,n,i),e.abrupt("break",20);case 19:Kr();case 20:case"end":return e.stop()}}),e)}))),ld.apply(this,arguments)}function hd(e,t,n){return fd.apply(this,arguments)}function fd(){return fd=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a,u,s,c,l,h,f,d;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=dd(t)).ac){e.next=45;break}a=(0,o.Z)(n),e.prev=3,a.s();case 5:if((u=a.n()).done){e.next=21;break}if(s=u.value,!i.ec.has(s)){e.next=10;break}return Pr("SyncEngine","Adding an already active target "+s),e.abrupt("continue",19);case 10:return e.next=12,Dl(i.localStore,s);case 12:return c=e.sent,e.next=15,El(i.localStore,c);case 15:return l=e.sent,e.next=18,xf(i,od(c),l.targetId,!1);case 18:hh(i.remoteStore,l);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:h=(0,o.Z)(r),e.prev=30,d=(0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,e.t0=i.ec.has(t),!e.t0){e.next=5;break}return e.next=5,Tl(i.localStore,t,!1).then((function(){fh(i.remoteStore,t),Bf(i,t)})).catch(Ti);case 5:case"end":return e.stop()}}),e)})),h.s();case 33:if((f=h.n()).done){e.next=37;break}return e.delegateYield(d(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),h.e(e.t2);case 42:return e.prev=42,h.f(),e.finish(42);case 45:case"end":return e.stop()}}),e,null,[[3,23,26,29],[30,39,42,45]])}))),fd.apply(this,arguments)}function dd(e){var t=jr(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=_f.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Xf.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Cf.bind(null,t),t.Zu.Go=uf.bind(null,t.eventManager),t.Zu.lc=of.bind(null,t.eventManager),t}function vd(e){var t=jr(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Rf.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Vf.bind(null,t),t}function yd(e,t,n){var r=jr(e);(function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a,u,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=jr(e),r=Co(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(function(e){return n.Ds.getBundleMetadata(e,t.id)})).then((function(e){return!!e&&e.createTime.compareTo(r)>=0}))}(t.localStore,i);case 6:if(!e.sent){e.next=11;break}return e.next=9,n.close();case 9:return r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)),e.abrupt("return",Promise.resolve(new Set));case 11:return r._updateProgress(df(i)),a=new ff(i,t.localStore,n.wt),e.next=15,n.fc();case 15:u=e.sent;case 16:if(!u){e.next=26;break}return e.next=19,a.Nu(u);case 19:return(o=e.sent)&&r._updateProgress(o),e.next=23,n.fc();case 23:u=e.sent;case 24:e.next=16;break;case 26:return e.next=28,a.complete();case 28:return s=e.sent,e.next=31,zf(t,s.Mu,void 0);case 31:return e.next=33,function(e,t){var n=jr(e);return n.persistence.runTransaction("Save bundle","readwrite",(function(e){return n.Ds.saveBundleMetadata(e,t)}))}(t.localStore,i);case 33:return r._completeWith(s.progress),e.abrupt("return",Promise.resolve(s.Ou));case 37:return e.prev=37,e.t0=e.catch(0),e.abrupt("return",(Br("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0),Promise.resolve(new Set)));case 40:case"end":return e.stop()}}),e,null,[[0,37]])})));return function(t,n,r){return e.apply(this,arguments)}})()(r,t,n).then((function(e){r.sharedClientState.notifyBundleLoaded(e)}))}var pd=function(){function e(){(0,s.Z)(this,e),this.synchronizeTabs=!1}return(0,c.Z)(e,[{key:"initialize",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.wt=$l(t.databaseInfo.databaseId),this.sharedClientState=this.dc(t),this.persistence=this._c(t),e.next=5,this.persistence.start();case 5:this.localStore=this.wc(t),this.gcScheduler=this.mc(t,this.localStore),this.indexBackfillerScheduler=this.gc(t,this.localStore);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"mc",value:function(e,t){return null}},{key:"gc",value:function(e,t){return null}},{key:"wc",value:function(e){return ml(this.persistence,new yl,e.initialUser,this.wt)}},{key:"_c",value:function(e){return new il(ul.Ms,this.wt)}},{key:"dc",value:function(e){return new jl}},{key:"terminate",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),md=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a;return(0,s.Z)(this,n),(a=t.call(this)).yc=e,a.cacheSizeBytes=r,a.forceOwnership=i,a.synchronizeTabs=!1,a}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){var r=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.Z)((0,f.Z)(n.prototype),"initialize",this).call(this,t);case 2:return e.next=4,this.yc.initialize(this,t);case 4:return e.next=6,vd(this.yc.syncEngine);case 6:return e.next=8,_h(this.yc.remoteStore);case 8:return e.next=10,this.persistence.ci((function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"wc",value:function(e){return ml(this.persistence,new yl,e.initialUser,this.wt)}},{key:"mc",value:function(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new Vc(n,e.asyncQueue,t)}},{key:"gc",value:function(e,t){var n=new Pi(t,this.persistence);return new Fi(e.asyncQueue,n)}},{key:"_c",value:function(e){var t=dl(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?wc.withCacheSize(this.cacheSizeBytes):wc.DEFAULT;return new ll(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Yl(),Jl(),this.wt,this.sharedClientState,!!this.forceOwnership)}},{key:"dc",value:function(e){return new jl}}]),n}(pd),gd=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this,e,r,!1)).yc=e,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return(0,c.Z)(n,[{key:"initialize",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){var r,i=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h.Z)((0,f.Z)(n.prototype),"initialize",this).call(this,t);case 2:if(r=this.yc.syncEngine,e.t0=this.sharedClientState instanceof Gl,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={kr:td.bind(null,r),Or:cd.bind(null,r),Mr:hd.bind(null,r),Ri:sd.bind(null,r),Nr:$f.bind(null,r)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.ci(function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,rd(i.yc.syncEngine,t);case 2:i.gcScheduler&&(t&&!i.gcScheduler.started?i.gcScheduler.start():t||i.gcScheduler.stop()),i.indexBackfillerScheduler&&(t&&!i.indexBackfillerScheduler.started?i.indexBackfillerScheduler.start():t||i.indexBackfillerScheduler.stop());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"dc",value:function(e){var t=Yl();if(!Gl.V(t))throw new Qr(zr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=dl(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Gl(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),n}(md),kd=function(){function e(){(0,s.Z)(this,e)}return(0,c.Z)(e,[{key:"initialize",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return Af(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Hf.bind(null,this.syncEngine),e.next=12,Gh(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createEventManager",value:function(e){return new ef}},{key:"createDatastore",value:function(e){var t,n=$l(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new Xl(t));return function(e,t,n,r){return new ih(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,u=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return Af(u.syncEngine,e,0)},a=Ql.V()?new Ql:new zl,new uh(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,u){var o=new kf(e,t,n,r,i,a);return u&&(o.ac=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=jr(t),Pr("RemoteStore","RemoteStore shutting down."),n.lu.add(5),e.next=5,ch(n);case 5:n.du.shutdown(),n._u.set("Unknown");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.remoteStore)}}]),e}();function wd(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return(0,y.Z)((0,v.Z)().mark((function r(){var i;return(0,v.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,i));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}}),r)})))()},cancel:function(){return(0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var bd=function(){function e(t){(0,s.Z)(this,e),this.observer=t,this.muted=!1}return(0,c.Z)(e,[{key:"next",value:function(e){this.observer.next&&this.Ic(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.Ic(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}},{key:"Tc",value:function(){this.muted=!0}},{key:"Ic",value:function(e,t){var n=this;this.muted||setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),xd=function(){function e(t,n){var r=this;(0,s.Z)(this,e),this.Ec=t,this.wt=n,this.metadata=new Hr,this.buffer=new Uint8Array,this.Ac=new TextDecoder("utf-8"),this.Rc().then((function(e){e&&e.Cu()?r.metadata.resolve(e.payload.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.payload))))}),(function(e){return r.metadata.reject(e)}))}return(0,c.Z)(e,[{key:"close",value:function(){return this.Ec.cancel()}},{key:"getMetadata",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fc",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.Rc());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Rc",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t,n,r,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bc();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.Ac.decode(t),r=Number(n),isNaN(r)&&this.Pc("length string (".concat(n,") is not valid number")),e.next=9,this.vc(r);case 9:return i=e.sent,e.abrupt("return",new lf(JSON.parse(i),t.length+r));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Vc",value:function(){return this.buffer.findIndex((function(e){return e==="{".charCodeAt(0)}))}},{key:"bc",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.Vc()<0)){e.next=7;break}return e.next=3,this.Sc();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.Vc())<0&&this.Pc("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"vc",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.Sc();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.Pc("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.Ac.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Pc",value:function(e){throw this.Ec.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"Sc",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t,n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Ec.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Id=function(){function e(t){(0,s.Z)(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return(0,c.Z)(e,[{key:"lookup",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){var n,r=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new Qr(zr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");case 2:return e.next=4,function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a,u,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=jr(t),i=Fo(r.wt)+"/documents",a={documents:n.map((function(e){return Mo(r.wt,e)}))},e.next=5,r.ao("BatchGetDocuments",i,a,n.length);case 5:return u=e.sent,o=new Map,u.forEach((function(e){var t=qo(r.wt,e);o.set(t.key.toString(),t)})),s=[],e.abrupt("return",(n.forEach((function(e){var t=o.get(e.toString());Gr(!!t),s.push(t)})),s));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach((function(e){return r.recordVersion(e)})),n));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new Xu(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t,n=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(e,t){var r=vi.fromPath(t);n.mutations.push(new Yu(r,n.precondition(r)))})),e.next=7,function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=jr(t),i=Fo(r.wt)+"/documents",a={writes:n.map((function(e){return Ko(r.wt,e)}))},e.next=3,r.ro("Commit",i,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Kr();t=ci.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Qr(zr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Vu.updateTime(t):Vu.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ci.min()))throw new Qr(zr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Vu.updateTime(t)}return Vu.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),Zd=function(){function e(t,n,r,i,a){(0,s.Z)(this,e),this.asyncQueue=t,this.datastore=n,this.options=r,this.updateFunction=i,this.deferred=a,this.Dc=r.maxAttempts,this.So=new eh(this.asyncQueue,"transaction_retry")}return(0,c.Z)(e,[{key:"run",value:function(){this.Dc-=1,this.Cc()}},{key:"Cc",value:function(){var e=this;this.So.Io((0,y.Z)((0,v.Z)().mark((function t(){var n,r;return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=new Id(e.datastore),(r=e.xc(n))&&r.then((function(t){e.asyncQueue.enqueueAndForget((function(){return n.commit().then((function(){e.deferred.resolve(t)})).catch((function(t){e.Nc(t)}))}))})).catch((function(t){e.Nc(t)}));case 2:case"end":return t.stop()}}),t)}))))}},{key:"xc",value:function(e){try{var t=this.updateFunction(e);return!oa(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"Nc",value:function(e){var t=this;this.Dc>0&&this.kc(e)?(this.Dc-=1,this.asyncQueue.enqueueAndForget((function(){return t.Cc(),Promise.resolve()}))):this.deferred.reject(e)}},{key:"kc",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||!$u(t)}return!1}}]),e}(),Ed=function(){function e(t,n,r,i){var a=this;(0,s.Z)(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=Vr.UNAUTHENTICATED,this.clientId=ii.I(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Pr("FirestoreClient","Received user=",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,(function(e){return Pr("FirestoreClient","Received new app check token=",e),a.appCheckCredentialListener(e,a.user)}))}return(0,c.Z)(e,[{key:"getConfiguration",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new Qr(zr.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new Hr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,y.Z)((0,v.Z)().mark((function n(){var r;return(0,v.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=Wh(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))),t.promise}}]),e}();function Td(e,t){return Sd.apply(this,arguments)}function Sd(){return Sd=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),Pr("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,gl(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=n;case 8:case"end":return e.stop()}}),e)}))),Sd.apply(this,arguments)}function _d(e,t){return Dd.apply(this,arguments)}function Dd(){return Dd=(0,y.Z)((0,v.Z)().mark((function e(t,n){var r,i;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,Ad(t);case 3:return r=e.sent,Pr("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener((function(e){return qh(n.remoteStore,e)})),t.setAppCheckTokenChangeListener((function(e,t){return qh(n.remoteStore,t)})),t.onlineComponents=n;case 13:case"end":return e.stop()}}),e)}))),Dd.apply(this,arguments)}function Ad(e){return Cd.apply(this,arguments)}function Cd(){return Cd=(0,y.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return Pr("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,Td(t,new pd);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}}),e)}))),Cd.apply(this,arguments)}function Nd(e){return Rd.apply(this,arguments)}function Rd(){return Rd=(0,y.Z)((0,v.Z)().mark((function e(t){return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return Pr("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,_d(t,new kd);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}}),e)}))),Rd.apply(this,arguments)}function Md(e){return Ad(e).then((function(e){return e.persistence}))}function Vd(e){return Ad(e).then((function(e){return e.localStore}))}function Ld(e){return Nd(e).then((function(e){return e.remoteStore}))}function Od(e){return Nd(e).then((function(e){return e.syncEngine}))}function Fd(e){return Pd.apply(this,arguments)}function Pd(){return Pd=(0,y.Z)((0,v.Z)().mark((function e(t){var n,r;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Nd(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=wf.bind(null,n.syncEngine),r.onUnlisten=Zf.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)}))),Pd.apply(this,arguments)}function Ud(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new Hr;return e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function i(){return(0,v.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new bd({next:function(a){t.enqueueAndForget((function(){return rf(e,u)}));var o=a.docs.has(n);!o&&a.fromCache?i.reject(new Qr(zr.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&a.fromCache&&r&&"server"===r.source?i.reject(new Qr(zr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),u=new cf(iu(n.path),a,{includeMetadataChanges:!0,Du:!0});return tf(e,u)},i.next=3,Fd(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function Bd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new Hr;return e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function i(){return(0,v.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new bd({next:function(n){t.enqueueAndForget((function(){return rf(e,u)})),n.fromCache&&"server"===r.source?i.reject(new Qr(zr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),u=new cf(n,a,{includeMetadataChanges:!0,Du:!0});return tf(e,u)},i.next=3,Fd(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}var qd=new Map;function Kd(e,t,n){if(!n)throw new Qr(zr.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Gd(e,t,n,r){if(!0===t&&!0===r)throw new Qr(zr.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function jd(e){if(!vi.isDocumentKey(e))throw new Qr(zr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function zd(e){if(vi.isDocumentKey(e))throw new Qr(zr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function Qd(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":Kr()}function Hd(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Qr(zr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Qd(e);throw new Qr(zr.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function Wd(e,t){if(t<=0)throw new Qr(zr.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var Xd=function(){function e(t){var n;if((0,s.Z)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new Qr(zr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Qr(zr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Gd("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return(0,c.Z)(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),Yd=function(){function e(t,n,r){(0,s.Z)(this,e),this._authCredentials=n,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Xd({}),this._settingsFrozen=!1,t instanceof ua?this._databaseId=t:(this._app=t,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Qr(zr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ua(e.options.projectId)}(t))}return(0,c.Z)(e,[{key:"app",get:function(){if(!this._app)throw new Qr(zr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new Qr(zr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Xd(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Xr;switch(e.type){case"gapi":var t=e.client;return Gr(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new ei(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new Qr(zr.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return function(e){var t=qd.get(e);t&&(Pr("ComponentProvider","Removing Datastore"),qd.delete(e),t.terminate())}(this),Promise.resolve()}}]),e}();function Jd(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=Hd(e,Yd))._getSettings();if("firestore.googleapis.com"!==a.host&&a.host!==t&&Br("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},a),{host:"".concat(t,":").concat(n),ssl:!1})),i.mockUserToken){var u,o;if("string"==typeof i.mockUserToken)u=i.mockUserToken,o=Vr.MOCK_USER;else{u=(0,w.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new Qr(zr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");o=new Vr(s)}e._authCredentials=new Yr(new Wr(u,o))}}var $d=function(){function e(t,n,r){(0,s.Z)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return(0,c.Z)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new tv(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),ev=function(){function e(t,n,r){(0,s.Z)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return(0,c.Z)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),tv=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a;return(0,s.Z)(this,n),(a=t.call(this,e,r,iu(i)))._path=i,a.type="collection",a}return(0,c.Z)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new $d(this.firestore,null,new vi(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(ev);function nv(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,w.m9)(e),Kd("collection","path",t),e instanceof Yd){var a=hi.fromString.apply(hi,[t].concat(r));return zd(a),new tv(e,null,a)}if(!(e instanceof $d||e instanceof tv))throw new Qr(zr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var u=e._path.child(hi.fromString.apply(hi,[t].concat(r)));return zd(u),new tv(e.firestore,null,u)}function rv(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,w.m9)(e),1===arguments.length&&(t=ii.I()),Kd("doc","path",t),e instanceof Yd){var a=hi.fromString.apply(hi,[t].concat(r));return jd(a),new $d(e,null,new vi(a))}if(!(e instanceof $d||e instanceof tv))throw new Qr(zr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var u=e._path.child(hi.fromString.apply(hi,[t].concat(r)));return jd(u),new $d(e.firestore,e instanceof tv?e.converter:null,new vi(u))}function iv(e,t){return e=(0,w.m9)(e),t=(0,w.m9)(t),(e instanceof $d||e instanceof tv)&&(t instanceof $d||t instanceof tv)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function av(e,t){return e=(0,w.m9)(e),t=(0,w.m9)(t),e instanceof ev&&t instanceof ev&&e.firestore===t.firestore&&hu(e._query,t._query)&&e.converter===t.converter}var uv=function(){function e(){var t=this;(0,s.Z)(this,e),this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new eh(this,"async_queue_retry"),this.Kc=function(){var e=Jl();e&&Pr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.So.Eo()};var n=Jl();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Kc)}return(0,c.Z)(e,[{key:"isShuttingDown",get:function(){return this.Fc}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.Gc(),this.Qc(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.Fc){this.Fc=!0,this.Uc=e||!1;var t=Jl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Kc)}}},{key:"enqueue",value:function(e){var t=this;if(this.Gc(),this.Fc)return new Promise((function(){}));var n=new Hr;return this.Qc((function(){return t.Fc&&t.Uc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.Mc.push(e),t.jc()}))}},{key:"jc",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t=this;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.Mc.length){e.next=14;break}return e.prev=1,e.next=4,this.Mc[0]();case 4:this.Mc.shift(),this.So.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Ri(e.t0)){e.next=12;break}throw e.t0;case 12:Pr("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.Mc.length>0&&this.So.Io((function(){return t.jc()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"Qc",value:function(e){var t=this,n=this.Oc.then((function(){return t.Lc=!0,e().catch((function(e){t.Bc=e,t.Lc=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Ur("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.Lc=!1,e}))}));return this.Oc=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.Gc(),this.qc.indexOf(e)>-1&&(t=0);var i=Hh.createAndSchedule(this,e,t,n,(function(e){return r.Wc(e)}));return this.$c.push(i),i}},{key:"Gc",value:function(){this.Bc&&Kr()}},{key:"verifyOperationInProgress",value:function(){}},{key:"zc",value:function(){var e=(0,y.Z)((0,v.Z)().mark((function e(){var t;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.Oc,e.next=3,t;case 3:if(t!==this.Oc){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Hc",value:function(e){var t,n=(0,o.Z)(this.$c);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Jc",value:function(e){var t=this;return this.zc().then((function(){t.$c.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=(0,o.Z)(t.$c);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.zc()}))}},{key:"Yc",value:function(e){this.qc.push(e)}},{key:"Wc",value:function(e){var t=this.$c.indexOf(e);this.$c.splice(t,1)}}]),e}();function ov(e){return function(e,t){if("object"!=typeof e||null===e)return!1;var n,r=e,i=(0,o.Z)(["next","error","complete"]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(u){i.e(u)}finally{i.f()}return!1}(e)}var sv=function(){function e(){(0,s.Z)(this,e),this._progressObserver={},this._taskCompletionResolver=new Hr,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return(0,c.Z)(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}(),cv=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a;return(0,s.Z)(this,n),(a=t.call(this,e,r,i)).type="firestore",a._queue=new uv,a._persistenceKey="name"in e?e.name:"[DEFAULT]",a}return(0,c.Z)(n,[{key:"_terminate",value:function(){return this._firestoreClient||hv(this),this._firestoreClient.terminate()}}]),n}(Yd);function lv(e){return e._firestoreClient||hv(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function hv(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new aa(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Ed(e._authCredentials,e._appCheckCredentials,e._queue,r)}function fv(e,t,n){var r=new Hr;return e.asyncQueue.enqueue((0,y.Z)((0,v.Z)().mark((function i(){var a;return(0,v.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,Td(e,n);case 3:return i.next=5,_d(e,t);case 5:r.resolve(),i.next=14;break;case 8:if(i.prev=8,i.t0=i.catch(0),function(e){return"FirebaseError"===e.name?e.code===zr.FAILED_PRECONDITION||e.code===zr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(a=i.t0)){i.next=13;break}throw a;case 13:console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+a),r.reject(a);case 14:case"end":return i.stop()}}),i,null,[[0,8]])})))).then((function(){return r.promise}))}function dv(e){return function(e){return e.asyncQueue.enqueue((0,y.Z)((0,v.Z)().mark((function t(){var n,r;return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Md(e);case 2:return n=t.sent,t.next=5,Ld(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=jr(e);return t.lu.delete(0),oh(t)}(r)));case 7:case"end":return t.stop()}}),t)}))))}(lv(e=Hd(e,cv)))}function vv(e){return function(e){return e.asyncQueue.enqueue((0,y.Z)((0,v.Z)().mark((function t(){var n,r;return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Md(e);case 2:return n=t.sent,t.next=5,Ld(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=jr(t)).lu.add(0),e.next=4,ch(n);case 4:n._u.set("Offline");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}}),t)}))))}(lv(e=Hd(e,cv)))}function yv(e,t){var n=lv(e=Hd(e,cv)),r=new sv;return function(e,t,n,r){var i=function(e,t){return function(e,t){return new xd(e,t)}(function(e,t){if(e instanceof Uint8Array)return wd(e,t);if(e instanceof ArrayBuffer)return wd(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),t)}(n,$l(t));e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=yd,t.next=3,Od(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}}),t)}))))}(n,e._databaseId,t,r),r}function pv(e,t){return function(e,t){return e.asyncQueue.enqueue((0,y.Z)((0,v.Z)().mark((function n(){return(0,v.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=jr(e);return n.persistence.runTransaction("Get named query","readonly",(function(e){return n.Ds.getNamedQuery(e,t)}))},n.next=3,Vd(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))}(lv(e=Hd(e,cv)),t).then((function(t){return t?new ev(e,null,t.query):null}))}function mv(e){if(e._initialized||e._terminated)throw new Qr(zr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var gv=function(){function e(){(0,s.Z)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new Qr(zr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new di(n)}return(0,c.Z)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();var kv=function(){function e(t){(0,s.Z)(this,e),this._byteString=t}return(0,c.Z)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(Yi.fromBase64String(t))}catch(t){throw new Qr(zr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(Yi.fromUint8Array(t))}}]),e}(),wv=(0,c.Z)((function e(t){(0,s.Z)(this,e),this._methodName=t})),bv=function(){function e(t,n){if((0,s.Z)(this,e),!isFinite(t)||t<-90||t>90)throw new Qr(zr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new Qr(zr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return(0,c.Z)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return ai(this._lat,e._lat)||ai(this._long,e._long)}}]),e}(),xv=/^__.*__$/,Iv=function(){function e(t,n,r){(0,s.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,c.Z)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new Gu(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ku(e,this.data,t,this.fieldTransforms)}}]),e}(),Zv=function(){function e(t,n,r){(0,s.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,c.Z)(e,[{key:"toMutation",value:function(e,t){return new Gu(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function Ev(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Kr()}}var Tv=function(){function e(t,n,r,i,a,u){(0,s.Z)(this,e),this.settings=t,this.databaseId=n,this.wt=r,this.ignoreUndefinedProperties=i,void 0===a&&this.Xc(),this.fieldTransforms=a||[],this.fieldMask=u||[]}return(0,c.Z)(e,[{key:"path",get:function(){return this.settings.path}},{key:"Zc",get:function(){return this.settings.Zc}},{key:"ta",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"ea",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ta({path:n,na:!1});return r.sa(e),r}},{key:"ia",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ta({path:n,na:!1});return r.Xc(),r}},{key:"ra",value:function(e){return this.ta({path:void 0,na:!0})}},{key:"oa",value:function(e){return zv(e,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"Xc",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.sa(this.path.get(e))}},{key:"sa",value:function(e){if(0===e.length)throw this.oa("Document fields must not be empty");if(Ev(this.Zc)&&xv.test(e))throw this.oa('Document fields cannot begin and end with "__"')}}]),e}(),Sv=function(){function e(t,n,r){(0,s.Z)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.wt=r||$l(t)}return(0,c.Z)(e,[{key:"aa",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Tv({Zc:e,methodName:t,ca:n,path:di.emptyPath(),na:!1,ua:r},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}]),e}();function _v(e){var t=e._freezeSettings(),n=$l(e._databaseId);return new Sv(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Dv(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=e.aa(a.merge||a.mergeFields?2:0,t,n,i);qv("Data must be an object, but it was:",u,r);var s,c,l=Uv(r,u);if(a.merge)s=new Xi(u.fieldMask),c=u.fieldTransforms;else if(a.mergeFields){var h,f=[],d=(0,o.Z)(a.mergeFields);try{for(d.s();!(h=d.n()).done;){var v=h.value,y=Kv(t,v,n);if(!u.contains(y))throw new Qr(zr.INVALID_ARGUMENT,"Field '".concat(y,"' is specified in your field mask but missing from your input data."));Qv(f,y)||f.push(y)}}catch(p){d.e(p)}finally{d.f()}s=new Xi(f),c=u.fieldTransforms.filter((function(e){return s.covers(e.field)}))}else s=null,c=u.fieldTransforms;return new Iv(new Ca(l),s,c)}var Av=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.Zc)throw 1===e.Zc?e.oa("".concat(this._methodName,"() can only appear at the top level of your update data")):e.oa("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(wv);function Cv(e,t,n){return new Tv({Zc:3,ca:t.settings.ca,methodName:e._methodName,na:n},t.databaseId,t.wt,t.ignoreUndefinedProperties)}var Nv=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"_toFieldTransform",value:function(e){return new Ru(e.path,new Eu)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(wv),Rv=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).ha=r,i}return(0,c.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=Cv(this,e,!0),n=this.ha.map((function(e){return Pv(e,t)})),r=new Tu(n);return new Ru(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(wv),Mv=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).ha=r,i}return(0,c.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=Cv(this,e,!0),n=this.ha.map((function(e){return Pv(e,t)})),r=new _u(n);return new Ru(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(wv),Vv=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).la=r,i}return(0,c.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=new Au(e.wt,wu(e.wt,this.la));return new Ru(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}(wv);function Lv(e,t,n,r){var i=e.aa(1,t,n);qv("Data must be an object, but it was:",i,r);var a=[],u=Ca.empty();qi(r,(function(e,r){var o=jv(t,e,n);r=(0,w.m9)(r);var s=i.ia(o);if(r instanceof Av)a.push(o);else{var c=Pv(r,s);null!=c&&(a.push(o),u.set(o,c))}}));var o=new Xi(a);return new Zv(u,o,i.fieldTransforms)}function Ov(e,t,n,r,i,a){var u=e.aa(1,t,n),o=[Kv(t,r,n)],s=[i];if(a.length%2!=0)throw new Qr(zr.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)o.push(Kv(t,a[c])),s.push(a[c+1]);for(var l=[],h=Ca.empty(),f=o.length-1;f>=0;--f)if(!Qv(l,o[f])){var d=o[f],v=s[f];v=(0,w.m9)(v);var y=u.ia(d);if(v instanceof Av)l.push(d);else{var p=Pv(v,y);null!=p&&(l.push(d),h.set(d,p))}}var m=new Xi(l);return new Zv(h,m,u.fieldTransforms)}function Fv(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Pv(n,e.aa(r?4:3,t))}function Pv(e,t){if(Bv(e=(0,w.m9)(e)))return qv("Unsupported field value:",t,e),Uv(e,t);if(e instanceof wv)return function(e,t){if(!Ev(t.Zc))throw t.oa("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.oa("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.na&&4!==t.Zc)throw t.oa("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=(0,o.Z)(e);try{for(a.s();!(n=a.n()).done;){var u=Pv(n.value,t.ra(i));null==u&&(u={nullValue:"NULL_VALUE"}),r.push(u),i++}}catch(s){a.e(s)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,w.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return wu(t.wt,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=si.fromDate(e);return{timestampValue:_o(t.wt,n)}}if(e instanceof si){var r=new si(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:_o(t.wt,r)}}if(e instanceof bv)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof kv)return{bytesValue:Do(t.wt,e._byteString)};if(e instanceof $d){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.oa("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:No(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.oa("Unsupported field value: ".concat(Qd(e)))}(e,t)}function Uv(e,t){var n={};return Ki(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):qi(e,(function(e,r){var i=Pv(r,t.ea(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Bv(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof si||e instanceof bv||e instanceof kv||e instanceof $d||e instanceof wv)}function qv(e,t,n){if(!Bv(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=Qd(n);throw"an object"===r?t.oa(e+" a custom object"):t.oa(e+" "+r)}}function Kv(e,t,n){if((t=(0,w.m9)(t))instanceof gv)return t._internalPath;if("string"==typeof t)return jv(e,t);throw zv("Field path arguments must be of type string or ",e,!1,void 0,n)}var Gv=new RegExp("[~\\*/\\[\\]]");function jv(e,t,n){if(t.search(Gv)>=0)throw zv("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return(0,i.Z)(gv,(0,p.Z)(t.split(".")))._internalPath}catch(r){throw zv("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function zv(e,t,n,r,i){var a=r&&!r.isEmpty(),u=void 0!==i,o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";var s="";return(a||u)&&(s+=" (found",a&&(s+=" in field ".concat(r)),u&&(s+=" in document ".concat(i)),s+=")"),new Qr(zr.INVALID_ARGUMENT,o+e+s)}function Qv(e,t){return e.some((function(e){return e.isEqual(t)}))}var Hv=function(){function e(t,n,r,i,a){(0,s.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return(0,c.Z)(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new $d(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new Wv(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(Xv("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),Wv=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"data",value:function(){return(0,h.Z)((0,f.Z)(n.prototype),"data",this).call(this)}}]),n}(Hv);function Xv(e,t){return"string"==typeof t?jv(e,t):t instanceof gv?t._internalPath:t._delegate._internalPath}var Yv=function(){function e(t,n){(0,s.Z)(this,e),this.hasPendingWrites=t,this.fromCache=n}return(0,c.Z)(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),Jv=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i,a,u,o){var c;return(0,s.Z)(this,n),(c=t.call(this,e,r,i,a,o))._firestore=e,c._firestoreImpl=e,c.metadata=u,c}return(0,c.Z)(n,[{key:"exists",value:function(){return(0,h.Z)((0,f.Z)(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new $v(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(Xv("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(Hv),$v=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,h.Z)((0,f.Z)(n.prototype),"data",this).call(this,e)}}]),n}(Jv),ey=function(){function e(t,n,r,i){(0,s.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new Yv(i.hasPendingWrites,i.fromCache),this.query=r}return(0,c.Z)(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new $v(n._firestore,n._userDataWriter,r.key,r,new Yv(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Qr(zr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){return{type:"added",doc:new $v(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Yv(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new $v(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Yv(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:ty(t.type),doc:n,oldIndex:i,newIndex:a}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]),e}();function ty(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kr()}}function ny(e,t){return e instanceof Jv&&t instanceof Jv?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof ey&&t instanceof ey&&e._firestore===t._firestore&&av(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function ry(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Qr(zr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var iy=(0,c.Z)((function e(){(0,s.Z)(this,e)}));function ay(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=u._apply(e)}return e}var uy=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a;return(0,s.Z)(this,n),(a=t.call(this)).fa=e,a.da=r,a._a=i,a.type="where",a}return(0,c.Z)(n,[{key:"_apply",value:function(e){var t=_v(e.firestore),n=function(e,t,n,r,i,a,u){var s;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new Qr(zr.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on documentId()."));if("in"===a||"not-in"===a){my(u,a);var c,l=[],h=(0,o.Z)(u);try{for(h.s();!(c=h.n()).done;){var f=c.value;l.push(py(r,e,f))}}catch(v){h.e(v)}finally{h.f()}s={arrayValue:{values:l}}}else s=py(r,e,u)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||my(u,a),s=Fv(n,"where",u,"in"===a||"not-in"===a);var d=qa.create(i,a,s);return function(e,t){if(t.ht()){var n=uu(e);if(null!==n&&!n.isEqual(t.field))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(t.field.toString(),"'"));var r=au(e);null!==r&&gy(e,t.field,r)}var i=function(e,t){var n,r=(0,o.Z)(e.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.indexOf(i.op)>=0)return i.op}}catch(v){r.e(v)}finally{r.f()}return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==i)throw i===t.op?new Qr(zr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new Qr(zr.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(i.toString(),"' filters."))}(e,d),d}(e._query,0,t,e.firestore._databaseId,this.fa,this.da,this._a);return new ev(e.firestore,e.converter,function(e,t){var n=e.filters.concat([t]);return new nu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}]),n}(iy);var oy=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this)).fa=e,i.wa=r,i.type="orderBy",i}return(0,c.Z)(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ja(t,n);return function(e,t){if(null===au(e)){var n=uu(e);null!==n&&gy(e,n,t.field)}}(e,r),r}(e._query,this.fa,this.wa);return new ev(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new nu(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}]),n}(iy);var sy=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a;return(0,s.Z)(this,n),(a=t.call(this)).type=e,a.ma=r,a.ga=i,a}return(0,c.Z)(n,[{key:"_apply",value:function(e){return new ev(e.firestore,e.converter,lu(e._query,this.ma,this.ga))}}]),n}(iy);var cy=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a;return(0,s.Z)(this,n),(a=t.call(this)).type=e,a.ya=r,a.pa=i,a}return(0,c.Z)(n,[{key:"_apply",value:function(e){var t=yy(e,this.type,this.ya,this.pa);return new ev(e.firestore,e.converter,function(e,t){return new nu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}]),n}(iy);function ly(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new cy("startAt",t,!0)}function hy(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new cy("startAfter",t,!1)}var fy=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r,i){var a;return(0,s.Z)(this,n),(a=t.call(this)).type=e,a.ya=r,a.pa=i,a}return(0,c.Z)(n,[{key:"_apply",value:function(e){var t=yy(e,this.type,this.ya,this.pa);return new ev(e.firestore,e.converter,function(e,t){return new nu(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}]),n}(iy);function dy(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new fy("endBefore",t,!1)}function vy(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new fy("endAt",t,!0)}function yy(e,t,n,r){if(n[0]=(0,w.m9)(n[0]),n[0]instanceof Hv)return function(e,t,n,r,i){if(!r)throw new Qr(zr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,u=[],s=(0,o.Z)(su(e));try{for(s.s();!(a=s.n()).done;){var c=a.value;if(c.field.isKeyField())u.push(ka(t,r.key));else{var l=r.data.field(c.field);if(na(l))throw new Qr(zr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===l){var h=c.field.canonicalString();throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(h,"' (used as the orderBy) does not exist."))}u.push(l)}}}catch(f){s.e(f)}finally{s.f()}return new Ya(u,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=_v(e.firestore);return function(e,t,n,r,i,a){var u=e.explicitOrderBy;if(i.length>u.length)throw new Qr(zr.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var o=[],s=0;s<i.length;s++){var c=i[s];if(u[s].field.isKeyField()){if("string"!=typeof c)throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof c));if(!ou(e)&&-1!==c.indexOf("/"))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(hi.fromString(c));if(!vi.isDocumentKey(l))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var h=new vi(l);o.push(ka(t,h))}else{var f=Fv(n,r,c);o.push(f)}}return new Ya(o,a)}(e._query,e.firestore._databaseId,i,t,n,r)}function py(e,t,n){if("string"==typeof(n=(0,w.m9)(n))){if(""===n)throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ou(t)&&-1!==n.indexOf("/"))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(hi.fromString(n));if(!vi.isDocumentKey(r))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return ka(e,new vi(r))}if(n instanceof $d)return ka(e,n._key);throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(Qd(n),"."))}function my(e,t){if(!Array.isArray(e)||0===e.length)throw new Qr(zr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."));if(e.length>10)throw new Qr(zr.INVALID_ARGUMENT,"Invalid Query. '".concat(t.toString(),"' filters support a maximum of 10 elements in the value array."))}function gy(e,t,n){if(!n.isEqual(t))throw new Qr(zr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var ky={maxAttempts:5},wy=function(){function e(){(0,s.Z)(this,e)}return(0,c.Z)(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(fa(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ea(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ta(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Kr()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return qi(e.fields,(function(e,i){r[e]=n.convertValue(i,t)})),r}},{key:"convertGeoPoint",value:function(e){return new bv(ea(e.latitude),ea(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=ra(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ia(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=$i(e);return new si(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=hi.fromString(e);Gr(ns(n));var r=new ua(n.get(1),n.get(3)),i=new vi(n.popFirst(5));return r.isEqual(t)||Ur("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function by(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var xy=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,c.Z)(n,[{key:"convertBytes",value:function(e){return new kv(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new $d(this.firestore,null,t)}}]),n}(wy),Iy=function(){function e(t,n){(0,s.Z)(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=_v(t)}return(0,c.Z)(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=Zy(e,this._firestore),i=by(r.converter,t,n),a=Dv(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,Vu.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,i=Zy(e,this._firestore),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return r="string"==typeof(t=(0,w.m9)(t))||t instanceof gv?Ov(this._dataReader,"WriteBatch.update",i._key,t,n,u):Lv(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,Vu.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=Zy(e,this._firestore);return this._mutations=this._mutations.concat(new Xu(t._key,Vu.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new Qr(zr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function Zy(e,t){if((e=(0,w.m9)(e)).firestore!==t)throw new Qr(zr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}var Ey=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,c.Z)(n,[{key:"convertBytes",value:function(e){return new kv(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new $d(this.firestore,null,t)}}]),n}(wy);function Ty(e){e=Hd(e,$d);var t=Hd(e.firestore,cv),n=lv(t),r=new Ey(t);return function(e,t){var n=new Hr;return e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function r(){return(0,v.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=jr(e);return n.persistence.runTransaction("read document","readonly",(function(e){return n.localDocuments.getDocument(e,t)}))}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new Qr(zr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=Wh(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(a);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Vd(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._key).then((function(n){return new Jv(t,r,e._key,n,new Yv(null!==n&&n.hasLocalMutations,!0),e.converter)}))}function Sy(e){e=Hd(e,ev);var t=Hd(e.firestore,cv),n=lv(t),r=new Ey(t);return function(e,t){var n=new Hr;return e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function r(){return(0,v.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t,n,r){var i,a,u,o,s;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_l(t,n,!0);case 3:i=e.sent,a=new pf(n,i.ji),u=a.Ku(i.documents),o=a.applyChanges(u,!1),r.resolve(o.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),s=Wh(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(s);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Vd(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._query).then((function(n){return new ey(t,r,e,n)}))}function _y(e,t,n){e=Hd(e,$d);var r=Hd(e.firestore,cv),i=by(e.converter,t,n);return Ny(r,[Dv(_v(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Vu.none())])}function Dy(e,t,n){e=Hd(e,$d);for(var r=Hd(e.firestore,cv),i=_v(r),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return Ny(r,[("string"==typeof(t=(0,w.m9)(t))||t instanceof gv?Ov(i,"updateDoc",e._key,t,n,u):Lv(i,"updateDoc",e._key,t)).toMutation(e._key,Vu.exists(!0))])}function Ay(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,u;e=(0,w.m9)(e);var o={includeMetadataChanges:!1},s=0;"object"!=typeof n[s]||ov(n[s])||(o=n[s],s++);var c,l,h,f={includeMetadataChanges:o.includeMetadataChanges};if(ov(n[s])){var d=n[s];n[s]=null===(i=d.next)||void 0===i?void 0:i.bind(d),n[s+1]=null===(a=d.error)||void 0===a?void 0:a.bind(d),n[s+2]=null===(u=d.complete)||void 0===u?void 0:u.bind(d)}if(e instanceof $d)l=Hd(e.firestore,cv),h=iu(e._key.path),c={next:function(t){n[s]&&n[s](Ry(l,e,t))},error:n[s+1],complete:n[s+2]};else{var p=Hd(e,ev);l=Hd(p.firestore,cv),h=p._query;var m=new Ey(l);c={next:function(e){n[s]&&n[s](new ey(l,m,p,e))},error:n[s+1],complete:n[s+2]},ry(e._query)}return function(e,t,n,r){var i=new bd(r),a=new cf(t,i,n);return e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=tf,t.next=3,Fd(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){i.Tc(),e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=rf,t.next=3,Fd(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(lv(l),h,f,c)}function Cy(e,t){return function(e,t){var n=new bd(t);return e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){jr(e).Tu.add(t),t.next()},t.next=3,Fd(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){n.Tc(),e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function t(){return(0,v.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){jr(e).Tu.delete(t)},t.next=3,Fd(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(lv(e=Hd(e,cv)),ov(t)?t:{next:t})}function Ny(e,t){return function(e,t){var n=new Hr;return e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function r(){return(0,v.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=Tf,r.next=3,Od(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(lv(e),t)}function Ry(e,t,n){var r=n.docs.get(t._key),i=new Ey(e);return new Jv(e,i,t._key,r,new Yv(n.hasPendingWrites,n.fromCache),t.converter)}var My=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this,e,r))._firestore=e,i}return(0,c.Z)(n,[{key:"get",value:function(e){var t=this,r=Zy(e,this._firestore),i=new Ey(this._firestore);return(0,h.Z)((0,f.Z)(n.prototype),"get",this).call(this,e).then((function(e){return new Jv(t._firestore,i,r._key,e._document,new Yv(!1,!1),r.converter)}))}}]),n}(function(){function e(t,n){(0,s.Z)(this,e),this._firestore=t,this._transaction=n,this._dataReader=_v(t)}return(0,c.Z)(e,[{key:"get",value:function(e){var t=this,n=Zy(e,this._firestore),r=new xy(this._firestore);return this._transaction.lookup([n._key]).then((function(e){if(!e||1!==e.length)return Kr();var i=e[0];if(i.isFoundDocument())return new Hv(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Hv(t._firestore,r,n._key,null,n.converter);throw Kr()}))}},{key:"set",value:function(e,t,n){var r=Zy(e,this._firestore),i=by(r.converter,t,n),a=Dv(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:"update",value:function(e,t,n){for(var r,i=Zy(e,this._firestore),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return r="string"==typeof(t=(0,w.m9)(t))||t instanceof gv?Ov(this._dataReader,"Transaction.update",i._key,t,n,u):Lv(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}},{key:"delete",value:function(e){var t=Zy(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function Vy(e,t,n){e=Hd(e,cv);var r=Object.assign(Object.assign({},ky),n);return function(e){if(e.maxAttempts<1)throw new Qr(zr.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){var r=new Hr;return e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function i(){var a;return(0,v.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,function(e){return Nd(e).then((function(e){return e.datastore}))}(e);case 2:a=i.sent,new Zd(e.asyncQueue,a,n,t,r).run();case 4:case"end":return i.stop()}}),i)})))),r.promise}(lv(e),(function(n){return t(new My(e,n))}),r)}function Ly(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Rv("arrayUnion",t)}function Oy(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Mv("arrayRemove",t)}!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){Lr=e}(m.SDK_VERSION),(0,m._registerComponent)(new g.wA("firestore",(function(e,n){var r=n.options,i=e.getProvider("app").getImmediate(),a=new cv(i,new Jr(e.getProvider("auth-internal")),new ni(e.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a}),"PUBLIC")),(0,m.registerVersion)(Mr,"3.4.12",e),(0,m.registerVersion)(Mr,"3.4.12","esm2017")}();function Fy(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Qr("invalid-argument","Invalid options passed to function ".concat(e,"(): You cannot ")+'specify both "merge" and "mergeFields".');return t}function Py(){if("undefined"===typeof Uint8Array)throw new Qr("unimplemented","Uint8Arrays are not available in this environment.")}function Uy(){if("undefined"==typeof atob)throw new Qr("unimplemented","Blobs are unavailable in Firestore in this environment.")}var By=function(){function e(t){(0,s.Z)(this,e),this._delegate=t}return(0,c.Z)(e,[{key:"toBase64",value:function(){return Uy(),this._delegate.toBase64()}},{key:"toUint8Array",value:function(){return Py(),this._delegate.toUint8Array()}},{key:"isEqual",value:function(e){return this._delegate.isEqual(e._delegate)}},{key:"toString",value:function(){return"Blob(base64: "+this.toBase64()+")"}}],[{key:"fromBase64String",value:function(t){return Uy(),new e(kv.fromBase64String(t))}},{key:"fromUint8Array",value:function(t){return Py(),new e(kv.fromUint8Array(t))}}]),e}();function qy(e){return function(e,t){if("object"!==typeof e||null===e)return!1;var n,r=e,i=(0,o.Z)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"===typeof r[a])return!0}}catch(u){i.e(u)}finally{i.f()}return!1}(e,["next","error","complete"])}var Ky=function(){function e(){(0,s.Z)(this,e)}return(0,c.Z)(e,[{key:"enableIndexedDbPersistence",value:function(e,t){return function(e,t){mv(e=Hd(e,cv));var n=lv(e),r=e._freezeSettings(),i=new kd;return fv(n,i,new md(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}},{key:"enableMultiTabIndexedDbPersistence",value:function(e){return function(e){mv(e=Hd(e,cv));var t=lv(e),n=e._freezeSettings(),r=new kd;return fv(t,r,new gd(r,n.cacheSizeBytes))}(e._delegate)}},{key:"clearIndexedDbPersistence",value:function(e){return function(e){if(e._initialized&&!e._terminated)throw new Qr(zr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new Hr;return e._queue.enqueueAndForgetEvenWhileRestricted((0,y.Z)((0,v.Z)().mark((function n(){return(0,v.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=(0,y.Z)((0,v.Z)().mark((function e(t){var n;return(0,v.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ai.V()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,Ai.delete(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(dl(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.promise}(e._delegate)}}]),e}(),Gy=function(){function e(t,n,r){var i=this;(0,s.Z)(this,e),this._delegate=n,this._persistenceProvider=r,this.INTERNAL={delete:function(){return i.terminate()}},t instanceof ua||(this._appCompat=t)}return(0,c.Z)(e,[{key:"_databaseId",get:function(){return this._delegate._databaseId}},{key:"settings",value:function(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Br("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}},{key:"useEmulator",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Jd(this._delegate,e,t,n)}},{key:"enableNetwork",value:function(){return dv(this._delegate)}},{key:"disableNetwork",value:function(){return vv(this._delegate)}},{key:"enablePersistence",value:function(e){var t=!1,n=!1;return e&&Gd("synchronizeTabs",t=!!e.synchronizeTabs,"experimentalForceOwningTab",n=!!e.experimentalForceOwningTab),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}},{key:"clearPersistence",value:function(){return this._persistenceProvider.clearIndexedDbPersistence(this)}},{key:"terminate",value:function(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}},{key:"waitForPendingWrites",value:function(){return function(e){return function(e){var t=new Hr;return e.asyncQueue.enqueueAndForget((0,y.Z)((0,v.Z)().mark((function n(){return(0,v.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=Of,n.next=3,Od(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)})))),t.promise}(lv(e=Hd(e,cv)))}(this._delegate)}},{key:"onSnapshotsInSync",value:function(e){return Cy(this._delegate,e)}},{key:"app",get:function(){if(!this._appCompat)throw new Qr("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}},{key:"collection",value:function(e){try{return new ip(this,nv(this._delegate,e))}catch(t){throw Xy(t,"collection()","Firestore.collection()")}}},{key:"doc",value:function(e){try{return new Wy(this,rv(this._delegate,e))}catch(t){throw Xy(t,"doc()","Firestore.doc()")}}},{key:"collectionGroup",value:function(e){try{return new tp(this,function(e,t){if(e=Hd(e,Yd),Kd("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Qr(zr.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new ev(e,null,function(e){return new nu(hi.emptyPath(),e)}(t))}(this._delegate,e))}catch(t){throw Xy(t,"collectionGroup()","Firestore.collectionGroup()")}}},{key:"runTransaction",value:function(e){var t=this;return Vy(this._delegate,(function(n){return e(new zy(t,n))}))}},{key:"batch",value:function(){var e=this;return lv(this._delegate),new Qy(new Iy(this._delegate,(function(t){return Ny(e._delegate,t)})))}},{key:"loadBundle",value:function(e){return yv(this._delegate,e)}},{key:"namedQuery",value:function(e){var t=this;return pv(this._delegate,e).then((function(e){return e?new tp(t,e):null}))}}]),e}(),jy=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e){var r;return(0,s.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,c.Z)(n,[{key:"convertBytes",value:function(e){return new By(new kv(e))}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return Wy.forKey(t,this.firestore,null)}}]),n}(wy);var zy=function(){function e(t,n){(0,s.Z)(this,e),this._firestore=t,this._delegate=n,this._userDataWriter=new jy(t)}return(0,c.Z)(e,[{key:"get",value:function(e){var t=this,n=ap(e);return this._delegate.get(n).then((function(e){return new $y(t._firestore,new Jv(t._firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,n.converter))}))}},{key:"set",value:function(e,t,n){var r=ap(e);return n?(Fy("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}},{key:"update",value:function(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];var u,o=ap(e);2===arguments.length?this._delegate.update(o,t):(u=this._delegate).update.apply(u,[o,t,n].concat(i));return this}},{key:"delete",value:function(e){var t=ap(e);return this._delegate.delete(t),this}}]),e}(),Qy=function(){function e(t){(0,s.Z)(this,e),this._delegate=t}return(0,c.Z)(e,[{key:"set",value:function(e,t,n){var r=ap(e);return n?(Fy("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}},{key:"update",value:function(e,t,n){for(var r=arguments.length,i=new Array(r>3?r-3:0),a=3;a<r;a++)i[a-3]=arguments[a];var u,o=ap(e);2===arguments.length?this._delegate.update(o,t):(u=this._delegate).update.apply(u,[o,t,n].concat(i));return this}},{key:"delete",value:function(e){var t=ap(e);return this._delegate.delete(t),this}},{key:"commit",value:function(){return this._delegate.commit()}}]),e}(),Hy=function(){function e(t,n,r){(0,s.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._delegate=r}return(0,c.Z)(e,[{key:"fromFirestore",value:function(e,t){var n=new $v(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ep(this._firestore,n),null!==t&&void 0!==t?t:{})}},{key:"toFirestore",value:function(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}}],[{key:"getInstance",value:function(t,n){var r=e.INSTANCES,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var a=i.get(n);return a||(a=new e(t,new jy(t),n),i.set(n,a)),a}}]),e}();Hy.INSTANCES=new WeakMap;var Wy=function(){function e(t,n){(0,s.Z)(this,e),this.firestore=t,this._delegate=n,this._userDataWriter=new jy(t)}return(0,c.Z)(e,[{key:"id",get:function(){return this._delegate.id}},{key:"parent",get:function(){return new ip(this.firestore,this._delegate.parent)}},{key:"path",get:function(){return this._delegate.path}},{key:"collection",value:function(e){try{return new ip(this.firestore,nv(this._delegate,e))}catch(t){throw Xy(t,"collection()","DocumentReference.collection()")}}},{key:"isEqual",value:function(e){return(e=(0,w.m9)(e))instanceof $d&&iv(this._delegate,e)}},{key:"set",value:function(e,t){t=Fy("DocumentReference.set",t);try{return t?_y(this._delegate,e,t):_y(this._delegate,e)}catch(n){throw Xy(n,"setDoc()","DocumentReference.set()")}}},{key:"update",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];try{return 1===arguments.length?Dy(this._delegate,e):Dy.apply(void 0,[this._delegate,e,t].concat(r))}catch(a){throw Xy(a,"updateDoc()","DocumentReference.update()")}}},{key:"delete",value:function(){return function(e){return Ny(Hd(e.firestore,cv),[new Xu(e._key,Vu.none())])}(this._delegate)}},{key:"onSnapshot",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=Yy(n),a=Jy(n,(function(t){return new $y(e.firestore,new Jv(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}));return Ay(this._delegate,i,a)}},{key:"get",value:function(e){var t,n=this;return t="cache"===(null===e||void 0===e?void 0:e.source)?Ty(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?function(e){e=Hd(e,$d);var t=Hd(e.firestore,cv);return Ud(lv(t),e._key,{source:"server"}).then((function(n){return Ry(t,e,n)}))}(this._delegate):function(e){e=Hd(e,$d);var t=Hd(e.firestore,cv);return Ud(lv(t),e._key).then((function(n){return Ry(t,e,n)}))}(this._delegate),t.then((function(e){return new $y(n.firestore,new Jv(n.firestore._delegate,n._userDataWriter,e._key,e._document,e.metadata,n._delegate.converter))}))}},{key:"withConverter",value:function(t){return new e(this.firestore,t?this._delegate.withConverter(Hy.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}],[{key:"forPath",value:function(t,n,r){if(t.length%2!==0)throw new Qr("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+"".concat(t.canonicalString()," has ").concat(t.length));return new e(n,new $d(n._delegate,r,new vi(t)))}},{key:"forKey",value:function(t,n,r){return new e(n,new $d(n._delegate,r,t))}}]),e}();function Xy(e,t,n){return e.message=e.message.replace(t,n),e}function Yy(e){var t,n=(0,o.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("object"===typeof r&&!qy(r))return r}}catch(i){n.e(i)}finally{n.f()}return{}}function Jy(e,t){var n,r,i;return{next:function(e){i.next&&i.next(t(e))},error:null===(n=(i=qy(e[0])?e[0]:qy(e[1])?e[1]:"function"===typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var $y=function(){function e(t,n){(0,s.Z)(this,e),this._firestore=t,this._delegate=n}return(0,c.Z)(e,[{key:"ref",get:function(){return new Wy(this._firestore,this._delegate.ref)}},{key:"id",get:function(){return this._delegate.id}},{key:"metadata",get:function(){return this._delegate.metadata}},{key:"exists",get:function(){return this._delegate.exists()}},{key:"data",value:function(e){return this._delegate.data(e)}},{key:"get",value:function(e,t){return this._delegate.get(e,t)}},{key:"isEqual",value:function(e){return ny(this._delegate,e._delegate)}}]),e}(),ep=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,c.Z)(n,[{key:"data",value:function(e){var t=this._delegate.data(e);return function(e,t){e||Kr()}(void 0!==t),t}}]),n}($y),tp=function(){function e(t,n){(0,s.Z)(this,e),this.firestore=t,this._delegate=n,this._userDataWriter=new jy(t)}return(0,c.Z)(e,[{key:"where",value:function(t,n,r){try{return new e(this.firestore,ay(this._delegate,function(e,t,n){var r=t,i=Xv("where",e);return new uy(i,r,n)}(t,n,r)))}catch(i){throw Xy(i,/(orderBy|where)\(\)/,"Query.$1()")}}},{key:"orderBy",value:function(t,n){try{return new e(this.firestore,ay(this._delegate,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Xv("orderBy",e);return new oy(n,t)}(t,n)))}catch(r){throw Xy(r,/(orderBy|where)\(\)/,"Query.$1()")}}},{key:"limit",value:function(t){try{return new e(this.firestore,ay(this._delegate,function(e){return Wd("limit",e),new sy("limit",e,"F")}(t)))}catch(n){throw Xy(n,"limit()","Query.limit()")}}},{key:"limitToLast",value:function(t){try{return new e(this.firestore,ay(this._delegate,function(e){return Wd("limitToLast",e),new sy("limitToLast",e,"L")}(t)))}catch(n){throw Xy(n,"limitToLast()","Query.limitToLast()")}}},{key:"startAt",value:function(){try{return new e(this.firestore,ay(this._delegate,ly.apply(void 0,arguments)))}catch(t){throw Xy(t,"startAt()","Query.startAt()")}}},{key:"startAfter",value:function(){try{return new e(this.firestore,ay(this._delegate,hy.apply(void 0,arguments)))}catch(t){throw Xy(t,"startAfter()","Query.startAfter()")}}},{key:"endBefore",value:function(){try{return new e(this.firestore,ay(this._delegate,dy.apply(void 0,arguments)))}catch(t){throw Xy(t,"endBefore()","Query.endBefore()")}}},{key:"endAt",value:function(){try{return new e(this.firestore,ay(this._delegate,vy.apply(void 0,arguments)))}catch(t){throw Xy(t,"endAt()","Query.endAt()")}}},{key:"isEqual",value:function(e){return av(this._delegate,e._delegate)}},{key:"get",value:function(e){var t,n=this;return t="cache"===(null===e||void 0===e?void 0:e.source)?Sy(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?function(e){e=Hd(e,ev);var t=Hd(e.firestore,cv),n=lv(t),r=new Ey(t);return Bd(n,e._query,{source:"server"}).then((function(n){return new ey(t,r,e,n)}))}(this._delegate):function(e){e=Hd(e,ev);var t=Hd(e.firestore,cv),n=lv(t),r=new Ey(t);return ry(e._query),Bd(n,e._query).then((function(n){return new ey(t,r,e,n)}))}(this._delegate),t.then((function(e){return new rp(n.firestore,new ey(n.firestore._delegate,n._userDataWriter,n._delegate,e._snapshot))}))}},{key:"onSnapshot",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=Yy(n),a=Jy(n,(function(t){return new rp(e.firestore,new ey(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}));return Ay(this._delegate,i,a)}},{key:"withConverter",value:function(t){return new e(this.firestore,t?this._delegate.withConverter(Hy.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}]),e}(),np=function(){function e(t,n){(0,s.Z)(this,e),this._firestore=t,this._delegate=n}return(0,c.Z)(e,[{key:"type",get:function(){return this._delegate.type}},{key:"doc",get:function(){return new ep(this._firestore,this._delegate.doc)}},{key:"oldIndex",get:function(){return this._delegate.oldIndex}},{key:"newIndex",get:function(){return this._delegate.newIndex}}]),e}(),rp=function(){function e(t,n){(0,s.Z)(this,e),this._firestore=t,this._delegate=n}return(0,c.Z)(e,[{key:"query",get:function(){return new tp(this._firestore,this._delegate.query)}},{key:"metadata",get:function(){return this._delegate.metadata}},{key:"size",get:function(){return this._delegate.size}},{key:"empty",get:function(){return this._delegate.empty}},{key:"docs",get:function(){var e=this;return this._delegate.docs.map((function(t){return new ep(e._firestore,t)}))}},{key:"docChanges",value:function(e){var t=this;return this._delegate.docChanges(e).map((function(e){return new np(t._firestore,e)}))}},{key:"forEach",value:function(e,t){var n=this;this._delegate.forEach((function(r){e.call(t,new ep(n._firestore,r))}))}},{key:"isEqual",value:function(e){return ny(this._delegate,e._delegate)}}]),e}(),ip=function(e){(0,a.Z)(n,e);var t=(0,u.Z)(n);function n(e,r){var i;return(0,s.Z)(this,n),(i=t.call(this,e,r)).firestore=e,i._delegate=r,i}return(0,c.Z)(n,[{key:"id",get:function(){return this._delegate.id}},{key:"path",get:function(){return this._delegate.path}},{key:"parent",get:function(){var e=this._delegate.parent;return e?new Wy(this.firestore,e):null}},{key:"doc",value:function(e){try{return new Wy(this.firestore,void 0===e?rv(this._delegate):rv(this._delegate,e))}catch(t){throw Xy(t,"doc()","CollectionReference.doc()")}}},{key:"add",value:function(e){var t=this;return function(e,t){var n=Hd(e.firestore,cv),r=rv(e),i=by(e.converter,t);return Ny(n,[Dv(_v(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Vu.exists(!1))]).then((function(){return r}))}(this._delegate,e).then((function(e){return new Wy(t.firestore,e)}))}},{key:"isEqual",value:function(e){return iv(this._delegate,e._delegate)}},{key:"withConverter",value:function(e){return new n(this.firestore,e?this._delegate.withConverter(Hy.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}]),n}(tp);function ap(e){return Hd(e,$d)}var up=function(){function e(){(0,s.Z)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this._delegate=(0,i.Z)(gv,n)}return(0,c.Z)(e,[{key:"isEqual",value:function(e){return(e=(0,w.m9)(e))instanceof gv&&this._delegate._internalPath.isEqual(e._internalPath)}}],[{key:"documentId",value:function(){return new e(di.keyField().canonicalString())}}]),e}(),op=function(){function e(t){(0,s.Z)(this,e),this._delegate=t}return(0,c.Z)(e,[{key:"isEqual",value:function(e){return this._delegate.isEqual(e._delegate)}}],[{key:"serverTimestamp",value:function(){var t=new Nv("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)}},{key:"delete",value:function(){var t=new Av("deleteField");return t._methodName="FieldValue.delete",new e(t)}},{key:"arrayUnion",value:function(){var t=Ly.apply(void 0,arguments);return t._methodName="FieldValue.arrayUnion",new e(t)}},{key:"arrayRemove",value:function(){var t=Oy.apply(void 0,arguments);return t._methodName="FieldValue.arrayRemove",new e(t)}},{key:"increment",value:function(t){var n=function(e){return new Vv("increment",e)}(t);return n._methodName="FieldValue.increment",new e(n)}}]),e}(),sp={Firestore:Gy,GeoPoint:bv,Timestamp:si,Blob:By,Transaction:zy,WriteBatch:Qy,DocumentReference:Wy,DocumentSnapshot:$y,Query:tp,QueryDocumentSnapshot:ep,QuerySnapshot:rp,CollectionReference:ip,FieldPath:up,FieldValue:op,setLogLevel:function(e){!function(e){Or.setLogLevel(e)}(e)},CACHE_SIZE_UNLIMITED:-1};!function(e){var t;t=function(e,t){return new Gy(e,t,new Ky)},e.INTERNAL.registerComponent(new g.wA("firestore-compat",(function(e){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return t(n,r)}),"PUBLIC").setServiceProps(Object.assign({},sp))),e.registerVersion("@firebase/firestore-compat","0.1.21")}(l.Z)}}]);
//# sourceMappingURL=18.f344aa1a.chunk.js.map